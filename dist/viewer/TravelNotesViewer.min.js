
/*!
leaflet.travelnotes - version 1.6.0 
build 02600 - 2019-12-28T20:45:41+0100 
Copyright 2017 2019 wwwouaiebe 
Contact: http://www.ouaie.be/
Sources: https://github.com/wwwouaiebe/leaflet.TravelNotes 
License: GPL-3.0
*/


!function(){"use strict";let e=function(){let e={autoLoad:!1,map:{center:{lat:50.50923,lng:5.49542},zoom:12},travelNotesToolbarUI:{contactMail:"https://github.com/wwwouaiebe/leaflet.TravelNotes/issues"},layersToolbarUI:{haveLayersToolbarUI:!0,toolbarTimeOut:1500,contactMail:"https://github.com/wwwouaiebe/leaflet.TravelNotes/issues",theDevil:{addButton:!1,title:"Reminder! The devil will know everything about you",text:"&#x1f47f;"}},mouseUI:{haveMouseUI:!0},errorUI:{timeOut:1e4,helpTimeOut:3e4,showError:!0,showWarning:!0,showInfo:!0,showHelp:!0},geoLocation:{color:"red",radius:11,zoomToPosition:!0,zoomFactor:17,options:{enableHighAccuracy:!1,maximumAge:0,timeout:1/0}},APIKeys:{showDialogButton:!0,saveToSessionStorage:!0,showAPIKeysInDialog:!0,dialogHaveUnsecureButtons:!0},contextMenu:{timeout:1500},routing:{auto:!0},language:"fr",itineraryPointMarker:{color:"red",weight:2,radius:7,fill:!1},searchPointMarker:{color:"green",weight:4,radius:20,fill:!1},searchPointPolyline:{color:"green",weight:4,radius:20,fill:!1},previousSearchLimit:{color:"green",fill:!1,weight:1},nextSearchLimit:{color:"red",fill:!1,weight:1},wayPoint:{reverseGeocoding:!1},route:{color:"#ff0000",width:3,dashArray:0,dashChoices:[{text:"——————",iDashArray:null},{text:"— — — — —",iDashArray:[4,2]},{text:"—‧—‧—‧—‧—",iDashArray:[4,2,0,2]},{text:"················",iDashArray:[0,2]}]},note:{reverseGeocoding:!1,grip:{size:10,opacity:0},polyline:{color:"gray",weight:1},style:"",svgIconWidth:200,svgAnleMaxDirection:{right:35,slightRight:80,continue:100,slightLeft:145,left:200,sharpLeft:270,sharpRight:340},svgZoom:17,svgAngleDistance:10,svgHamletDistance:200,svgVillageDistance:400,svgCityDistance:1200,svgTownDistance:1500,svgTimeOut:15e3,cityPrefix:'<span class="TravelNotes-NoteHtml-Address-City">',cityPostfix:"</span>"},itineraryPointZoom:17,routeEditor:{displayEditionInHTMLPage:!0},travelEditor:{clearAfterSave:!0,startMinimized:!0,timeout:1e3,startupRouteEdition:!0},haveBeforeUnloadWarning:!0,overpassApiUrl:"https://lz4.overpass-api.de/api/interpreter",nominatim:{url:"https://nominatim.openstreetmap.org/",language:"*"},haveCrypto:!1};function t(t){!function e(t,o){if("object"==typeof t&&"object"==typeof o)try{for(let n in o)"object"==typeof o[n]?e(t[n],o[n]):o[n]=t[n]||o[n];for(let n in t)"object"==typeof t[n]?("[object Array]"===Object.prototype.toString.call(t[n])?o[n]=o[n]||[]:o[n]=o[n]||{},e(t[n],o[n])):o[n]=t[n]}catch(e){console.log(e||"Not possible to overload Config")}}(t,e),e=function e(t){for(let o in t)"object"==typeof t[o]&&(t[o]=e(t[o]));return Object.freeze(t)}(e)}return{get autoLoad(){return e.autoLoad},get map(){return e.map},get travelNotesToolbarUI(){return e.travelNotesToolbarUI},get layersToolbarUI(){return e.layersToolbarUI},get mouseUI(){return e.mouseUI},get errorUI(){return e.errorUI},get APIKeys(){return e.APIKeys},get contextMenu(){return e.contextMenu},get routing(){return e.routing},get language(){return e.language},get itineraryPointMarker(){return e.itineraryPointMarker},get searchPointMarker(){return e.searchPointMarker},get searchPointPolyline(){return e.searchPointPolyline},get previousSearchLimit(){return e.previousSearchLimit},get nextSearchLimit(){return e.nextSearchLimit},get wayPoint(){return e.wayPoint},get route(){return e.route},get note(){return e.note},get itineraryPointZoom(){return e.itineraryPointZoom},get routeEditor(){return e.routeEditor},get travelEditor(){return e.travelEditor},get haveBeforeUnloadWarning(){return e.haveBeforeUnloadWarning},get overpassApiUrl(){return e.overpassApiUrl},get nominatim(){return e.nominatim},get geoLocation(){return e.geoLocation},get haveCrypto(){return e.haveCrypto},overload:e=>t(e)}}();function t(){return Object.seal({create:(e,t,o)=>(function(e,t,o){let n=null;if(n="text"===e.toLowerCase()?document.createTextNode(""):document.createElement(e),o&&o.appendChild(n),t)for(let e in t)try{n[e]=t[e]}catch(t){console.log("Invalid property : "+e)}return n})(e,t,o)})}const o={angle:{degree0:0,degree90:90,degree180:180,degree270:270,degree360:360},baseContextMenu:{menuMargin:20},baseDialog:{dragMargin:20},colorDialog:{maxColorValue:255,linColorValue:0,colorRowsNumber:6,deltaColor:51},collection:{swapUp:-1,swapDown:1,direction:{next:1,previous:-1}},distance:{mInKm:1e3,round:10,fixed:2,invalid:-1,defaultValue:0},dataPanesUI:{invalidPane:-1,itineraryPane:0,travelNotesPane:1,searchPane:2},geoLocation:{status:{refusedByUser:-1,disabled:0,inactive:1,active:2}},hexadecimal:16,htmlViewsFactory:{linksMaxLength:40,minNotesDistance:9},invalidObjId:-1,layersToolbarUI:{buttonsAlwaysVisible:3},latLng:{defaultValue:0,fixed:6,maxLat:90,minLat:-90,maxLng:180,minLng:-180},mapEditor:{defaultMaxZoom:18,defaultMinZoom:0,wayPointIconSize:40,markerBoundsPrecision:.01},mouse:{wheelCorrectionFactors:[.3,10,1]},note:{defaultIconSize:40,zIndexOffset:100},notFound:-1,numberMinus1:-1,number1:1,number2:2,number3:3,number4:4,number5:5,number16:16,number65536:65536,passwordDialog:{pswdMinLength:12},polylinePrecision:6,route:{edited:{notEdited:0,editedNoChange:1,editedChanged:2},minWidth:1,maxWidth:40},svgIcon:{positionOnRoute:{atStart:-1,onRoute:0,atEnd:1},width:40,height:40},svgIconFromOsmFactory:{comparePrecision:1e-5,searchAroundFactor:1.5},time:{secondInDay:86400,secondInHour:3600,secondInMinut:60},xmlHttpRequest:{status:{ok:200},readyState:{done:4},timeout:2e4},zero:0};function n(){return{getJsonPromise:(e,t)=>(e=e,t=t,new Promise(function(n,r){let a=new XMLHttpRequest;a.timeout=o.xmlHttpRequest.timeout,a.ontimeout=function(){r("XMLHttpRequest TimeOut. File : "+a.responseURL)},a.onreadystatechange=function(){if(o.xmlHttpRequest.readyState.done===a.readyState)if(o.xmlHttpRequest.status.ok===a.status){let e=null;try{e=JSON.parse(a.responseText)}catch(e){r(e.message+" File: "+a.responseURL)}n(e)}else r("Error XMLHttpRequest - File : "+a.responseURL)},a.open("GET",e,!0),t&&t.forEach(e=>a.setRequestHeader(e.headerName,e.headerValue)),a.overrideMimeType("application/json"),a.send(null)})),getBinaryPromise:(e,t)=>(function(e,t){return new Promise(function(n,r){let a=new XMLHttpRequest;a.timeout=o.xmlHttpRequest.timeout,a.ontimeout=function(){r("XMLHttpRequest TimeOut. File : "+a.responseURL)},a.onload=function(){if(o.xmlHttpRequest.status.ok===a.status){let e=a.response;e?n(e):r("Error XMLHttpRequest - File : "+a.responseURL)}else r("Error XMLHttpRequest - File : "+a.responseURL)},a.open("GET",e,!0),t&&t.forEach(e=>a.setRequestHeader(e.headerName,e.headerValue)),a.responseType="arraybuffer",a.send(null)})})(e,t)};var e,t}let r=o.zero;function a(){return++r}const i="1.6.0";function l(e){const t=e,o=i;return Object.seal({get name(){return t},get version(){return o},get object(){return{name:t,version:o}},validate:e=>(function(e){if(!Object.getOwnPropertyNames(e).includes("name"))throw new Error("No name for "+t);if(t!==e.name)throw new Error("Invalid name for "+t);if(!Object.getOwnPropertyNames(e).includes("version"))throw new Error("No version for "+t)})(e)})}const s=l("WayPoint");function d(){let e="",t=o.latLng.defaultValue,n=o.latLng.defaultValue,r=a();function i(i){let l=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+s.name);if(s.validate(e.objType),s.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":e.objType.version="1.6.0";break;default:throw new Error("invalid version for "+s.name)}let t=Object.getOwnPropertyNames(e);return["name","lat","lng","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+s.name)}),e}(i);e=l.name||"",t=l.lat||o.latLng.defaultValue,n=l.lng||o.latLng.defaultValue,r=a()}return Object.seal({get name(){return e},set name(t){e=t},get lat(){return t},set lat(e){t=e},get lng(){return n},set lng(e){n=e},get latLng(){return[t,n]},set latLng(e){t=e[o.zero],n=e[o.number1]},get objId(){return r},get objType(){return s},get object(){return{name:e,lat:parseFloat(t.toFixed(o.latLng.fixed)),lng:parseFloat(n.toFixed(o.latLng.fixed)),objId:r,objType:s.object}},set object(e){i(e)}})}const u=l("Itinerary");function c(){let e="",t="",n=j("ItineraryPoint"),r=j("Maneuver"),i=a();function l(l){let s=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+u.name);if(u.validate(e.objType),u.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":e.objType.version="1.6.0";break;default:throw new Error("invalid version for "+u.name)}let t=Object.getOwnPropertyNames(e);return["itineraryPoints","maneuvers","provider","transitMode","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+u.name)}),e}(l);n.object=s.itineraryPoints||[],r.object=s.maneuvers||[],e=s.provider||"",t=s.transitMode||"",i=a();let d=new Map,c=o.zero,g=n.iterator;for(;!g.done;)d.set(s.itineraryPoints[c].objId,g.value.objId),c++;let m=r.iterator;for(;!m.done;)m.value.itineraryPointObjId=d.get(m.value.itineraryPointObjId)}return Object.seal({get itineraryPoints(){return n},get maneuvers(){return r},get provider(){return e},set provider(t){e=t},get transitMode(){return t},set transitMode(e){t=e},get objId(){return i},get objType(){return u},get object(){return{itineraryPoints:n.object,maneuvers:r.object,provider:e,transitMode:t,objId:i,objType:u.object}},set object(e){l(e)}})}const g=l("Route");function m(){let t="",n=j("WayPoint");n.add(d()),n.add(d());let r=j("Note"),i=c(),l=e.route.width,s=e.route.color,u=e.route.dashArray,m=!1,p=o.distance.defaultValue,f=o.distance.defaultValue,b=o.distance.defaultValue,v=o.route.edited.notEdited;let h=!1,y=a();function L(d){let L=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+g.name);if(g.validate(e.objType),g.version!==e.objType.version)switch(e.objType.version){case"1.0.0":e.dashArray=o.zero,e.hidden=!1;case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":e.edited=o.route.edited.notEdited;case"1.5.0":e.objType.version="1.6.0";break;default:throw new Error("invalid version for "+g.name)}let t=Object.getOwnPropertyNames(e);return["name","wayPoints","notes","itinerary","width","color","dashArray","chain","distance","duration","edited","hidden","chainedDistance","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+g.name)}),e}(d);t=L.name||"",n.object=L.wayPoints||[],r.object=L.notes||[],i.object=L.itinerary||c().object,l=L.width||e.route.width,s=L.color||"#000000",u=L.dashArray||o.zero,m=L.chain||!1,f=L.distance,b=L.duration,v=L.edited||o.route.edited.notEdited,h=L.hidden||!1,p=L.chainedDistance,y=a()}return Object.seal({get wayPoints(){return n},get itinerary(){return i},get notes(){return r},get name(){return t},set name(e){t=e},get width(){return l},set width(e){l=e},get color(){return s},set color(e){s=e},get dashArray(){return u},set dashArray(e){u=e},get chain(){return m},set chain(e){m=e},get chainedDistance(){return p},set chainedDistance(e){p=e},get distance(){return f},set distance(e){f=e},get duration(){return b},set duration(e){b=e},get edited(){return v},set edited(e){!function(e){if("number"!=typeof e||o.route.edited.notEdited>e||o.route.edited.editedChanged<e)throw new Error("Invalid value for Route.edited : "+e);v=e}(e)},get hidden(){return h},set hidden(e){h=e},get objId(){return y},get objType(){return g},get object(){return{name:t,wayPoints:n.object,notes:r.object,itinerary:i.object,width:l,color:s,dashArray:u,chain:m,distance:parseFloat(f.toFixed(o.distance.fixed)),duration:b,edited:v,hidden:h,chainedDistance:parseFloat(p.toFixed(o.distance.fixed)),objId:y,objType:g.object}},set object(e){L(e)}})}const p=l("Note");function f(){let e=a(),t=o.note.defaultIconSize,n=o.note.defaultIconSize,r="",i="",l="",s="",d="",u="",c=o.latLng.defaultValue,g=o.latLng.defaultValue,m=o.latLng.defaultValue,f=o.latLng.defaultValue,b=o.distance.invalid,v=o.distance.defaultValue;function h(h){let y=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+p.name);if(p.validate(e.objType),p.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":e.objType.version="1.6.0";break;default:throw new Error("invalid version for "+p.name)}let t=Object.getOwnPropertyNames(e);return["iconHeight","iconWidth","iconContent","popupContent","tooltipContent","phone","url","address","iconLat","iconLng","lat","lng","distance","chainedDistance","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+p.name)}),e}(h);t=y.iconHeight||o.note.defaultIconSize,n=y.iconWidth||o.note.defaultIconSize,r=y.iconContent||"",i=y.popupContent||"",l=y.tooltipContent||"",s=y.phone||"",d=y.url||"",u=y.address||"",c=y.iconLat||o.latLng.defaultValue,g=y.iconLng||o.latLng.defaultValue,m=y.lat||o.latLng.defaultValue,f=y.lng||o.latLng.defaultValue,b=y.distance||o.distance.invalid,v=y.chainedDistance,e=a()}return Object.seal({get isRouteNote(){return b!==o.distance.invalid},get iconHeight(){return t},set iconHeight(e){t=e},get iconWidth(){return n},set iconWidth(e){n=e},get iconContent(){return r},set iconContent(e){r=e},get popupContent(){return i},set popupContent(e){i=e},get tooltipContent(){return l},set tooltipContent(e){l=e},get phone(){return s},set phone(e){s=e},get url(){return d},set url(e){d=e},get address(){return u},set address(e){u=e},get iconLat(){return c},set iconLat(e){c=e},get iconLng(){return g},set iconLng(e){g=e},get iconLatLng(){return[c,g]},set iconLatLng(e){c=e[o.zero],g=e[o.number1]},get lat(){return m},set lat(e){m=e},get lng(){return f},set lng(e){f=e},get latLng(){return[m,f]},set latLng(e){m=e[o.zero],f=e[o.number1]},get distance(){return b},set distance(e){b=e},get chainedDistance(){return v},set chainedDistance(e){v=e},get objId(){return e},get objType(){return p},get object(){return{iconHeight:t,iconWidth:n,iconContent:r,popupContent:i,tooltipContent:l,phone:s,url:d,address:u,iconLat:parseFloat(c.toFixed(o.latLng.fixed)),iconLng:parseFloat(g.toFixed(o.latLng.fixed)),lat:parseFloat(m.toFixed(o.latLng.fixed)),lng:parseFloat(f.toFixed(o.latLng.fixed)),distance:parseFloat(b.toFixed(o.distance.fixed)),chainedDistance:parseFloat(v.toFixed(o.distance.fixed)),objId:e,objType:p.object}},set object(e){h(e)}})}const b=l("Maneuver");function v(){let e=a(),t="",n="",r=-1,i=o.distance.defaultValue,l=o.distance.defaultValue;function s(s){let d=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+b.name);if(b.validate(e.objType),b.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":e.objType.version="1.6.0";break;default:throw new Error("invalid version for "+b.name)}let t=Object.getOwnPropertyNames(e);return["iconName","instruction","distance","duration","itineraryPointObjId","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+b.name)}),e}(s);t=d.iconName||"",n=d.instruction||"",i=d.distance||o.distance.defaultValue,l=d.duration||o.distance.defaultValue,r=d.itineraryPointObjId||o.invalidObjId,e=a()}return Object.seal({get iconName(){return t},set iconName(e){t=e},get instruction(){return n},set instruction(e){n=e},get itineraryPointObjId(){return r},set itineraryPointObjId(e){r=e},get distance(){return i},set distance(e){i=e},get duration(){return l},set duration(e){l=e},get objId(){return e},get objType(){return b},get object(){return{iconName:t,instruction:n,distance:parseFloat(i.toFixed(o.distance.fixed)),duration:l,itineraryPointObjId:r,objId:e,objType:b.object}},set object(e){s(e)}})}const h=l("ItineraryPoint");function y(){let e=o.latLng.defaultValue,t=o.latLng.defaultValue,n=o.distance.defaultValue,r=a();function i(i){let l=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+h.name);if(h.validate(e.objType),h.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":e.objType.version="1.6.0";break;default:throw new Error("invalid version for "+h.name)}let t=Object.getOwnPropertyNames(e);return["lat","lng","distance","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+h.name)}),e}(i);e=l.lat||o.latLng.defaultValue,t=l.lng||o.latLng.defaultValue,n=l.distance||o.distance.defaultValue,r=a()}return Object.seal({get lat(){return e},set lat(t){e=t},get lng(){return t},set lng(e){t=e},get latLng(){return[e,t]},set latLng(n){e=n[o.zero],t=n[o.number1]},get distance(){return n},set distance(e){n=e},get objId(){return r},get objType(){return h},get object(){return{lat:parseFloat(e.toFixed(o.latLng.fixed)),lng:parseFloat(t.toFixed(o.latLng.fixed)),distance:parseFloat(n.toFixed(o.distance.fixed)),objId:r,objType:h.object}},set object(e){i(e)}})}function j(e){let t=[],n=e;function r(e){if(!e.objType||!e.objType.name||e.objType.name!==n)throw new Error("invalid object name for add function");t.push(e)}function a(){let e=o.notFound;return{get value(){return e<t.length?t[e]:null},get done(){return++e>=t.length},get first(){return o.zero===e},get last(){return e>=t.length-o.number1},get index(){return e}}}function i(e){return t.findIndex(t=>t.objId===e)}function l(e,n,r){let a=i(e);if(o.notFound===a)throw new Error("invalid objId for next or previous function");let l=n;for(l||(l=(()=>!0)),a+=r;o.notFound<a&&a<t.length&&!l(t[a]);)a+=r;return o.notFound===a||t.length===a?null:t[a]}return Object.seal({add:e=>r(e),forEach:e=>(function(e){let t=null,o=a();for(;!o.done;)t=e(o.value,t);return t})(e),getAt:e=>(function(e){let n=i(e);return o.notFound===n?null:t[n]})(e),moveTo:(e,n,r)=>(function(e,n,r){let a=i(e),l=i(n);r||l++,t.splice(l,o.zero,t[a]),l<a&&a++,t.splice(a,o.number1)})(e,n,r),next:(e,t)=>l(e,t,o.collection.direction.next),previous:(e,t)=>l(e,t,o.collection.direction.previous),remove:e=>(function(e){let n=i(e);if(o.notFound===n)throw new Error("invalid objId for remove function");t.splice(i(e),o.number1)})(e),removeAll:e=>(u=e,void(u?t.splice(o.number1,t.length-o.number2):t.length=o.zero)),replace:(e,n)=>(function(e,n){let r=i(e);if(o.notFound===r)throw new Error("invalid objId for replace function");t[r]=n})(e,n),reverse:()=>void t.reverse(),sort:e=>(e=e,void t.sort(e)),swap:(e,n)=>(function(e,n){let r=i(e);if(o.notFound===r||o.zero===r&&n||t.length-o.number1===r&&!n)throw new Error("invalid objId for swap function");let a=t[r];t[r]=t[r+(n?o.collection.swapUp:o.collection.swapDown)],t[r+(n?o.collection.swapUp:o.collection.swapDown)]=a})(e,n),get first(){return t[o.zero]},get iterator(){return a()},get last(){return t[t.length-o.number1]},get length(){return t.length},get object(){return function(){let e=[],t=a();for(;!t.done;)e.push(t.value.object);return e}()},set object(e){!function(e){t.length=o.zero;let a=null;e.forEach(e=>{switch(n){case"Route":a=m();break;case"Note":a=f();break;case"WayPoint":a=d();break;case"Maneuver":a=v();break;case"ItineraryPoint":a=y();break;default:throw new Error("invalid ObjName ( "+n+" ) in Collection.mySetObject")}a.object=e,r(a)})}(e)}});var s,u}const w=l("Travel");function T(){let e=m(),t="OSM - Color",o="TravelNotes",n=j("Route"),r=j("Note"),i=a(),l=!1,s={};function d(d){let u=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+w.name);if(w.validate(e.objType),w.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":e.editedRoute=m();case"1.5.0":if(e.userData.layerId){let t=[{layerId:"0",layerName:"OSM - Color"},{layerId:"1",layerName:"OSM - Black and White"},{layerId:"2",layerName:"Thunderforest - Transport"},{layerId:"3",layerName:"Thunderforest - OpenCycleMap"},{layerId:"4",layerName:"Thunderforest - Outdoors"},{layerId:"5",layerName:"Esri - Aerial view"},{layerId:"6",layerName:"Kartverket - Norway"},{layerId:"7",layerName:"IGN-NGI - Belgium now"},{layerId:"12",layerName:"Thunderforest - Landscape"},{layerId:"24",layerName:"Lantmäteriet - Sweden"},{layerId:"25",layerName:"Maanmittauslaitos - Finland"}].find(t=>t.layerId===e.userData.layerId);e.layerName=t?t.layerName:"OSM - Color"}else e.layerName="OSM - Color";e.objType.version="1.6.0";break;default:throw new Error("invalid version for "+w.name)}let t=Object.getOwnPropertyNames(e);return["name","editedRoute","routes","userData","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+w.name)}),e}(d);e.object=u.editedRoute,t=d.layerName||"OSM - Color",o=u.name||"",s=u.userData||{},l=u.readOnly||!1,n.object=u.routes||[],r.object=u.notes||[],i=a()}return Object.seal({get editedRoute(){return e},set editedRoute(t){e=t},get routes(){return n},get notes(){return r},get layerName(){return t},set layerName(e){t=e},get name(){return o},set name(e){o=e},get readOnly(){return l},set readOnly(e){l=e},get userData(){return s},set userData(e){s=e},get objId(){return i},get objType(){return w},get object(){return{editedRoute:e.object,layerName:t,name:o,routes:n.object,notes:r.object,userData:s,readOnly:l,objId:i,objType:w.object}},set object(e){d(e)}})}const I=function(){let e=new Map;return{setTranslations:t=>(t=t,void t.forEach(t=>e.set(t.msgid,t.msgstr))),getText:(t,o)=>(function(t,o){let n=e.get(t);return o&&n&&Object.getOwnPropertyNames(o).forEach(e=>n=n.replace("{"+e+"}",o[e])),n||t})(t,o)};var t}();function N(){function e(e){return e>o.zero?e.toFixed(o.latLng.fixed)+" N":(-e).toFixed(o.latLng.fixed)+" S"}function t(e){return e>o.zero?e.toFixed(o.latLng.fixed)+" E":(-e).toFixed(o.latLng.fixed)+" W"}return Object.seal({get UUID(){return function(){function e(){return Math.floor((o.number1+Math.random())*o.number65536).toString(o.hexadecimal).substring(o.number1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}()},storageAvailable:e=>(function(e){try{let t=window[e],o="__storage_test__";return t.setItem(o,o),t.removeItem(o),!0}catch(e){return!1}})(e),fileAPIAvailable:()=>(function(){try{return new File(["testdata"],{type:"text/plain"}),!0}catch(e){return!!window.navigator.msSaveOrOpenBlob}})(),saveFile:(e,t,o)=>(function(e,t,o){if(window.navigator.msSaveOrOpenBlob)try{window.navigator.msSaveOrOpenBlob(new Blob([t]),e)}catch(e){console.log(e||"An error occurs when saving file")}else try{let n=window.URL.createObjectURL(new File([t],{type:o||"text/plain"})),r=document.createElement("a");r.setAttribute("href",n),r.setAttribute("download",e),r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(n)}catch(e){console.log(e||"An error occurs when saving file")}})(e,t,o),formatTime:e=>(function(e){let t=Math.floor(e);if(o.zero===t)return"";let n=Math.floor(t/o.time.secondInDay),r=Math.floor(t%o.time.secondInDay/o.time.secondInHour),a=Math.floor(t%o.time.secondInHour/o.time.secondInMinut),i=Math.floor(t%o.time.secondInMinut);return o.zero<n?n+" "+I.getText("Utilities - Day")+" "+r+" "+I.getText("Utilities - Hour"):o.zero<r?r+" "+I.getText("Utilities - Hour")+" "+a+" "+I.getText("Utilities - Minute"):o.zero<a?a+" "+I.getText("Utilities - Minute"):i+" "+I.getText("Utilities - Second")})(e),formatDistance:e=>(function(e){let t=Math.floor(e);return o.zero===t?"":Math.floor(t/o.distance.mInKm)+","+Math.floor(t%o.distance.mInKm/o.distance.round).toFixed(o.zero).padStart(o.number2,"0").padEnd(o.number3,"0")+" km"})(e),formatLat:t=>e(t),formatLng:e=>t(e),formatLatLng:n=>(n=n,o.zero===n[o.zero]&&o.zero===n[o.number1]?"":e(n[o.zero])+" - "+t(n[o.number1]))});var n}const O=function(){let e={map:null,providers:new Map,mapObjects:new Map,travel:T(),editedRouteObjId:o.invalidObjId,routing:Object.seal({provider:"",transitMode:""}),searchData:[],UUID:N().UUID};return Object.seal({get map(){return e.map},set map(t){e.map=t},get providers(){return e.providers},get mapObjects(){return e.mapObjects},get travel(){return e.travel},set travel(t){e.travel=t},get editedRouteObjId(){return e.editedRouteObjId},set editedRouteObjId(t){e.editedRouteObjId=t},get routeEdition(){return e.routeEdition},get routing(){return e.routing},get searchData(){return e.searchData},set searchData(t){e.searchData=t},get translations(){return e.translations},get UUID(){return e.UUID}})}();function M(){return Object.seal({getRoute:e=>(function(e){let t=null;return(t=O.travel.routes.getAt(e))||e===O.travel.editedRoute.objId&&(t=O.travel.editedRoute),t})(e),getNoteAndRoute:e=>(function(e){let t=null;if(t=O.travel.notes.getAt(e))return{note:t,route:null};let o=O.travel.routes.iterator;for(;!o.done;)if(t=o.value.notes.getAt(e))return{note:t,route:o.value};return(t=O.travel.editedRoute.notes.getAt(e))?{note:t,route:O.travel.editedRoute}:{note:null,route:null}})(e),getWayPoint:e=>(function(e){let t=null,o=O.travel.routes.iterator;for(;!o.done;)if(t=o.value.wayPoints.getAt(e))return t;return(t=O.travel.editedRoute.wayPoints.getAt(e))||null})(e)})}function x(){return Object.seal({getClosestLatLngDistance:(e,t)=>(function(e,t){if(o.zero===e.itinerary.itineraryPoints.length)return null;let n=e.itinerary.itineraryPoints.iterator;n.done;let r=Number.MAX_VALUE,a=L.Projection.SphericalMercator.project(L.latLng(t[o.zero],t[o.number1])),i=L.Projection.SphericalMercator.project(L.latLng(n.value.lat,n.value.lng)),l=null,s=o.distance.defaultValue,d=n.value.distance;for(;!n.done;){let e=L.Projection.SphericalMercator.project(L.latLng(n.value.lat,n.value.lng)),t=L.LineUtil.pointToSegmentDistance(a,i,e);t<r&&(r=t,s=d-(l=L.Projection.SphericalMercator.unproject(L.LineUtil.closestPointOnSegment(a,i,e))).distanceTo(L.latLng(n.value.lat,n.value.lng))),d+=n.value.distance,i=e}return{latLng:[l.lat,l.lng],distance:s}})(e,t),getLatLngBounds:e=>(function(e){let t=L.latLng([o.latLng.maxLat,o.latLng.maxLng]),n=L.latLng([o.latLng.minLat,o.latLng.minLng]);return e.forEach(e=>{t.lat=Math.min(t.lat,e[o.zero]),t.lng=Math.min(t.lng,e[o.number1]),n.lat=Math.max(n.lat,e[o.zero]),n.lng=Math.max(n.lng,e[o.number1])}),L.latLngBounds(t,n)})(e),pointsDistance:(e,t)=>(e=e,t=t,L.latLng(e).distanceTo(L.latLng(t))),project:(e,t)=>(function(e,t){let o=O.map.project(L.latLng(e),t);return[o.x,o.y]})(e,t),addPoints:(e,t)=>(e=e,t=t,[e[o.zero]+t[o.zero],e[o.number1]+t[o.number1]]),subtrackPoints:(e,t)=>(function(e,t){return[e[o.zero]-t[o.zero],e[o.number1]-t[o.number1]]})(e,t)});var e,t,n,r}function P(n){let r=t(),i=N(),l=e.note.svgIconWidth,s=n||"TravelNotes-Control-";function d(e){let t="";o.zero!==e.tooltipContent.length&&(t+='<div class="'+s+'NoteHtml-TooltipContent">'+e.tooltipContent+"</div>"),o.zero!==e.popupContent.length&&(t+='<div class="'+s+'NoteHtml-PopupContent">'+e.popupContent+"</div>"),o.zero!==e.address.length&&(t+='<div class="'+s+'NoteHtml-Address">'+I.getText("NoteEditor - Address")+e.address+"</div>"),o.zero!==e.phone.length&&(t+='<div class="'+s+'NoteHtml-Phone">'+I.getText("NoteEditor - Phone")+e.phone+"</div>"),o.zero!==e.url.length&&(t+='<div class="'+s+'NoteHtml-Url">'+I.getText("NoteEditor - Link")+'<a href="'+e.url+'" target="_blank">'+e.url.substr(o.zero,o.htmlViewsFactory.linksMaxLength)+"...</a></div>");let n=N();return t+='<div class="'+s+'NoteHtml-LatLng">'+I.getText("NoteEditor - Latitude Longitude",{lat:n.formatLat(e.lat),lng:n.formatLng(e.lng)})+"</div>",o.distance.invalid!==e.distance&&(t+='<div class="'+s+'NoteHtml-Distance">'+I.getText("NoteEditor - Distance",{distance:n.formatDistance(e.chainedDistance+e.distance)})+"</div>"),t}function u(e,t){let o=r.create("div",{className:s+"Travel-Notes-IconCell",innerHTML:e.iconContent},t);"svg"===o.firstChild.tagName&&"TravelNotes-Roadbook-"===s&&o.firstChild.setAttributeNS(null,"viewBox","0 0 "+l+" "+l),r.create("div",{className:s+"Travel-Notes-Cell",innerHTML:d(e)},t),t.noteObjId=e.objId}function c(e){let t='<div class="'+s+'Route-Header-Name">'+e.name+"</div>";return o.zero!==e.distance&&(t+='<div class="'+s+'Route-Header-Distance">'+I.getText("RouteEditor - Distance",{distance:i.formatDistance(e.distance)})+"</div>"),O.travel.readOnly||(t+='<div class="'+s+'Route-Header-Duration">'+I.getText("RouteEditor - Duration",{duration:i.formatTime(e.duration)})+"</div>"),t}function g(){let e=r.create("div",{className:s+"Travel-Header"});r.create("div",{className:s+"Travel-Header-Name",innerHTML:O.travel.name},e);let t=o.distance.defaultValue,n=O.travel.routes.iterator;for(;!n.done;)r.create("div",{className:s+"Travel-Header-RouteName",innerHTML:'<a href="#route'+n.value.objId+'">'+n.value.name+"</a>&nbsp;:&nbsp;"+i.formatDistance(n.value.distance)+"."},e),n.value.chain&&(t+=n.value.distance);return r.create("div",{className:s+"Travel-Header-TravelDistance",innerHTML:I.getText("HTMLViewsFactory - Travel distance&nbsp;:&nbsp;{distance}",{distance:i.formatDistance(t)})},e),e}function m(){let e=r.create("div",{className:s+"Travel-Notes"}),t=O.travel.notes.iterator;for(;!t.done;){let o=r.create("div",{className:s+"Travel-Notes-Row"},e);u(t.value,o)}return e}function p(e){return r.create("div",{className:s+"Route-Header",id:"route"+e.objId,innerHTML:c(e)})}function f(e){let t=r.create("div",{className:s+"Route-ManeuversAndNotes"}),n=e.notes.iterator,l=n.done,d=l?Number.MAX_VALUE:n.value.distance,c=d,g=e.itinerary.maneuvers.iterator,m=g.done,p=o.distance.defaultValue;for(;!m||!l;){let f=r.create("div",{className:s+"Route-ManeuversAndNotes-Row"},t);if(p<=d){if(!m){f.className=s+"Route-Maneuvers-Row",r.create("div",{className:s+"Route-ManeuversAndNotes-IconCell TravelNotes-ManeuverNote-"+g.value.iconName},f);let t="<div>"+g.value.instruction+"</div>";o.zero<g.value.distance&&(t+="<div>"+I.getText("HTMLViewsFactory - To next instruction&nbsp;:&nbsp;{distance}&nbsp;-&nbsp;{duration}",{distance:i.formatDistance(g.value.distance),duration:i.formatTime(g.value.duration)})+"</div>"),r.create("div",{className:s+"Route-ManeuversAndNotes-Cell",innerHTML:t},f),f.objId=a(),f.latLng=e.itinerary.itineraryPoints.getAt(g.value.itineraryPointObjId).latLng,f.maneuverObjId=g.value.objId,p+=g.value.distance,(m=g.done)&&(p=Number.MAX_VALUE)}}else if(!l&&(f.className=s+"Route-Notes-Row",u(n.value,f),f.objId=a(),f.latLng=n.value.latLng,f.noteObjId=n.value.objId,c=n.value.distance,d=(l=n.done)?Number.MAX_VALUE:n.value.distance,!l)){let e=n.value.distance-c;o.htmlViewsFactory.minNotesDistance<e&&r.create("div",{className:s+"NoteHtml-NextDistance",innerHTML:I.getText("HTMLViewsFactory - Next distance&nbsp;:&nbsp;{distance}",{distance:i.formatDistance(e)})},f.lastChild)}}return t}function b(e){let t="";return""!==e.itinerary.provider&&""!==e.itinerary.transitMode&&(t=I.getText("HTMLViewsFactory - Itinerary computed by {provider} and optimized for {transitMode}",{provider:e.itinerary.provider,transitMode:I.getText("HTMLViewsFactory - TransitMode "+e.itinerary.transitMode)})),r.create("div",{className:s+"RouteFooter",innerHTML:t})}function v(){return r.create("div",{className:s+"TravelFooter",innerHTML:I.getText("HTMLViewsFactory - Travel footer")})}return Object.seal({get travelHeaderHTML(){return g()},get travelNotesHTML(){return m()},get routeHeaderHTML(){return p(O.travel.editedRoute)},get routeManeuversAndNotesHTML(){return f(O.travel.editedRoute)},get routeFooterHTML(){return b(O.travel.editedRoute)},get travelFooterHTML(){return v()},get travelHTML(){return function(){let t=r.create("div",{className:s+"Travel"});t.appendChild(g()),t.appendChild(m());let o=O.travel.routes.iterator;for(;!o.done;){let n=e.routeEditor.displayEditionInHTMLPage&&o.value.objId===O.editedRouteObjId;t.appendChild(p(n?O.travel.editedRoute:o.value)),t.appendChild(f(n?O.travel.editedRoute:o.value)),t.appendChild(b(n?O.travel.editedRoute:o.value))}return t.appendChild(v()),t}()},getRouteHTML:e=>c(e),getNoteHTML:e=>d(e)})}function E(e){let t=M(),n=t.getRoute(e.target.objId),r=x().getClosestLatLngDistance(n,[e.latlng.lat,e.latlng.lng]).distance;r+=n.chainedDistance,r=N().formatDistance(r);let a=O.mapObjects.get(e.target.objId);a.closeTooltip();let i=t.getRoute(e.target.objId).name;O.travel.readOnly||(i+=o.zero===i.length?"":" - ",i+=r),a.setTooltipContent(i),a.openTooltip(e.latlng)}const R=function(){let t=M(),n=null,r=null;function a(e,t){t.objId=e,t.addTo(O.map),O.mapObjects.set(e,t)}function i(n){let r=t.getNoteAndRoute(n).note,i=O.travel.readOnly,l=L.marker(r.latLng,{icon:L.divIcon({iconSize:[e.note.grip.size,e.note.grip.size],iconAnchor:[e.note.grip.size/o.number2,e.note.grip.size/o.number2],html:"<div></div>"}),opacity:e.note.grip.opacity,draggable:!i});l.objId=r.objId;let s=L.divIcon({iconSize:[r.iconWidth,r.iconHeight],iconAnchor:[r.iconWidth/o.number2,r.iconHeight/o.number2],popupAnchor:[o.zero,-r.iconHeight/o.number2],html:r.iconContent,className:"TravelNotes-AllNotes "+e.note.style}),d=L.marker(r.iconLatLng,{zIndexOffset:o.note.zIndexOffset,icon:s,draggable:!i});d.objId=r.objId,d.bindPopup(e=>{let o=t.getNoteAndRoute(e.objId).note;return P("TravelNotes-").getNoteHTML(o)}),o.zero!==r.tooltipContent.length&&(d.bindTooltip(e=>t.getNoteAndRoute(e.objId).note.tooltipContent),d.getTooltip().options.offset[o.zero]=r.iconWidth/o.number2);let u=L.polyline([r.latLng,r.iconLatLng],e.note.polyline);u.objId=r.objId;let c=L.layerGroup([d,u,l]);c.markerId=L.Util.stamp(d),c.polylineId=L.Util.stamp(u),c.bulletId=L.Util.stamp(l),a(r.objId,c)}function l(t){t.dashArray>=e.route.dashChoices.length&&(t.dashArray=o.zero);let n=e.route.dashChoices[t.dashArray].iDashArray;if(n){let e="",r=o.zero;for(r=o.zero;r<n.length-o.number1;r++)e+=n[r]*t.width+",";return e+=n[r]*t.width}return null}return Object.seal({addRoute:e=>(function(e){let o=t.getRoute(e),n=[],r=o.itinerary.itineraryPoints.iterator;for(;!r.done;)n.push(r.value.latLng);let s=L.polyline(n,{color:o.color,weight:o.width,dashArray:l(o)});a(o.objId,s),s.bindTooltip(o.name,{sticky:!0,direction:"right"}),s.on("mouseover",E),s.on("mousemove",E),s.bindPopup(e=>{let o=t.getRoute(e.objId);return P("TravelNotes-").getRouteHTML(o)}),L.DomEvent.on(s,"click",e=>e.target.openPopup(e.latlng));let d=o.notes.iterator;for(;!d.done;)i(d.value.objId);return o})(e),addNote:e=>i(e),getDashArray:e=>l(e),zoomTo:(t,o)=>(function(t,o){if(o){let e=[];o.forEach(t=>e=e.concat(t)),O.map.fitBounds(x().getLatLngBounds(e))}else O.map.setView(t,e.itineraryPointZoom)})(t,o),setLayer:e=>(function(e){let t=null;t="wmts"===e.service.toLowerCase()?L.tileLayer(e.url):L.tileLayer.wms(e.url,e.wmsOptions),n&&O.map.removeLayer(n),O.map.addLayer(t),n=t,O.travel.readOnly||(O.map.getZoom()<(e.minZoom||o.mapEditor.defaultMinZoom)&&O.map.setZoom(e.minZoom||o.mapEditor.defaultMinZoom),O.map.setMinZoom(e.minZoom||o.mapEditor.defaultMinZoom),O.map.getZoom()>(e.maxZoom||o.mapEditor.defaultMaxZoom)&&O.map.setZoom(e.maxZoom||o.mapEditor.defaultMaxZoom),O.map.setMaxZoom(e.maxZoom||o.mapEditor.defaultMaxZoom),e.bounds?(O.map.getBounds().intersects(e.bounds)&&!O.map.getBounds().contains(e.bounds)||(O.map.setMaxBounds(null),O.map.fitBounds(e.bounds),O.map.setZoom(e.minZoom||o.mapEditor.defaultMinZoom)),O.map.setMaxBounds(e.bounds)):O.map.setMaxBounds(null)),O.map.fire("baselayerchange",t)})(e),onGeolocationStatusChanged:e=>(e=e,void(o.geoLocation.status.active!==e&&r&&(O.map.removeLayer(r),r=null))),onGeolocationPositionChanged:t=>(function(t){let o=e.geoLocation.zoomToPosition;r&&(O.map.removeLayer(r),o=!1),r=L.circleMarker(L.latLng(t.coords.latitude,t.coords.longitude),{radius:e.geoLocation.radius,color:e.geoLocation.color}).bindTooltip(N().formatLatLng([t.coords.latitude,t.coords.longitude])).addTo(O.map),o&&O.map.setView(L.latLng(t.coords.latitude,t.coords.longitude),e.geoLocation.zoomFactor)})(t)});var s}();function z(){function e(e,t){let n=function(e){return o.notFound<["setitinerary","updateitinerary","settravelnotes","updatetravelnotes","setsearch","updatesearch","expandrouteui","reducerouteui","setwaypointslist","setrouteslist","setprovider","providersadded","settransitmode"].indexOf(e)?document.getElementById("TravelNotes-Control-MainDiv"):o.notFound<["removeobject","removeallobjects","zoomto","additinerarypointmarker","addsearchpointmarker","addrectangle","addwaypoint","layerchange","geolocationstatuschanged","geolocationpositionchanged","routeupdated","routepropertiesupdated","noteupdated","roadbookupdate","travelnotesfileloaded"].indexOf(e)?document:null}(e);if(n){let o=new Event(e);t&&(o.data=t),n.dispatchEvent(o)}}return Object.seal({dispatch:(t,o)=>e(t,o)})}var C={};function H(e){return Math.floor(Math.abs(e)+.5)*(e>=0?1:-1)}function A(e,t,o){var n=(e=H(e*o))-(t=H(t*o));n<<=1,e-t<0&&(n=~n);for(var r="";n>=32;)r+=String.fromCharCode(63+(32|31&n)),n>>=5;return r+=String.fromCharCode(n+63)}function D(e){for(var t=[],o=0;o<e.length;o++)t.push(e[o].slice().reverse());return t}function U(){function e(e){let t={};o.zero!==e.itinerary.itineraryPoints.length&&(t=e.itinerary.itineraryPoints[o.zero].objType);let n={latLngs:[],distances:[],objIds:[],objType:t};e.itinerary.itineraryPoints.forEach(e=>{n.latLngs.push([e.lat,e.lng]),n.distances.push(e.distance),n.objIds.push(e.objId)}),n.latLngs=C.encode(n.latLngs,o.polylinePrecision),e.itinerary.itineraryPoints=n}function t(e){e.itinerary.itineraryPoints.latLngs=C.decode(e.itinerary.itineraryPoints.latLngs,o.polylinePrecision);let t=[],n=o.zero;e.itinerary.itineraryPoints.latLngs.forEach(r=>{let a={};a.lat=r[o.zero],a.lng=r[o.number1],a.distance=e.itinerary.itineraryPoints.distances[n],a.objId=e.itinerary.itineraryPoints.objIds[n],a.objType=e.itinerary.itineraryPoints.objType,t.push(a),n++}),e.itinerary.itineraryPoints=t}function n(e){let o=e;return o.routes.forEach(t),o.editedRoute&&t(o.editedRoute),o}return Object.seal({decompress:e=>(e=e,O.travel.object=n(e),O.editedRouteObjId=o.invalidObjId,void O.travel.routes.forEach(e=>{o.route.edited.notEdited!==e.edited&&(O.editedRouteObjId=e.objId)})),decompressMerge:e=>(function(e){let t=T();t.object=n(e);let o=t.routes.iterator;for(;!o.done;)O.travel.routes.add(o.value);let r=t.notes.iterator;for(;!r.done;)O.travel.notes.add(r.value)})(e),compress:()=>(function(){let t=O.travel.object;return t.routes.forEach(e),e(t.editedRoute),t})()});var r}function F(){let e=z(),t=M(),n=[];function r(e){n.push(e.latLng),n.push(e.iconLatLng)}function a(e){e.itinerary.itineraryPoints.forEach(e=>n.push(e.latLng)),e.notes.forEach(e=>r(e))}return Object.seal({zoomToNote:o=>(o=o,void e.dispatch("zoomto",{latLng:t.getNoteAndRoute(o).note.latLng})),zoomToRoute:o=>(o=o,n=[],a(t.getRoute(o)),void e.dispatch("zoomto",{geometry:[n]})),zoomToTravel:()=>(n=[],O.travel.routes.forEach(e=>a(e)),o.invalidObjId!==O.travel.editedRouteObjId&&a(O.travel.editedRoute),O.travel.notes.forEach(e=>r(e)),void e.dispatch("zoomto",{geometry:[n]}))});var i,l}function S(){let e=z();function t(){let t=O.travel.routes.iterator;for(;!t.done;)o.route.edited.notEdited===t.value.edited&&e.dispatch("routeupdated",{removedRouteObjId:o.invalidObjId,addedRouteObjId:t.value.objId});o.invalidObjId!==O.editedRouteObjId&&e.dispatch("routeupdated",{removedRouteObjId:o.invalidObjId,addedRouteObjId:O.travel.editedRoute.objId});let n=O.travel.notes.iterator;for(;!n.done;)e.dispatch("noteupdated",{removedNoteObjId:o.invalidObjId,addedNoteObjId:n.value.objId});F().zoomToTravel(),e.dispatch("travelnotesfileloaded",{name:O.travel.name})}return Object.seal({openDistantFile:e=>(e=e,U().decompress(e),void t()),display:()=>t()});var n}C.decode=function(e,t){for(var o,n=0,r=0,a=0,i=[],l=0,s=0,d=null,u=Math.pow(10,Number.isInteger(t)?t:5);n<e.length;){d=null,l=0,s=0;do{s|=(31&(d=e.charCodeAt(n++)-63))<<l,l+=5}while(d>=32);o=1&s?~(s>>1):s>>1,l=s=0;do{s|=(31&(d=e.charCodeAt(n++)-63))<<l,l+=5}while(d>=32);r+=o,a+=1&s?~(s>>1):s>>1,i.push([r/u,a/u])}return i},C.encode=function(e,t){if(!e.length)return"";for(var o=Math.pow(10,Number.isInteger(t)?t:5),n=A(e[0][0],0,o)+A(e[0][1],0,o),r=1;r<e.length;r++){var a=e[r],i=e[r-1];n+=A(a[0],i[0],o),n+=A(a[1],i[1],o)}return n},C.fromGeoJSON=function(e,t){if(e&&"Feature"===e.type&&(e=e.geometry),!e||"LineString"!==e.type)throw new Error("Input must be a GeoJSON LineString");return C.encode(D(e.coordinates),t)},C.toGeoJSON=function(e,t){return{type:"LineString",coordinates:D(C.decode(e,t))}},"object"==typeof module&&module.exports&&(module.exports=C);const V=function(){let e=null;function n(t){e.innerHTML='&copy; <a href="http://leafletjs.com/" target="_blank" title="Leaflet">Leaflet</a> '+t+'| &copy; <a href="https://github.com/wwwouaiebe" target="_blank" title="https://github.com/wwwouaiebe">Maps & TravelNotes</a> '}return Object.seal({set attributions(e){n(e)},createUI:()=>(e=t().create("div",{id:"TravelNotes-AttributionsUI"},document.getElementsByTagName("body")[o.zero]),void n(""))})}();const k=function(){let t=o.geoLocation.status.disabled,n=null,r=z();function a(e){r.dispatch("geolocationpositionchanged",{position:e})}function i(){o.geoLocation.status.active===t&&(t=o.geoLocation.status.inactive),r.dispatch("geolocationstatuschanged",{status:t}),navigator.geolocation.clearWatch(n),n=null}function l(e){o.number1===e.code&&(t=o.geoLocation.status.refusedByUser),i()}function s(){switch(t){case o.geoLocation.status.inactive:t=o.geoLocation.status.active,r.dispatch("geolocationstatuschanged",{status:t}),navigator.geolocation.getCurrentPosition(a,l,e.geoLocation.options),n=navigator.geolocation.watchPosition(a,l,e.geoLocation.options);break;case o.geoLocation.status.active:i()}return t}return t="geolocation"in navigator?o.geoLocation.status.inactive:o.geoLocation.status.disabled,Object.seal({get status(){return t},switch:()=>s()})}();const B=function(){let e=null,n=z(),r=t(),a=[{service:"wmts",url:"https://{s}.tile.osm.org/{z}/{x}/{y}.png",name:"OSM - Color",toolbar:{text:"OSM",color:"red",backgroundColor:"white"},providerName:"OSM",providerKeyNeeded:!1,attribution:'| &copy; <a href="http://www.openstreetmap.org/copyright" target="_blank" title="OpenStreetMap contributors">OpenStreetMap contributors</a> '}];function i(e){n.dispatch("layerchange",{layer:e.target.layer}),V.attributions=e.target.layer.attribution}function l(t){r.create("div",{className:"TravelNotes-ViewerLayersToolbarUI-Button",title:t.name,layer:t,innerHTML:t.toolbar.text,style:"color:"+t.toolbar.color+";background-color:"+t.toolbar.backgroundColor},e).addEventListener("click",e=>{e.stopPropagation(),i(e)},i,!1)}return Object.seal({createUI:()=>(e=r.create("div",{id:"TravelNotes-ViewerLayersToolbarUI"},document.getElementsByTagName("body")[o.zero]),r.create("div",{className:"TravelNotes-ViewerLayersToolbarUI-Button",title:"My position",innerHTML:"&#x1f310;",style:"color:black;background-color:white"},e).addEventListener("click",e=>{e.stopPropagation(),k.switch()},!1),r.create("div",{className:"TravelNotes-ViewerLayersToolbarUI-Button",title:"Zoom on the travel",innerHTML:"&#x1f50d;",style:"color:black;background-color:white"},e).addEventListener("click",e=>{e.stopPropagation(),F().zoomToTravel()},!1),void a.forEach(l)),setLayer:e=>(function(e){let t=a.find(t=>t.name===e)||a[o.zero];n.dispatch("layerchange",{layer:t}),V.attributions=t.attribution})(e),setLayers:e=>(e=e,void e.forEach(e=>{e.providerKeyNeeded||a.push(e)}))});var s}();const Z=function(){function e(){document.addEventListener("routeupdated",e=>{e.data&&R.addRoute(e.data.addedRouteObjId)},!1),document.addEventListener("noteupdated",e=>{e.data&&(R.addNote(e.data.addedNoteObjId),function(){if(N().storageAvailable("localStorage")){let e=P("TravelNotes-Roadbook-");localStorage.setItem(O.UUID+"-TravelNotesHTML",e.travelHTML.outerHTML)}}())},!1),document.addEventListener("zoomto",e=>{e.data&&R.zoomTo(e.data.latLng,e.data.geometry)},!1),document.addEventListener("layerchange",e=>{e.data&&R.setLayer(e.data.layer)}),document.addEventListener("geolocationpositionchanged",e=>{e.data&&R.onGeolocationPositionChanged(e.data.position)},!1),document.addEventListener("geolocationstatuschanged",e=>{e.data&&R.onGeolocationStatusChanged(e.data.status)},!1)}return Object.seal({addReadOnlyMap:(t,r)=>(t=t,r=r,e(),V.createUI(),r&&B.createUI(),B.setLayer("OSM - Color"),void(t&&n().getJsonPromise(t).then(S().openDistantFile).catch(e=>{console.log(e||"Not possible to load the .trv file"),O.map.setView([o.latLng.defaultValue,o.latLng.defaultValue],o.number2)})))});var t,r}();!function(){let r=null,a=null,i=!1;decodeURI(window.location.search).substr(o.number1).split("&").forEach(e=>{"fil="===e.substr(o.zero,o.number4).toLowerCase()?a=decodeURIComponent(escape(atob(e.substr(o.number4)))):"lng="===e.substr(o.zero,o.number4).toLowerCase()?r=e.substr(o.number4).toLowerCase():"lay"===e.substr(o.zero,o.number3).toLowerCase()&&(i=!0)}),window.L.travelNotes=Z;let l=n(),s=[l.getJsonPromise(window.location.href.substr(o.zero,window.location.href.lastIndexOf("/")+o.number1)+"TravelNotesConfig.json"),l.getJsonPromise(window.location.href.substr(o.zero,window.location.href.lastIndexOf("/")+o.number1)+"TravelNotes"+(r||e.language).toUpperCase()+".json"),l.getJsonPromise(window.location.href.substr(o.zero,window.location.href.lastIndexOf("/")+o.number1)+"TravelNotesLayers.json")];Promise.all(s).then(n=>{if(r&&(n[o.zero].language=r),e.overload(n[o.zero]),I.setTranslations(n[o.number1]),B.setLayers(n[o.number2]),e.autoLoad){t().create("div",{id:"Map"},document.getElementsByTagName("body")[o.zero]);let e=window.L.map("Map",{attributionControl:!1,zoomControl:!1}).setView([o.latLng.defaultValue,o.latLng.defaultValue],o.zero);O.map=e,Z.addReadOnlyMap(a,i)}}).catch(e=>console.log(e||"An error occurs when downloading the json configuration files"))}()}();