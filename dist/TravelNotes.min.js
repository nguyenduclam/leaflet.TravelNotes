
/*!
leaflet.travelnotes - version 1.7.0 
build 00032 - 2020-01-08T20:18:24+0100 
Copyright 2017 2020 wwwouaiebe 
Contact: http://www.ouaie.be/
Sources: https://github.com/wwwouaiebe/leaflet.TravelNotes 
License: GPL-3.0
*/


!function(){"use strict";let e=function(){let e={autoLoad:!1,map:{center:{lat:50.50923,lng:5.49542},zoom:12},travelNotesToolbarUI:{contactMail:"https://github.com/wwwouaiebe/leaflet.TravelNotes/issues"},layersToolbarUI:{haveLayersToolbarUI:!0,toolbarTimeOut:1500,contactMail:"https://github.com/wwwouaiebe/leaflet.TravelNotes/issues",theDevil:{addButton:!1,title:"Reminder! The devil will know everything about you",text:"&#x1f47f;"}},mouseUI:{haveMouseUI:!0},errorUI:{timeOut:1e4,helpTimeOut:3e4,showError:!0,showWarning:!0,showInfo:!0,showHelp:!0},geoLocation:{color:"red",radius:11,zoomToPosition:!0,zoomFactor:17,options:{enableHighAccuracy:!1,maximumAge:0,timeout:1/0}},APIKeys:{showDialogButton:!0,saveToSessionStorage:!0,showAPIKeysInDialog:!0,dialogHaveUnsecureButtons:!0},contextMenu:{timeout:1500},routing:{auto:!0},language:"fr",itineraryPointMarker:{color:"red",weight:2,radius:7,fill:!1},searchPointMarker:{color:"green",weight:4,radius:20,fill:!1},searchPointPolyline:{color:"green",weight:4,radius:20,fill:!1},previousSearchLimit:{color:"green",fill:!1,weight:1},nextSearchLimit:{color:"red",fill:!1,weight:1},wayPoint:{reverseGeocoding:!1},route:{color:"#ff0000",width:3,dashArray:0,dashChoices:[{text:"——————",iDashArray:null},{text:"— — — — —",iDashArray:[4,2]},{text:"—‧—‧—‧—‧—",iDashArray:[4,2,0,2]},{text:"················",iDashArray:[0,2]}]},note:{reverseGeocoding:!1,grip:{size:10,opacity:0},polyline:{color:"gray",weight:1},style:"",svgIconWidth:200,svgAnleMaxDirection:{right:35,slightRight:80,continue:100,slightLeft:145,left:200,sharpLeft:270,sharpRight:340},svgZoom:17,svgAngleDistance:10,svgHamletDistance:200,svgVillageDistance:400,svgCityDistance:1200,svgTownDistance:1500,svgTimeOut:15e3,cityPrefix:'<span class="TravelNotes-NoteHtml-Address-City">',cityPostfix:"</span>"},itineraryPointZoom:17,routeEditor:{displayEditionInHTMLPage:!0},travelEditor:{clearAfterSave:!0,startMinimized:!0,timeout:1e3,startupRouteEdition:!0},haveBeforeUnloadWarning:!0,overpassApiUrl:"https://lz4.overpass-api.de/api/interpreter",nominatim:{url:"https://nominatim.openstreetmap.org/",language:"*"},haveCrypto:!1};function t(t){!function e(t,o){if("object"==typeof t&&"object"==typeof o)try{for(let a in o)"object"==typeof o[a]?e(t[a],o[a]):o[a]=t[a]||o[a];for(let a in t)"object"==typeof t[a]?("[object Array]"===Object.prototype.toString.call(t[a])?o[a]=o[a]||[]:o[a]=o[a]||{},e(t[a],o[a])):o[a]=t[a]}catch(e){console.log(e||"Not possible to overload Config")}}(t,e),e=function e(t){for(let o in t)"object"==typeof t[o]&&(t[o]=e(t[o]));return Object.freeze(t)}(e)}return{get autoLoad(){return e.autoLoad},get map(){return e.map},get travelNotesToolbarUI(){return e.travelNotesToolbarUI},get layersToolbarUI(){return e.layersToolbarUI},get mouseUI(){return e.mouseUI},get errorUI(){return e.errorUI},get APIKeys(){return e.APIKeys},get contextMenu(){return e.contextMenu},get routing(){return e.routing},get language(){return e.language},get itineraryPointMarker(){return e.itineraryPointMarker},get searchPointMarker(){return e.searchPointMarker},get searchPointPolyline(){return e.searchPointPolyline},get previousSearchLimit(){return e.previousSearchLimit},get nextSearchLimit(){return e.nextSearchLimit},get wayPoint(){return e.wayPoint},get route(){return e.route},get note(){return e.note},get itineraryPointZoom(){return e.itineraryPointZoom},get routeEditor(){return e.routeEditor},get travelEditor(){return e.travelEditor},get haveBeforeUnloadWarning(){return e.haveBeforeUnloadWarning},get overpassApiUrl(){return e.overpassApiUrl},get nominatim(){return e.nominatim},get geoLocation(){return e.geoLocation},get haveCrypto(){return e.haveCrypto},overload:e=>t(e)}}();function t(){return Object.seal({create:(e,t,o)=>(function(e,t,o){let a=null;if(a="text"===e.toLowerCase()?document.createTextNode(""):document.createElement(e),o&&o.appendChild(a),t)for(let e in t)try{a[e]=t[e]}catch(t){console.log("Invalid property : "+e)}return a})(e,t,o)})}const o={angle:{degree0:0,degree90:90,degree180:180,degree270:270,degree360:360,degree540:540},baseContextMenu:{menuMargin:20},baseDialog:{dragMargin:20},colorDialog:{maxColorValue:255,linColorValue:0,colorRowsNumber:6,deltaColor:51},collection:{swapUp:-1,swapDown:1,direction:{next:1,previous:-1}},distance:{mInKm:1e3,round:10,fixed:2,invalid:-1,defaultValue:0},dataPanesUI:{invalidPane:-1,itineraryPane:0,travelNotesPane:1,searchPane:2},geoLocation:{status:{refusedByUser:-1,disabled:0,inactive:1,active:2}},hexadecimal:16,htmlViewsFactory:{linksMaxLength:40,minNotesDistance:9},invalidObjId:-1,layersToolbarUI:{buttonsAlwaysVisible:3},latLng:{defaultValue:0,fixed:6,maxLat:90,minLat:-90,maxLng:180,minLng:-180},mapEditor:{defaultMaxZoom:18,defaultMinZoom:0,wayPointIconSize:40,markerBoundsPrecision:.01},mouse:{wheelCorrectionFactors:[.3,10,1]},note:{defaultIconSize:40,zIndexOffset:100},notFound:-1,numberMinus1:-1,number1:1,number2:2,number3:3,number4:4,number5:5,number16:16,number65536:65536,passwordDialog:{pswdMinLength:12},polylinePrecision:6,route:{edited:{notEdited:0,editedNoChange:1,editedChanged:2},minWidth:1,maxWidth:40},svgIcon:{positionOnRoute:{atStart:-1,onRoute:0,atEnd:1},width:40,height:40},svgIconFromOsmFactory:{comparePrecision:1e-5,searchAroundFactor:1.5},time:{secondInDay:86400,secondInHour:3600,secondInMinut:60},xmlHttpRequest:{status:{ok:200},readyState:{done:4},timeout:2e4},zero:0};function a(){return{getJsonPromise:(e,t)=>(e=e,t=t,new Promise(function(a,n){let r=new XMLHttpRequest;r.timeout=o.xmlHttpRequest.timeout,r.ontimeout=function(){n("XMLHttpRequest TimeOut. File : "+r.responseURL)},r.onreadystatechange=function(){if(o.xmlHttpRequest.readyState.done===r.readyState)if(o.xmlHttpRequest.status.ok===r.status){let e=null;try{e=JSON.parse(r.responseText)}catch(e){n(e.message+" File: "+r.responseURL)}a(e)}else n("Error XMLHttpRequest - File : "+r.responseURL)},r.open("GET",e,!0),t&&t.forEach(e=>r.setRequestHeader(e.headerName,e.headerValue)),r.overrideMimeType("application/json"),r.send(null)})),getBinaryPromise:(e,t)=>(function(e,t){return new Promise(function(a,n){let r=new XMLHttpRequest;r.timeout=o.xmlHttpRequest.timeout,r.ontimeout=function(){n("XMLHttpRequest TimeOut. File : "+r.responseURL)},r.onload=function(){if(o.xmlHttpRequest.status.ok===r.status){let e=r.response;e?a(e):n("Error XMLHttpRequest - File : "+r.responseURL)}else n("Error XMLHttpRequest - File : "+r.responseURL)},r.open("GET",e,!0),t&&t.forEach(e=>r.setRequestHeader(e.headerName,e.headerValue)),r.responseType="arraybuffer",r.send(null)})})(e,t)};var e,t}let n=o.zero;function r(){return++n}const i="1.7.0";function l(e){const t=e,o=i;return Object.seal({get name(){return t},get version(){return o},get object(){return{name:t,version:o}},validate:e=>(function(e){if(!Object.getOwnPropertyNames(e).includes("name"))throw new Error("No name for "+t);if(t!==e.name)throw new Error("Invalid name for "+t);if(!Object.getOwnPropertyNames(e).includes("version"))throw new Error("No version for "+t)})(e)})}const s=l("WayPoint");function d(){let e="",t=o.latLng.defaultValue,a=o.latLng.defaultValue,n=r();function i(i){let l=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+s.name);if(s.validate(e.objType),s.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":e.objType.version="1.7.0";break;default:throw new Error("invalid version for "+s.name)}let t=Object.getOwnPropertyNames(e);return["name","lat","lng","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+s.name)}),e}(i);e=l.name||"",t=l.lat||o.latLng.defaultValue,a=l.lng||o.latLng.defaultValue,n=r()}return Object.seal({get name(){return e},set name(t){e=t},get lat(){return t},set lat(e){t=e},get lng(){return a},set lng(e){a=e},get latLng(){return[t,a]},set latLng(e){t=e[o.zero],a=e[o.number1]},get objId(){return n},get objType(){return s},get object(){return{name:e,lat:parseFloat(t.toFixed(o.latLng.fixed)),lng:parseFloat(a.toFixed(o.latLng.fixed)),objId:n,objType:s.object}},set object(e){i(e)}})}const c=l("Itinerary");function u(){let e="",t="",a=y("ItineraryPoint"),n=y("Maneuver"),i=r();function l(l){let s=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+c.name);if(c.validate(e.objType),c.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":e.objType.version="1.7.0";break;default:throw new Error("invalid version for "+c.name)}let t=Object.getOwnPropertyNames(e);return["itineraryPoints","maneuvers","provider","transitMode","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+c.name)}),e}(l);a.object=s.itineraryPoints||[],n.object=s.maneuvers||[],e=s.provider||"",t=s.transitMode||"",i=r();let d=new Map,u=o.zero,v=a.iterator;for(;!v.done;)d.set(s.itineraryPoints[u].objId,v.value.objId),u++;let g=n.iterator;for(;!g.done;)g.value.itineraryPointObjId=d.get(g.value.itineraryPointObjId)}return Object.seal({get itineraryPoints(){return a},get maneuvers(){return n},get provider(){return e},set provider(t){e=t},get transitMode(){return t},set transitMode(e){t=e},get objId(){return i},get objType(){return c},get object(){return{itineraryPoints:a.object,maneuvers:n.object,provider:e,transitMode:t,objId:i,objType:c.object}},set object(e){l(e)}})}const v=l("Route");function g(){let t="",a=y("WayPoint");a.add(d()),a.add(d());let n=y("Note"),i=u(),l=e.route.width,s=e.route.color,c=e.route.dashArray,g=!1,m=o.distance.defaultValue,p=o.distance.defaultValue,h=o.distance.defaultValue,b=o.route.edited.notEdited;let f=!1,T=r();function N(d){let y=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+v.name);if(v.validate(e.objType),v.version!==e.objType.version)switch(e.objType.version){case"1.0.0":e.dashArray=o.zero,e.hidden=!1;case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":e.edited=o.route.edited.notEdited;case"1.5.0":case"1.6.0":e.objType.version="1.7.0";break;default:throw new Error("invalid version for "+v.name)}let t=Object.getOwnPropertyNames(e);return["name","wayPoints","notes","itinerary","width","color","dashArray","chain","distance","duration","edited","hidden","chainedDistance","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+v.name)}),e}(d);t=y.name||"",a.object=y.wayPoints||[],n.object=y.notes||[],i.object=y.itinerary||u().object,l=y.width||e.route.width,s=y.color||"#000000",c=y.dashArray||o.zero,g=y.chain||!1,p=y.distance,h=y.duration,b=y.edited||o.route.edited.notEdited,f=y.hidden||!1,m=y.chainedDistance,T=r()}return Object.seal({get wayPoints(){return a},get itinerary(){return i},get notes(){return n},get name(){return t},set name(e){t=e},get width(){return l},set width(e){l=e},get color(){return s},set color(e){s=e},get dashArray(){return c},set dashArray(e){c=e},get chain(){return g},set chain(e){g=e},get chainedDistance(){return m},set chainedDistance(e){m=e},get distance(){return p},set distance(e){p=e},get duration(){return h},set duration(e){h=e},get edited(){return b},set edited(e){!function(e){if("number"!=typeof e||o.route.edited.notEdited>e||o.route.edited.editedChanged<e)throw new Error("Invalid value for Route.edited : "+e);b=e}(e)},get hidden(){return f},set hidden(e){f=e},get objId(){return T},get objType(){return v},get object(){return{name:t,wayPoints:a.object,notes:n.object,itinerary:i.object,width:l,color:s,dashArray:c,chain:g,distance:parseFloat(p.toFixed(o.distance.fixed)),duration:h,edited:b,hidden:f,chainedDistance:parseFloat(m.toFixed(o.distance.fixed)),objId:T,objType:v.object}},set object(e){N(e)}})}const m=l("Note");function p(){let e=r(),t=o.note.defaultIconSize,a=o.note.defaultIconSize,n="",i="",l="",s="",d="",c="",u=o.latLng.defaultValue,v=o.latLng.defaultValue,g=o.latLng.defaultValue,p=o.latLng.defaultValue,h=o.distance.invalid,b=o.distance.defaultValue;function f(f){let T=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+m.name);if(m.validate(e.objType),m.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":e.objType.version="1.7.0";break;default:throw new Error("invalid version for "+m.name)}let t=Object.getOwnPropertyNames(e);return["iconHeight","iconWidth","iconContent","popupContent","tooltipContent","phone","url","address","iconLat","iconLng","lat","lng","distance","chainedDistance","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+m.name)}),e}(f);t=T.iconHeight||o.note.defaultIconSize,a=T.iconWidth||o.note.defaultIconSize,n=T.iconContent||"",i=T.popupContent||"",l=T.tooltipContent||"",s=T.phone||"",d=T.url||"",c=T.address||"",u=T.iconLat||o.latLng.defaultValue,v=T.iconLng||o.latLng.defaultValue,g=T.lat||o.latLng.defaultValue,p=T.lng||o.latLng.defaultValue,h=T.distance||o.distance.invalid,b=T.chainedDistance,e=r()}return Object.seal({get isRouteNote(){return h!==o.distance.invalid},get iconHeight(){return t},set iconHeight(e){t=e},get iconWidth(){return a},set iconWidth(e){a=e},get iconContent(){return n},set iconContent(e){n=e},get popupContent(){return i},set popupContent(e){i=e},get tooltipContent(){return l},set tooltipContent(e){l=e},get phone(){return s},set phone(e){s=e},get url(){return d},set url(e){d=e},get address(){return c},set address(e){c=e},get iconLat(){return u},set iconLat(e){u=e},get iconLng(){return v},set iconLng(e){v=e},get iconLatLng(){return[u,v]},set iconLatLng(e){u=e[o.zero],v=e[o.number1]},get lat(){return g},set lat(e){g=e},get lng(){return p},set lng(e){p=e},get latLng(){return[g,p]},set latLng(e){g=e[o.zero],p=e[o.number1]},get distance(){return h},set distance(e){h=e},get chainedDistance(){return b},set chainedDistance(e){b=e},get objId(){return e},get objType(){return m},get object(){return{iconHeight:t,iconWidth:a,iconContent:n,popupContent:i,tooltipContent:l,phone:s,url:d,address:c,iconLat:parseFloat(u.toFixed(o.latLng.fixed)),iconLng:parseFloat(v.toFixed(o.latLng.fixed)),lat:parseFloat(g.toFixed(o.latLng.fixed)),lng:parseFloat(p.toFixed(o.latLng.fixed)),distance:parseFloat(h.toFixed(o.distance.fixed)),chainedDistance:parseFloat(b.toFixed(o.distance.fixed)),objId:e,objType:m.object}},set object(e){f(e)}})}const h=l("Maneuver");function b(){let e=r(),t="",a="",n=-1,i=o.distance.defaultValue,l=o.distance.defaultValue;function s(s){let d=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+h.name);if(h.validate(e.objType),h.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":e.objType.version="1.7.0";break;default:throw new Error("invalid version for "+h.name)}let t=Object.getOwnPropertyNames(e);return["iconName","instruction","distance","duration","itineraryPointObjId","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+h.name)}),e}(s);t=d.iconName||"",a=d.instruction||"",i=d.distance||o.distance.defaultValue,l=d.duration||o.distance.defaultValue,n=d.itineraryPointObjId||o.invalidObjId,e=r()}return Object.seal({get iconName(){return t},set iconName(e){t=e},get instruction(){return a},set instruction(e){a=e},get itineraryPointObjId(){return n},set itineraryPointObjId(e){n=e},get distance(){return i},set distance(e){i=e},get duration(){return l},set duration(e){l=e},get objId(){return e},get objType(){return h},get object(){return{iconName:t,instruction:a,distance:parseFloat(i.toFixed(o.distance.fixed)),duration:l,itineraryPointObjId:n,objId:e,objType:h.object}},set object(e){s(e)}})}const f=l("ItineraryPoint");function T(){let e=o.latLng.defaultValue,t=o.latLng.defaultValue,a=o.distance.defaultValue,n=r();function i(i){let l=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+f.name);if(f.validate(e.objType),f.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":e.objType.version="1.7.0";break;default:throw new Error("invalid version for "+f.name)}let t=Object.getOwnPropertyNames(e);return["lat","lng","distance","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+f.name)}),e}(i);e=l.lat||o.latLng.defaultValue,t=l.lng||o.latLng.defaultValue,a=l.distance||o.distance.defaultValue,n=r()}return Object.seal({get lat(){return e},set lat(t){e=t},get lng(){return t},set lng(e){t=e},get latLng(){return[e,t]},set latLng(a){e=a[o.zero],t=a[o.number1]},get distance(){return a},set distance(e){a=e},get objId(){return n},get objType(){return f},get object(){return{lat:parseFloat(e.toFixed(o.latLng.fixed)),lng:parseFloat(t.toFixed(o.latLng.fixed)),distance:parseFloat(a.toFixed(o.distance.fixed)),objId:n,objType:f.object}},set object(e){i(e)}})}function y(e){let t=[],a=e;function n(e){if(!e.objType||!e.objType.name||e.objType.name!==a)throw new Error("invalid object name for add function");t.push(e)}function r(){let e=o.notFound;return{get value(){return e<t.length?t[e]:null},get done(){return++e>=t.length},get first(){return o.zero===e},get last(){return e>=t.length-o.number1},get index(){return e}}}function i(e){return t.findIndex(t=>t.objId===e)}function l(e,a,n){let r=i(e);if(o.notFound===r)throw new Error("invalid objId for next or previous function");let l=a;for(l||(l=(()=>!0)),r+=n;o.notFound<r&&r<t.length&&!l(t[r]);)r+=n;return o.notFound===r||t.length===r?null:t[r]}return Object.seal({add:e=>n(e),forEach:e=>(function(e){let t=null,o=r();for(;!o.done;)t=e(o.value,t);return t})(e),getAt:e=>(function(e){let a=i(e);return o.notFound===a?null:t[a]})(e),moveTo:(e,a,n)=>(function(e,a,n){let r=i(e),l=i(a);n||l++,t.splice(l,o.zero,t[r]),l<r&&r++,t.splice(r,o.number1)})(e,a,n),next:(e,t)=>l(e,t,o.collection.direction.next),previous:(e,t)=>l(e,t,o.collection.direction.previous),remove:e=>(function(e){let a=i(e);if(o.notFound===a)throw new Error("invalid objId for remove function");t.splice(i(e),o.number1)})(e),removeAll:e=>(c=e,void(c?t.splice(o.number1,t.length-o.number2):t.length=o.zero)),replace:(e,a)=>(function(e,a){let n=i(e);if(o.notFound===n)throw new Error("invalid objId for replace function");t[n]=a})(e,a),reverse:()=>void t.reverse(),sort:e=>(e=e,void t.sort(e)),swap:(e,a)=>(function(e,a){let n=i(e);if(o.notFound===n||o.zero===n&&a||t.length-o.number1===n&&!a)throw new Error("invalid objId for swap function");let r=t[n];t[n]=t[n+(a?o.collection.swapUp:o.collection.swapDown)],t[n+(a?o.collection.swapUp:o.collection.swapDown)]=r})(e,a),get first(){return t[o.zero]},get iterator(){return r()},get last(){return t[t.length-o.number1]},get length(){return t.length},get object(){return function(){let e=[],t=r();for(;!t.done;)e.push(t.value.object);return e}()},set object(e){!function(e){t.length=o.zero;let r=null;e.forEach(e=>{switch(a){case"Route":r=g();break;case"Note":r=p();break;case"WayPoint":r=d();break;case"Maneuver":r=b();break;case"ItineraryPoint":r=T();break;default:throw new Error("invalid ObjName ( "+a+" ) in Collection.mySetObject")}r.object=e,n(r)})}(e)}});var s,c}const N=l("Travel");function I(){let e=g(),t="OSM - Color",o="TravelNotes",a=y("Route"),n=y("Note"),i=r(),l=!1,s={};function d(d){let c=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+N.name);if(N.validate(e.objType),N.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":e.editedRoute=g();case"1.5.0":if(e.userData.layerId){let t=[{layerId:"0",layerName:"OSM - Color"},{layerId:"1",layerName:"OSM - Black and White"},{layerId:"2",layerName:"Thunderforest - Transport"},{layerId:"3",layerName:"Thunderforest - OpenCycleMap"},{layerId:"4",layerName:"Thunderforest - Outdoors"},{layerId:"5",layerName:"Esri - Aerial view"},{layerId:"6",layerName:"Kartverket - Norway"},{layerId:"7",layerName:"IGN-NGI - Belgium now"},{layerId:"12",layerName:"Thunderforest - Landscape"},{layerId:"24",layerName:"Lantmäteriet - Sweden"},{layerId:"25",layerName:"Maanmittauslaitos - Finland"}].find(t=>t.layerId===e.userData.layerId);e.layerName=t?t.layerName:"OSM - Color"}else e.layerName="OSM - Color";case"1.6.0":e.objType.version="1.7.0";break;default:throw new Error("invalid version for "+N.name)}let t=Object.getOwnPropertyNames(e);return["name","editedRoute","routes","userData","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+N.name)}),e}(d);e.object=c.editedRoute,t=d.layerName||"OSM - Color",o=c.name||"",s=c.userData||{},l=c.readOnly||!1,a.object=c.routes||[],n.object=c.notes||[],i=r()}return Object.seal({get editedRoute(){return e},set editedRoute(t){e=t},get routes(){return a},get notes(){return n},get layerName(){return t},set layerName(e){t=e},get name(){return o},set name(e){o=e},get readOnly(){return l},set readOnly(e){l=e},get userData(){return s},set userData(e){s=e},get objId(){return i},get objType(){return N},get object(){return{editedRoute:e.object,layerName:t,name:o,routes:a.object,notes:n.object,userData:s,readOnly:l,objId:i,objType:N.object}},set object(e){d(e)}})}const w=function(){let e=new Map;return{setTranslations:t=>(t=t,void t.forEach(t=>e.set(t.msgid,t.msgstr))),getText:(t,o)=>(function(t,o){let a=e.get(t);return o&&a&&Object.getOwnPropertyNames(o).forEach(e=>a=a.replace("{"+e+"}",o[e])),a||t})(t,o)};var t}();function E(){function e(e){return e>o.zero?e.toFixed(o.latLng.fixed)+" N":(-e).toFixed(o.latLng.fixed)+" S"}function t(e){return e>o.zero?e.toFixed(o.latLng.fixed)+" E":(-e).toFixed(o.latLng.fixed)+" W"}return Object.seal({get UUID(){return function(){function e(){return Math.floor((o.number1+Math.random())*o.number65536).toString(o.hexadecimal).substring(o.number1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}()},storageAvailable:e=>(function(e){try{let t=window[e],o="__storage_test__";return t.setItem(o,o),t.removeItem(o),!0}catch(e){return!1}})(e),fileAPIAvailable:()=>(function(){try{return new File(["testdata"],{type:"text/plain"}),!0}catch(e){return!!window.navigator.msSaveOrOpenBlob}})(),saveFile:(e,t,o)=>(function(e,t,o){if(window.navigator.msSaveOrOpenBlob)try{window.navigator.msSaveOrOpenBlob(new Blob([t]),e)}catch(e){console.log(e||"An error occurs when saving file")}else try{let a=window.URL.createObjectURL(new File([t],{type:o||"text/plain"})),n=document.createElement("a");n.setAttribute("href",a),n.setAttribute("download",e),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(a)}catch(e){console.log(e||"An error occurs when saving file")}})(e,t,o),formatTime:e=>(function(e){let t=Math.floor(e);if(o.zero===t)return"";let a=Math.floor(t/o.time.secondInDay),n=Math.floor(t%o.time.secondInDay/o.time.secondInHour),r=Math.floor(t%o.time.secondInHour/o.time.secondInMinut),i=Math.floor(t%o.time.secondInMinut);return o.zero<a?a+" "+w.getText("Utilities - Day")+" "+n+" "+w.getText("Utilities - Hour"):o.zero<n?n+" "+w.getText("Utilities - Hour")+" "+r+" "+w.getText("Utilities - Minute"):o.zero<r?r+" "+w.getText("Utilities - Minute"):i+" "+w.getText("Utilities - Second")})(e),formatDistance:e=>(function(e){let t=Math.floor(e);return o.zero===t?"":Math.floor(t/o.distance.mInKm)+","+Math.floor(t%o.distance.mInKm/o.distance.round).toFixed(o.zero).padStart(o.number2,"0").padEnd(o.number3,"0")+" km"})(e),formatLat:t=>e(t),formatLng:e=>t(e),formatLatLng:a=>(a=a,o.zero===a[o.zero]&&o.zero===a[o.number1]?"":e(a[o.zero])+" - "+t(a[o.number1]))});var a}const C=function(){let e={map:null,providers:new Map,mapObjects:new Map,travel:I(),editedRouteObjId:o.invalidObjId,routing:Object.seal({provider:"",transitMode:""}),searchData:[],UUID:E().UUID};return Object.seal({get map(){return e.map},set map(t){e.map=t},get providers(){return e.providers},get mapObjects(){return e.mapObjects},get travel(){return e.travel},set travel(t){e.travel=t},get editedRouteObjId(){return e.editedRouteObjId},set editedRouteObjId(t){e.editedRouteObjId=t},get routeEdition(){return e.routeEdition},get routing(){return e.routing},get searchData(){return e.searchData},set searchData(t){e.searchData=t},get UUID(){return e.UUID}})}();const A=function(){let a=null,n=null,r=null,i=null,l=null,s=e.errorUI.showHelp,d=t();function c(){s=!r.checked}function u(){n&&(clearTimeout(n),n=null),a.classList.remove("TravelNotes-ErrorUI-Error"),a.classList.remove("TravelNotes-ErrorUI-Warning"),a.classList.remove("TravelNotes-ErrorUI-Info"),a.classList.remove("TravelNotes-ErrorUI-Help"),a.classList.add("TravelNotes-ErrorUI-Hidden"),r&&(r.removeEventListener("change",c,!1),r=null,i=null),a.innerHTML=""}function v(t,o){if("Error"===o&&!e.errorUI.showError||"Warning"===o&&!e.errorUI.showWarning||"Info"===o&&!e.errorUI.showInfo||"Help"===o&&!e.errorUI.showHelp||"Help"===o&&!s)return;n&&u();let v=d.create("div",{id:"TravelNotes-ErrorUI-Header"},a);(l=d.create("span",{id:"TravelNotes-ErrorUI-CancelButton",innerHTML:"&#x274c"},v)).addEventListener("click",u,!1),d.create("div",{id:"TravelNotes-ErrorUI-Message",innerHTML:t},a),a.classList.add("TravelNotes-ErrorUI-"+o);let g=e.errorUI.timeOut;"Help"===o&&(i=d.create("div",{id:"TravelNotes-ErrorUI-HelpInputDiv"},a),(r=d.create("input",{id:"TravelNotes-ErrorUI-HelpInput",type:"checkbox"},i)).addEventListener("change",c,!1),d.create("label",{id:"TravelNotes-ErrorUI-HelpInputLabel",for:"TravelNotes-ErrorUI-HelpInput",innerHTML:w.getText("ErrorUI - Dont show again")},i),g=e.errorUI.helpTimeOut),a.classList.remove("TravelNotes-ErrorUI-Hidden"),n=setTimeout(u,g)}return{createUI:()=>void(document.getElementById("TravelNotes-ErrorUI")||(a=d.create("div",{id:"TravelNotes-ErrorUI",className:"TravelNotes-ErrorUI-Hidden"},document.getElementsByTagName("body")[o.zero]))),showError:e=>v(e,"Error"),showWarning:e=>v(e,"Warning"),showInfo:e=>v(e,"Info"),showHelp:e=>v(e,"Help")}}();function x(){return Object.seal({getRoute:e=>(function(e){let t=null;return(t=C.travel.routes.getAt(e))||e===C.travel.editedRoute.objId&&(t=C.travel.editedRoute),t})(e),getNoteAndRoute:e=>(function(e){let t=null;if(t=C.travel.notes.getAt(e))return{note:t,route:null};let o=C.travel.routes.iterator;for(;!o.done;)if(t=o.value.notes.getAt(e))return{note:t,route:o.value};return(t=C.travel.editedRoute.notes.getAt(e))?{note:t,route:C.travel.editedRoute}:{note:null,route:null}})(e),getWayPoint:e=>(function(e){let t=null,o=C.travel.routes.iterator;for(;!o.done;)if(t=o.value.wayPoints.getAt(e))return t;return(t=C.travel.editedRoute.wayPoints.getAt(e))||null})(e)})}function j(){let e=o.zero,a=o.zero,n=o.zero,r=o.zero,i=o.zero,l=o.zero,s=null,d=null,c=null,u=null,v=null,g=null,m=null,p=null,h=null,b=t(),f=null,T=null,y=null,N=null,L=null,I=null;function E(e){if("Escape"===e.key||"Esc"===e.key){if(y&&!y())return;document.removeEventListener("keydown",E,!0),document.getElementsByTagName("body")[o.zero].removeChild(s),I("Canceled by user")}}function C(e,t){L=e,I=t,document.getElementsByTagName("body")[o.zero].appendChild(s),document.addEventListener("keydown",E,!0),i=s.clientWidth,l=s.clientHeight,function(){n=(i-d.clientWidth)/o.number2,r=(l-d.clientHeight)/o.number2,n=Math.min(Math.max(n,o.baseDialog.dragMargin),i-d.clientWidth-o.baseDialog.dragMargin),r=Math.max(r,o.baseDialog.dragMargin);let e=l-Math.max(r,o.zero)-o.baseDialog.dragMargin;d.setAttribute("style","top:"+r+"px;left:"+n+"px;max-height:"+e+"px;")}(),N&&N()}return(s=b.create("div",{className:"TravelNotes-BaseDialog-BackgroundDiv"})).addEventListener("dragover",()=>null,!1),s.addEventListener("drop",()=>null,!1),d=b.create("div",{className:"TravelNotes-BaseDialog-Container"},s),function(){let t=b.create("div",{className:"TravelNotes-BaseDialog-TopBar",draggable:!0},d);b.create("div",{innerHTML:"&#x274c",className:"TravelNotes-BaseDialog-CancelButton",title:w.getText("BaseDialog - Cancel")},t).addEventListener("click",()=>{T&&!T()||(document.removeEventListener("keydown",E,!0),document.getElementsByTagName("body")[o.zero].removeChild(s),I("Canceled by user"))},!1),t.addEventListener("dragstart",t=>{try{t.dataTransfer.setData("Text","1")}catch(e){console.log(e)}e=t.screenX,a=t.screenY},!1),t.addEventListener("dragend",t=>{n+=t.screenX-e,r+=t.screenY-a,n=Math.min(Math.max(n,o.baseDialog.dragMargin),i-d.clientWidth-o.baseDialog.dragMargin),r=Math.max(r,o.baseDialog.dragMargin);let s=l-Math.max(r,o.zero)-o.baseDialog.dragMargin;d.setAttribute("style","top:"+r+"px;left:"+n+"px;max-height:"+s+"px;")},!1)}(),c=b.create("div",{className:"TravelNotes-BaseDialog-HeaderDiv"},d),u=b.create("div",{className:"TravelNotes-BaseDialog-ContentDiv"},d),v=b.create("div",{className:"TravelNotes-BaseDialog-ErrorDiv TravelNotes-BaseDialog-ErrorDivHidden"},d),g=b.create("div",{className:"TravelNotes-BaseDialog-FooterDiv"},d),(h=b.create("div",{innerHTML:"&#x1f197;",className:"TravelNotes-BaseDialog-Button TravelNotes-BaseDialog-OkButton TravelNotes-BaseDialog-OkButton-Visible"},g)).addEventListener("click",()=>{let e=null;f&&!(e=f())||(document.removeEventListener("keydown",E,!0),document.getElementsByTagName("body")[o.zero].removeChild(s),L(e))},!1),p=b.create("div",{className:"TravelNotes-BaseDialog-SearchWaitBullet TravelNotes-BaseDialog-SearchWait-Hidden"},m=b.create("div",{className:"TravelNotes-BaseDialog-SearchWait TravelNotes-BaseDialog-SearchWait-Hidden"},g)),Object.seal({set okButtonListener(e){f=e},set cancelButtonListener(e){T=e},set escapeKeyListener(e){y=e},set onShow(e){N=e},showError:e=>(e=e,v.innerHTML=e,v.classList.remove("TravelNotes-BaseDialog-ErrorDivHidden"),void v.classList.add("TravelNotes-BaseDialog-ErrorDivVisible")),hideError:()=>(v.innerHTML="",v.classList.add("TravelNotes-BaseDialog-ErrorDivHidden"),void v.classList.remove("TravelNotes-BaseDialog-ErrorDivVisible")),showWait:()=>(p.classList.remove("TravelNotes-BaseDialog-SearchWait-Hidden"),p.classList.add("TravelNotes-BaseDialog-SearchWait-Visible"),m.classList.remove("TravelNotes-BaseDialog-SearchWait-Hidden"),m.classList.add("TravelNotes-BaseDialog-SearchWait-Visible"),h.classList.remove("TravelNotes-BaseDialog-OkButton-Visible"),void h.classList.add("TravelNotes-BaseDialog-OkButton-Hidden")),hideWait:()=>(p.classList.remove("TravelNotes-BaseDialog-SearchWait-Visible"),p.classList.add("TravelNotes-BaseDialog-SearchWait-Hidden"),m.classList.remove("TravelNotes-BaseDialog-SearchWait-Visible"),m.classList.add("TravelNotes-BaseDialog-SearchWait-Hidden"),h.classList.remove("TravelNotes-BaseDialog-OkButton-Hidden"),void h.classList.add("TravelNotes-BaseDialog-OkButton-Visible")),get title(){return c.innerHTML},set title(e){c.innerHTML=e},get header(){return c},set header(e){c=e},get content(){return u},set content(e){u=e},get footer(){return g},set footer(e){g=e},get okButton(){return h},show:()=>new Promise(C)});var A}function D(a){let n=t(),r=null,i=null,l=null,s=null,d=null;function c(){return a.color=document.getElementById("TravelNotes-ColorDialog-ColorSampleDiv").color,a.width=parseInt(l.value),a.chain=s.checked,a.dashArray=d.selectedIndex,a}return(r=function(e){let a=null,n=null,r=e,i=null,l=null,s=null,d=null,c=t();function u(e){return{red:parseInt(e.substr(o.number1,o.number2),o.hexadecimal),green:parseInt(e.substr(o.number3,o.number2),o.hexadecimal),blue:parseInt(e.substr(o.number5,o.number2),o.hexadecimal)}}function v(e,t,a){return"#"+parseInt(e).toString(o.hexadecimal).padStart(o.number2,"0")+parseInt(t).toString(o.hexadecimal).padStart(o.number2,"0")+parseInt(a).toString(o.hexadecimal).padStart(o.number2,"0")}function g(e){let t=u(r=e.target.colorValue);i.value=t.red,l.value=t.green,s.value=t.blue,d.setAttribute("style","background-color:"+e.target.colorValue+";"),d.color=r}function m(e){let t=e.target.redValue,a=o.colorDialog.maxColorValue,n=o.colorDialog.maxColorValue,r=o.zero;for(;++r<=o.colorDialog.colorRowsNumber;){let e=o.zero;for(a=o.colorDialog.maxColorValue;++e<=o.colorDialog.colorRowsNumber;){let i=document.getElementById("TravelNotes-ColorDialog-CellColorDiv"+r+e);i.colorValue=v(t,a,n),i.setAttribute("style","background-color:"+v(t,a,n)),a-=o.colorDialog.deltaColor}n-=o.colorDialog.deltaColor}}function p(){r=v(i.value,l.value,s.value),d.setAttribute("style","background-color:"+r+";"),d.color=r}return(a=j()).title=w.getText("ColorDialog - Colors"),n=c.create("div",{className:"TravelNotes-ColorDialog-ColorDiv",id:"TravelNotes-ColorDialog-ColorDiv"},a.content),function(){let e=c.create("div",{className:"TravelNotes-ColorDialog-ButtonsDiv",id:"TravelNotes-ColorDialog-ButtonsDiv"},n),t=o.colorDialog.maxColorValue,a=o.colorDialog.maxColorValue,r=o.colorDialog.maxColorValue,i=o.zero;for(;++i<=o.colorDialog.colorRowsNumber+o.number1;){let n=c.create("div",{className:"TravelNotes-ColorDialog-RowColorDiv",id:"TravelNotes-ColorDialog-RowColorDiv"+i},e),l=o.zero;for(a=o.colorDialog.maxColorValue;++l<=o.colorDialog.colorRowsNumber;){let e=c.create("div",{className:"TravelNotes-ColorDialog-CellColorDiv",id:"TravelNotes-ColorDialog-CellColorDiv"+i+l},n);if(i<=o.colorDialog.colorRowsNumber)e.setAttribute("style","background-color:"+v(t,a,r)),e.colorValue=v(t,a,r),e.addEventListener("click",g,!1),a-=o.colorDialog.deltaColor;else{t=(l-o.number1)*o.colorDialog.deltaColor;let a=v(o.colorDialog.maxColorValue,t,t);e.setAttribute("style","background-color:"+a),e.redValue=o.colorDialog.maxColorValue-t,e.addEventListener("click",m,!1)}}r-=o.colorDialog.deltaColor}}(),function(){let e=c.create("div",{className:"TravelNotes-ColorDialog-DataDiv",id:"TravelNotes-ColorDialog-DataDiv"},n);c.create("text",{data:w.getText("ColorDialog - Red")},e),(i=c.create("input",{type:"number",className:"TravelNotes-ColorDialog-NumberInput",id:"TravelNotes-ColorDialog-RedInput"},e)).value=u(r).red,i.min=o.colorDialog.minColorValue,i.max=o.colorDialog.maxColorValue,i.addEventListener("input",p,!1),c.create("text",{data:w.getText("ColorDialog - Green")},e),(l=c.create("input",{type:"number",className:"TravelNotes-ColorDialog-NumberInput",id:"TravelNotes-ColorDialog-GreenInput"},e)).value=u(r).green,l.min=o.colorDialog.minColorValue,l.max=o.colorDialog.maxColorValue,l.addEventListener("input",p,!1),c.create("text",{data:w.getText("ColorDialog - Blue")},e),(s=c.create("input",{type:"number",className:"TravelNotes-ColorDialog-NumberInput",id:"TravelNotes-ColorDialog-BlueInput"},e)).value=u(r).blue,s.min=o.colorDialog.minColorValue,s.max=o.colorDialog.maxColorValue,s.addEventListener("input",p,!1)}(),(d=c.create("div",{className:"TravelNotes-ColorDialog-ColorSampleDiv",id:"TravelNotes-ColorDialog-ColorSampleDiv"},n)).setAttribute("style","background-color:"+r+";"),d.color=r,a}(a.color)).title=w.getText("RoutePropertiesDialog - Route properties"),r.okButtonListener=c,i=n.create("div",{id:"TravelNotes-RoutePropertiesDialog-MainDataDiv"},r.content),function(){let e=n.create("div",{className:"TravelNotes-RoutePropertiesDialog-DataDiv",id:"TravelNotes-RoutePropertiesDialog-WithDiv"},i);e.innerHTML="<span>"+w.getText("RoutePropertiesDialog - Width")+"</span>",(l=n.create("input",{type:"number",id:"TravelNotes-RoutePropertiesDialog-WidthInput"},e)).value=a.width,l.min=o.route.minWidth,l.max=o.route.maxWidth}(),function(){let t=n.create("div",{className:"TravelNotes-RoutePropertiesDialog-DataDiv",id:"TravelNotes-RoutePropertiesDialog-dashDiv"},i);t.innerHTML="<span>"+w.getText("RoutePropertiesDialog - Linetype")+"</span>",d=n.create("select",{className:"TravelNotes-RoutePropertiesDialog-Select",id:"TravelNotes-RoutePropertiesDialog-DashSelect"},t);let r=e.route.dashChoices;for(let e=o.zero;e<r.length;e++)d.add(n.create("option",{text:r[e].text}));d.selectedIndex=a.dashArray<r.length?a.dashArray:o.zero}(),function(){let e=n.create("div",{className:"TravelNotes-RoutePropertiesDialog-DataDiv",id:"TravelNotes-RoutePropertiesDialog-ChainDiv"},i);e.innerHTML="<span>"+w.getText("RoutePropertiesDialog - Chained route")+"</span>",(s=n.create("input",{type:"checkbox",id:"TravelNotes-RoutePropertiesDialog-ChainInput"},e)).checked=a.chain}(),r}function P(){function e(e,t){let a=function(e){return o.notFound<["setitinerary","updateitinerary","settravelnotes","updatetravelnotes","setsearch","updatesearch","expandrouteui","reducerouteui","setwaypointslist","setrouteslist","setprovider","providersadded","settransitmode"].indexOf(e)?document.getElementById("TravelNotes-Control-MainDiv"):o.notFound<["removeobject","removeallobjects","zoomto","additinerarypointmarker","addsearchpointmarker","addrectangle","addwaypoint","layerchange","geolocationstatuschanged","geolocationpositionchanged","routeupdated","routepropertiesupdated","noteupdated","roadbookupdate","travelnotesfileloaded"].indexOf(e)?document:null}(e);if(a){let o=new Event(e);t&&(o.data=t),a.dispatchEvent(o)}}return Object.seal({dispatch:(t,o)=>e(t,o)})}function M(a){let n=t(),i=E(),l=e.note.svgIconWidth,s=a||"TravelNotes-Control-";function d(e){let t="";o.zero!==e.tooltipContent.length&&(t+='<div class="'+s+'NoteHtml-TooltipContent">'+e.tooltipContent+"</div>"),o.zero!==e.popupContent.length&&(t+='<div class="'+s+'NoteHtml-PopupContent">'+e.popupContent+"</div>"),o.zero!==e.address.length&&(t+='<div class="'+s+'NoteHtml-Address">'+w.getText("NoteEditor - Address")+e.address+"</div>"),o.zero!==e.phone.length&&(t+='<div class="'+s+'NoteHtml-Phone">'+w.getText("NoteEditor - Phone")+e.phone+"</div>"),o.zero!==e.url.length&&(t+='<div class="'+s+'NoteHtml-Url">'+w.getText("NoteEditor - Link")+'<a href="'+e.url+'" target="_blank">'+e.url.substr(o.zero,o.htmlViewsFactory.linksMaxLength)+"...</a></div>");let a=E();return t+='<div class="'+s+'NoteHtml-LatLng">'+w.getText("NoteEditor - Latitude Longitude",{lat:a.formatLat(e.lat),lng:a.formatLng(e.lng)})+"</div>",o.distance.invalid!==e.distance&&(t+='<div class="'+s+'NoteHtml-Distance">'+w.getText("NoteEditor - Distance",{distance:a.formatDistance(e.chainedDistance+e.distance)})+"</div>"),t}function c(e,t){let o=n.create("div",{className:s+"Travel-Notes-IconCell",innerHTML:e.iconContent},t);"svg"===o.firstChild.tagName&&"TravelNotes-Roadbook-"===s&&o.firstChild.setAttributeNS(null,"viewBox","0 0 "+l+" "+l),n.create("div",{className:s+"Travel-Notes-Cell",innerHTML:d(e)},t),t.noteObjId=e.objId}function u(e){let t='<div class="'+s+'Route-Header-Name">'+e.name+"</div>";return o.zero!==e.distance&&(t+='<div class="'+s+'Route-Header-Distance">'+w.getText("RouteEditor - Distance",{distance:i.formatDistance(e.distance)})+"</div>"),C.travel.readOnly||(t+='<div class="'+s+'Route-Header-Duration">'+w.getText("RouteEditor - Duration",{duration:i.formatTime(e.duration)})+"</div>"),t}function v(){let e=n.create("div",{className:s+"Travel-Header"});n.create("div",{className:s+"Travel-Header-Name",innerHTML:C.travel.name},e);let t=o.distance.defaultValue,a=C.travel.routes.iterator;for(;!a.done;)n.create("div",{className:s+"Travel-Header-RouteName",innerHTML:'<a href="#route'+a.value.objId+'">'+a.value.name+"</a>&nbsp;:&nbsp;"+i.formatDistance(a.value.distance)+"."},e),a.value.chain&&(t+=a.value.distance);return n.create("div",{className:s+"Travel-Header-TravelDistance",innerHTML:w.getText("HTMLViewsFactory - Travel distance&nbsp;:&nbsp;{distance}",{distance:i.formatDistance(t)})},e),e}function g(){let e=n.create("div",{className:s+"Travel-Notes"}),t=C.travel.notes.iterator;for(;!t.done;){let o=n.create("div",{className:s+"Travel-Notes-Row"},e);c(t.value,o)}return e}function m(e){return n.create("div",{className:s+"Route-Header",id:"route"+e.objId,innerHTML:u(e)})}function p(e){let t=n.create("div",{className:s+"Route-ManeuversAndNotes"}),a=e.notes.iterator,l=a.done,d=l?Number.MAX_VALUE:a.value.distance,u=d,v=e.itinerary.maneuvers.iterator,g=v.done,m=o.distance.defaultValue;for(;!g||!l;){let p=n.create("div",{className:s+"Route-ManeuversAndNotes-Row"},t);if(m<=d){if(!g){p.className=s+"Route-Maneuvers-Row",n.create("div",{className:s+"Route-ManeuversAndNotes-IconCell TravelNotes-ManeuverNote-"+v.value.iconName},p);let t="<div>"+v.value.instruction+"</div>";o.zero<v.value.distance&&(t+="<div>"+w.getText("HTMLViewsFactory - To next instruction&nbsp;:&nbsp;{distance}&nbsp;-&nbsp;{duration}",{distance:i.formatDistance(v.value.distance),duration:i.formatTime(v.value.duration)})+"</div>"),n.create("div",{className:s+"Route-ManeuversAndNotes-Cell",innerHTML:t},p),p.objId=r(),p.latLng=e.itinerary.itineraryPoints.getAt(v.value.itineraryPointObjId).latLng,p.maneuverObjId=v.value.objId,m+=v.value.distance,(g=v.done)&&(m=Number.MAX_VALUE)}}else if(!l&&(p.className=s+"Route-Notes-Row",c(a.value,p),p.objId=r(),p.latLng=a.value.latLng,p.noteObjId=a.value.objId,u=a.value.distance,d=(l=a.done)?Number.MAX_VALUE:a.value.distance,!l)){let e=a.value.distance-u;o.htmlViewsFactory.minNotesDistance<e&&n.create("div",{className:s+"NoteHtml-NextDistance",innerHTML:w.getText("HTMLViewsFactory - Next distance&nbsp;:&nbsp;{distance}",{distance:i.formatDistance(e)})},p.lastChild)}}return t}function h(e){let t="";return""!==e.itinerary.provider&&""!==e.itinerary.transitMode&&(t=w.getText("HTMLViewsFactory - Itinerary computed by {provider} and optimized for {transitMode}",{provider:e.itinerary.provider,transitMode:w.getText("HTMLViewsFactory - TransitMode "+e.itinerary.transitMode)})),n.create("div",{className:s+"RouteFooter",innerHTML:t})}function b(){return n.create("div",{className:s+"TravelFooter",innerHTML:w.getText("HTMLViewsFactory - Travel footer")})}return Object.seal({get travelHeaderHTML(){return v()},get travelNotesHTML(){return g()},get routeHeaderHTML(){return m(C.travel.editedRoute)},get routeManeuversAndNotesHTML(){return p(C.travel.editedRoute)},get routeFooterHTML(){return h(C.travel.editedRoute)},get travelFooterHTML(){return b()},get travelHTML(){return function(){let t=n.create("div",{className:s+"Travel"});t.appendChild(v()),t.appendChild(g());let o=C.travel.routes.iterator;for(;!o.done;){let a=e.routeEditor.displayEditionInHTMLPage&&o.value.objId===C.editedRouteObjId;t.appendChild(m(a?C.travel.editedRoute:o.value)),t.appendChild(p(a?C.travel.editedRoute:o.value)),t.appendChild(h(a?C.travel.editedRoute:o.value))}return t.appendChild(b()),t}()},getRouteHTML:e=>u(e),getNoteHTML:e=>d(e)})}function R(){if(E().storageAvailable("localStorage")){let e=M("TravelNotes-Roadbook-");localStorage.setItem(C.UUID+"-TravelNotesHTML",e.travelHTML.outerHTML)}}function B(){function e(e){return(e+o.angle.degree540)%o.angle.degree360-o.angle.degree180}return Object.seal({getClosestLatLngDistance:(e,t)=>(function(e,t){if(o.zero===e.itinerary.itineraryPoints.length)return null;let a=e.itinerary.itineraryPoints.iterator;a.done;let n=Number.MAX_VALUE,r=L.Projection.SphericalMercator.project(L.latLng(t[o.zero],t[o.number1])),i=L.Projection.SphericalMercator.project(L.latLng(a.value.lat,a.value.lng)),l=null,s=o.distance.defaultValue,d=a.value.distance;for(;!a.done;){let e=L.Projection.SphericalMercator.project(L.latLng(a.value.lat,a.value.lng)),t=L.LineUtil.pointToSegmentDistance(r,i,e);t<n&&(n=t,s=d-(l=L.Projection.SphericalMercator.unproject(L.LineUtil.closestPointOnSegment(r,i,e))).distanceTo(L.latLng(a.value.lat,a.value.lng))),d+=a.value.distance,i=e}return{latLng:[l.lat,l.lng],distance:s}})(e,t),getLatLngBounds:e=>(function(e){let t=L.latLng([o.latLng.maxLat,o.latLng.maxLng]),a=L.latLng([o.latLng.minLat,o.latLng.minLng]);return e.forEach(e=>{t.lat=Math.min(t.lat,e[o.zero]),t.lng=Math.min(t.lng,e[o.number1]),a.lat=Math.max(a.lat,e[o.zero]),a.lng=Math.max(a.lng,e[o.number1])}),L.latLngBounds(t,a)})(e),pointsDistance:(t,a)=>(function(t,a){if(t[o.zero]===a[o.zero]&&t[o.number1]===a[o.number1])return o.zero;const n=Math.PI/o.angle.degree180;let r=t[o.zero]*n,i=a[o.zero]*n,l=(e(a[o.number1])-e(t[o.number1]))*n;return 6371e3*Math.acos(Math.sin(r)*Math.sin(i)+Math.cos(r)*Math.cos(i)*Math.cos(l))})(t,a),project:(e,t)=>(function(e,t){let o=C.map.project(L.latLng(e),t);return[o.x,o.y]})(e,t),addPoints:(e,t)=>(e=e,t=t,[e[o.zero]+t[o.zero],e[o.number1]+t[o.number1]]),subtrackPoints:(e,t)=>(function(e,t){return[e[o.zero]-t[o.zero],e[o.number1]-t[o.number1]]})(e,t)});var t,a}function O(){let e=P(),t=x(),a=[];function n(e){a.push(e.latLng),a.push(e.iconLatLng)}function r(e){e.itinerary.itineraryPoints.forEach(e=>a.push(e.latLng)),e.notes.forEach(e=>n(e))}return Object.seal({zoomToNote:o=>(o=o,void e.dispatch("zoomto",{latLng:t.getNoteAndRoute(o).note.latLng})),zoomToRoute:o=>(o=o,a=[],r(t.getRoute(o)),void e.dispatch("zoomto",{geometry:[a]})),zoomToTravel:()=>(a=[],C.travel.routes.forEach(e=>r(e)),o.invalidObjId!==C.travel.editedRouteObjId&&r(C.travel.editedRoute),C.travel.notes.forEach(e=>n(e)),void e.dispatch("zoomto",{geometry:[a]}))});var i,l}const S=function(){let t=!1,a=!1,n=x(),r=E(),i=P(),l=B();function s(){let e=C.travel.routes.iterator,t=o.distance.defaultValue;for(;!e.done;){e.value.chain?(e.value.chainedDistance=t,t+=e.value.distance):e.value.chainedDistance=o.distance.defaultValue;let a=e.value.notes.iterator;for(;!a.done;)a.value.chainedDistance=e.value.chainedDistance}}function d(e){a=!1,A.showError(e),console.log(e||"An error occurs when asking the route to the provider")}function c(){a=!1,function(e){let t=e.itinerary.itineraryPoints.iterator,a=e.itinerary.maneuvers.iterator;t.done,a.done;let n=t.value,r=a.value;for(r.distance=o.distance.defaultValue,a.done,e.distance=o.distance.defaultValue,e.duration=o.distance.defaultValue;!t.done;)n.distance=l.pointsDistance(n.latLng,t.value.latLng),a.value.itineraryPointObjId===t.value.objId&&(e.duration+=r.duration,r=a.value,a.value.distance=o.distance.defaultValue,a.done),e.distance+=n.distance,r.distance+=n.distance,n=t.value}(C.travel.editedRoute);let e=C.travel.editedRoute.wayPoints.iterator;for(;!e.done;)e.first?e.value.latLng=C.travel.editedRoute.itinerary.itineraryPoints.first.latLng:e.last?e.value.latLng=C.travel.editedRoute.itinerary.itineraryPoints.last.latLng:e.value.latLng=B().getClosestLatLngDistance(C.travel.editedRoute,e.value.latLng).latLng;let n=C.travel.editedRoute.notes.iterator;for(;!n.done;){let e=l.getClosestLatLngDistance(C.travel.editedRoute,n.value.latLng);n.value.latLng=e.latLng,n.value.distance=e.distance}s(),C.travel.editedRoute.notes.sort((e,t)=>e.distance-t.distance),t&&O().zoomToRoute(C.travel.editedRoute.objId),i.dispatch("routeupdated",{removedRouteObjId:C.travel.editedRoute.objId,addedRouteObjId:C.travel.editedRoute.objId}),R(),i.dispatch("setitinerary"),i.dispatch("setwaypointslist")}function u(){if(!e.routing.auto)return;if(a)return!1;if(!function(){let e=!0;return C.travel.editedRoute.wayPoints.forEach(t=>{e=e&&o.latLng.defaultValue!==t.lat&&o.latLng.defaultValue!==t.lng}),e}())return!1;t=o.zero===C.travel.editedRoute.itinerary.itineraryPoints.length,a=!0;let n=C.providers.get(C.routing.provider.toLowerCase());return C.travel.editedRoute.itinerary.provider=n.name,C.travel.editedRoute.itinerary.transitMode=C.routing.transitMode,n.getPromiseRoute(C.travel.editedRoute,null).then(c,d).catch(d),!0}function v(){n.getRoute(C.editedRouteObjId).edited=o.route.edited.notEdited,i.dispatch("routeupdated",{removedRouteObjId:C.travel.editedRoute.objId,addedRouteObjId:C.editedRouteObjId}),C.editedRouteObjId=o.invalidObjId,C.travel.editedRoute=g(),s(),R(),i.dispatch("setrouteslist"),i.dispatch("setwaypointslist"),i.dispatch("reducerouteui"),i.dispatch("setitinerary")}return Object.seal({saveGpx:()=>(function(){let e='time="'+(new Date).toISOString()+'" ',t='<?xml version="1.0"?>\n';t+='<gpx xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xsi:schemaLocation="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd" version="1.1" creator="leaflet.TravelNotes">';let o=C.travel.editedRoute.wayPoints.iterator;for(;!o.done;)t+='\n\t<wpt lat="'+o.value.lat+'" lon="'+o.value.lng+'" '+e+"/>";t+="\n\t<rte>";let a=C.travel.editedRoute.itinerary.maneuvers.iterator;for(;!a.done;){let o=C.travel.editedRoute.itinerary.itineraryPoints.getAt(a.value.itineraryPointObjId),n=a.value.instruction.replace("&","&amp;").replace('"',"&apos;").replace('"',"&quote;").replace(">","&gt;").replace("<","&lt;");t+='\n\t\t<rtept lat="'+o.lat+'" lon="'+o.lng+'" '+e+'desc="'+n+'" />'}t+="\n\t</rte>",t+="\n\t<trk>",t+="\n\t\t<trkseg>";let n=C.travel.editedRoute.itinerary.itineraryPoints.iterator;for(;!n.done;)t+='\n\t\t\t<trkpt lat="'+n.value.lat+'" lon="'+n.value.lng+'" '+e+" />";t+="\n\t\t</trkseg>",t+="\n\t</trk>",t+="\n</gpx>";let i=C.travel.editedRoute.name;""===i&&(i="TravelNote"),i+=".gpx",r.saveFile(i,t)})(),chainRoutes:()=>s(),startRouting:()=>u(),saveEdition:()=>(function(){let e=g();e.object=C.travel.editedRoute.object,C.travel.routes.replace(C.editedRouteObjId,e),C.editedRouteObjId=e.objId,v()})(),cancelEdition:()=>v(),routeProperties:e=>(function(e){let t=n.getRoute(e);D(t).show().then(()=>{s(),i.dispatch("routepropertiesupdated",{routeObjId:t.objId}),i.dispatch("setrouteslist")}).catch(e=>console.log(e||"An error occurs in the route properties dialog"))})(e),hideRoute:e=>(e=e,i.dispatch("routeupdated",{removedRouteObjId:e,addedRouteObjId:o.invalidObjId}),void(n.getRoute(e).hidden=!0)),showRoutes:()=>(function(){let e=C.travel.routes.iterator;for(;!e.done;)e.value.hidden&&i.dispatch("routeupdated",{removedRouteObjId:o.invalidObjId,addedRouteObjId:e.value.objId})})()});var m}();var z={};function k(e){return Math.floor(Math.abs(e)+.5)*(e>=0?1:-1)}function U(e,t,o){var a=(e=k(e*o))-(t=k(t*o));a<<=1,e-t<0&&(a=~a);for(var n="";a>=32;)n+=String.fromCharCode(63+(32|31&a)),a>>=5;return n+=String.fromCharCode(a+63)}function H(e){for(var t=[],o=0;o<e.length;o++)t.push(e[o].slice().reverse());return t}function F(){function e(e){let t={};o.zero!==e.itinerary.itineraryPoints.length&&(t=e.itinerary.itineraryPoints[o.zero].objType);let a={latLngs:[],distances:[],objIds:[],objType:t};e.itinerary.itineraryPoints.forEach(e=>{a.latLngs.push([e.lat,e.lng]),a.distances.push(e.distance),a.objIds.push(e.objId)}),a.latLngs=z.encode(a.latLngs,o.polylinePrecision),e.itinerary.itineraryPoints=a}function t(e){e.itinerary.itineraryPoints.latLngs=z.decode(e.itinerary.itineraryPoints.latLngs,o.polylinePrecision);let t=[],a=o.zero;e.itinerary.itineraryPoints.latLngs.forEach(n=>{let r={};r.lat=n[o.zero],r.lng=n[o.number1],r.distance=e.itinerary.itineraryPoints.distances[a],r.objId=e.itinerary.itineraryPoints.objIds[a],r.objType=e.itinerary.itineraryPoints.objType,t.push(r),a++}),e.itinerary.itineraryPoints=t}function a(e){let o=e;return o.routes.forEach(t),o.editedRoute&&t(o.editedRoute),o}return Object.seal({decompress:e=>(e=e,C.travel.object=a(e),C.editedRouteObjId=o.invalidObjId,void C.travel.routes.forEach(e=>{o.route.edited.notEdited!==e.edited&&(C.editedRouteObjId=e.objId)})),decompressMerge:e=>(function(e){let t=I();t.object=a(e);let o=t.routes.iterator;for(;!o.done;)C.travel.routes.add(o.value);let n=t.notes.iterator;for(;!n.done;)C.travel.notes.add(n.value)})(e),compress:()=>(function(){let t=C.travel.object;return t.routes.forEach(e),e(t.editedRoute),t})()});var n}z.decode=function(e,t){for(var o,a=0,n=0,r=0,i=[],l=0,s=0,d=null,c=Math.pow(10,Number.isInteger(t)?t:5);a<e.length;){d=null,l=0,s=0;do{s|=(31&(d=e.charCodeAt(a++)-63))<<l,l+=5}while(d>=32);o=1&s?~(s>>1):s>>1,l=s=0;do{s|=(31&(d=e.charCodeAt(a++)-63))<<l,l+=5}while(d>=32);n+=o,r+=1&s?~(s>>1):s>>1,i.push([n/c,r/c])}return i},z.encode=function(e,t){if(!e.length)return"";for(var o=Math.pow(10,Number.isInteger(t)?t:5),a=U(e[0][0],0,o)+U(e[0][1],0,o),n=1;n<e.length;n++){var r=e[n],i=e[n-1];a+=U(r[0],i[0],o),a+=U(r[1],i[1],o)}return a},z.fromGeoJSON=function(e,t){if(e&&"Feature"===e.type&&(e=e.geometry),!e||"LineString"!==e.type)throw new Error("Input must be a GeoJSON LineString");return z.encode(H(e.coordinates),t)},z.toGeoJSON=function(e,t){return{type:"LineString",coordinates:H(z.decode(e,t))}},"object"==typeof module&&module.exports&&(module.exports=z);const V=function(){let t=E(),a=x(),n=P();function r(e){if(o.route.edited.editedChanged===C.travel.editedRoute.edited)return void A.showError(w.getText("RouteEditor - Not possible to edit a route without a save or cancel"));o.invalidObjId!==C.editedRouteObjId&&S.cancelEdition();let t=a.getRoute(e),r=t.itinerary.provider;if(r&&""!==r&&!C.providers.get(r.toLowerCase()))return void A.showError(w.getText("RouteEditor - Not possible to edit a route created with this provider",{provider:r}));r&&""!==r&&n.dispatch("setprovider",{provider:r});let i=t.itinerary.transitMode;i&&""!==i&&n.dispatch("settransitmode",{transitMode:i}),C.travel.editedRoute=g(),t.edited=o.route.edited.editedNoChange,C.travel.editedRoute.object=t.object,C.editedRouteObjId=t.objId,C.travel.editedRoute.hidden=!1,t.hidden=!1,S.chainRoutes(),n.dispatch("routeupdated",{removedRouteObjId:t.objId,addedRouteObjId:C.travel.editedRoute.objId}),R(),n.dispatch("expandrouteui"),n.dispatch("setwaypointslist"),n.dispatch("setitinerary")}return Object.seal({addRoute:()=>(function(){let e=g();C.travel.routes.add(e),n.dispatch("setrouteslist"),S.chainRoutes(),n.dispatch("roadbookupdate"),o.route.edited.editedChanged!==C.travel.editedRoute.edited&&r(e.objId)})(),removeRoute:e=>(function(e){console.log(C.travel.object);let t=e;t!==C.editedRouteObjId&&t!==C.travel.editedRoute.objId||o.route.edited.editedChanged!==C.travel.editedRoute.edited?(t!==C.editedRouteObjId&&t!==C.travel.editedRoute.objId||(t=C.editedRouteObjId,S.cancelEdition()),n.dispatch("routeupdated",{removedRouteObjId:t,addedRouteObjId:o.invalidObjId}),C.travel.routes.remove(t),S.chainRoutes(),R(),n.dispatch("setrouteslist")):A.showError(w.getText("TravelEditor - Cannot remove an edited route"))})(e),editRoute:e=>r(e),renameRoute:(e,t)=>(e=e,t=t,a.getRoute(e).name=t,e===C.editedRouteObjId&&(C.travel.editedRoute.name=t),n.dispatch("setrouteslist"),void n.dispatch("roadbookupdate")),swapRoute:(e,t)=>(function(e,t){C.travel.routes.swap(e,t),S.chainRoutes(),n.dispatch("setrouteslist"),n.dispatch("roadbookupdate")})(e,t),routeDropped:(e,t,o)=>(e=e,t=t,o=o,C.travel.routes.moveTo(e,t,o),S.chainRoutes(),n.dispatch("setrouteslist"),void n.dispatch("roadbookupdate")),saveTravel:()=>(function(){let e=C.travel.routes.iterator;for(;!e.done;)e.value.hidden=!1;let o=F().compress(C.travel);t.saveFile(o.name+".trv",JSON.stringify(o))})(),clear:()=>void(window.confirm(w.getText("TravelEditor - This page ask to close; data are perhaps not saved."))&&(n.dispatch("removeallobjects"),C.travel.editedRoute=g(),C.editedRouteObjId=o.invalidObjId,C.travel=I(),C.travel.routes.add(g()),n.dispatch("setrouteslist"),n.dispatch("setwaypointslist"),n.dispatch("setitinerary"),n.dispatch("roadbookupdate"),n.dispatch("travelnotesfileloaded",{readOnly:!1,name:""}),e.travelEditor.startupRouteEdition&&r(C.travel.routes.first.objId)))});var i,l,s,d,c}();function W(){return Object.seal({getPromiseAddress:t=>(function(t){let n=e.nominatim.url+"reverse?format=json&lat="+t[o.zero]+"&lon="+t[o.number1]+"&zoom=18&addressdetails=1",r=e.nominatim.language;r&&"*"!==r&&(n+="&accept-language="+r);let i=null;return r&&"*"===r&&(i=[{headerName:"accept-language",headerValue:""}]),a().getJsonPromise(n,i)})(t)})}const K=function(){let t=P(),a=B();function n(e,a){C.travel.editedRoute.edited=o.route.edited.editedChanged,C.travel.editedRoute.wayPoints.getAt(a).name=e,t.dispatch("setwaypointslist")}function r(t,a){e.wayPoint.reverseGeocoding&&W().getPromiseAddress(t).then(function(e){let t="";e.address.house_number&&(t+=e.address.house_number+" "),e.address.road?t+=e.address.road+" ":e.address.pedestrian&&(t+=e.address.pedestrian+" "),e.address.village?t+=e.address.village:e.address.town?t+=e.address.town:e.address.city&&(t+=e.address.city),o.zero===t.length&&(t+=e.address.country),n(t,a)}).catch(e=>console.log(e||"An error occurs in the geoCoder"))}function i(e,n){C.travel.editedRoute.edited=o.route.edited.editedChanged;let i=d();if(e&&(i.latLng=e,r(e,i.objId)),C.travel.editedRoute.wayPoints.add(i),t.dispatch("addwaypoint",{wayPoint:C.travel.editedRoute.wayPoints.last,letter:C.travel.editedRoute.wayPoints.length-o.number2}),n){let e=C.travel.editedRoute.wayPoints.iterator;for(;!e.done;)if(n<a.getClosestLatLngDistance(C.travel.editedRoute,e.value.latLng).distance){C.travel.editedRoute.wayPoints.moveTo(i.objId,e.value.objId,!0);break}}else C.travel.editedRoute.wayPoints.swap(i.objId,!0);t.dispatch("setwaypointslist"),S.startRouting()}return Object.seal({addWayPoint:e=>i(e),addWayPointOnRoute:(e,t)=>(function(e,t){let o=a.getClosestLatLngDistance(x().getRoute(e),[t.latlng.lat,t.latlng.lng]);i(o.latLng,o.distance)})(e,t),reverseWayPoints:()=>(function(){C.travel.editedRoute.edited=o.route.edited.editedChanged;let e=C.travel.editedRoute.wayPoints.iterator;for(;!e.done;)t.dispatch("removeobject",{objId:e.value.objId});for(C.travel.editedRoute.wayPoints.reverse(),e=C.travel.editedRoute.wayPoints.iterator;!e.done;)t.dispatch("addwaypoint",{wayPoint:e.value,letter:e.first?"A":e.last?"B":e.index});t.dispatch("setwaypointslist"),S.startRouting()})(),removeAllWayPoints:()=>(function(){C.travel.editedRoute.edited=o.route.edited.editedChanged;let e=C.travel.editedRoute.wayPoints.iterator;for(;!e.done;)t.dispatch("removeobject",{objId:e.value.objId});C.travel.editedRoute.wayPoints.removeAll(!0),t.dispatch("setwaypointslist"),S.startRouting()})(),removeWayPoint:e=>(e=e,C.travel.editedRoute.edited=o.route.edited.editedChanged,t.dispatch("removeobject",{objId:e}),C.travel.editedRoute.wayPoints.remove(e),t.dispatch("setwaypointslist"),void S.startRouting()),renameWayPoint:(e,t)=>n(e,t),swapWayPoints:(e,a)=>(function(e,a){C.travel.editedRoute.edited=o.route.edited.editedChanged,C.travel.editedRoute.wayPoints.swap(e,a),t.dispatch("setwaypointslist"),S.startRouting()})(e,a),setStartPoint:a=>(a=a,C.travel.editedRoute.edited=o.route.edited.editedChanged,o.latLng.defaultValue!==C.travel.editedRoute.wayPoints.first.lat&&t.dispatch("removeobject",{objId:C.travel.editedRoute.wayPoints.first.objId}),C.travel.editedRoute.wayPoints.first.latLng=a,e.wayPoint.reverseGeocoding&&r(a,C.travel.editedRoute.wayPoints.first.objId),t.dispatch("addwaypoint",{wayPoint:C.travel.editedRoute.wayPoints.first,letter:"A"}),t.dispatch("setwaypointslist"),void S.startRouting()),setEndPoint:a=>(function(a){C.travel.editedRoute.edited=o.route.edited.editedChanged,o.latLng.defaultValue!==C.travel.editedRoute.wayPoints.last.lat&&t.dispatch("removeobject",{objId:C.travel.editedRoute.wayPoints.last.objId}),C.travel.editedRoute.wayPoints.last.latLng=a,e.wayPoint.reverseGeocoding&&r(a,C.travel.editedRoute.wayPoints.last.objId),t.dispatch("addwaypoint",{wayPoint:C.travel.editedRoute.wayPoints.last,letter:"B"}),t.dispatch("setwaypointslist"),S.startRouting()})(a),wayPointDragEnd:a=>(function(a){C.travel.editedRoute.edited=o.route.edited.editedChanged,e.wayPoint.reverseGeocoding&&r(C.travel.editedRoute.wayPoints.getAt(a).latLng,a),t.dispatch("setwaypointslist"),S.startRouting()})(a),wayPointDropped:(e,a,n)=>(function(e,a,n){if(C.travel.editedRoute.edited=o.route.edited.editedChanged,a===C.travel.editedRoute.wayPoints.first.objId&&n)return;if(a===C.travel.editedRoute.wayPoints.last.objId&&!n)return;C.travel.editedRoute.wayPoints.moveTo(e,a,n),t.dispatch("setwaypointslist");let r=C.travel.editedRoute.wayPoints.iterator;for(;!r.done;)t.dispatch("removeobject",{objId:r.value.objId}),t.dispatch("addwaypoint",{wayPoint:r.value,letter:r.first?"A":r.last?"B":r.index});S.startRouting()})(e,a,n)});var l,s}();let Z=null,J=null,G=o.zero,X=null,Y=null,Q=o.latLng.defaultValue,q=o.latLng.defaultValue;function _(a){let n=[],r=t(),i=document.getElementsByTagName("body")[o.zero];function l(e){e.preventDefault(),e.stopPropagation()}function s(e){e.preventDefault(),e.stopPropagation()}function d(e){Z&&(e.preventDefault(),e.stopPropagation()),"Escape"!==e.key&&"Esc"!==e.key||Y.click()(),"ArrowDown"!==e.key&&"ArrowRight"!==e.key&&"Tab"!==e.key||(G=G>=n.length?o.number1:++G,Z.childNodes[G].firstChild.focus()),"ArrowUp"!==e.key&&"ArrowLeft"!==e.key||(G=G<=o.number1?n.length:--G,Z.childNodes[G].firstChild.focus()),"Home"===e.key&&(G=o.number1,Z.childNodes[G].firstChild.focus()),"End"===e.key&&(G=n.length,Z.childNodes[G].firstChild.focus()),"Enter"===e.key&&G>o.zero&&n[G-o.number1].action&&Z.childNodes[G].firstChild.click()}function c(e){e.stopPropagation(),n[e.target.menuItem].param?n[e.target.menuItem].action.call(n[e.target.menuItem].context,n[e.target.menuItem].param,X):n[e.target.menuItem].action.call(n[e.target.menuItem].context,X),Y.click()}function u(){J&&(clearTimeout(J),J=null),document.removeEventListener("keydown",d,!0),document.removeEventListener("keypress",l,!0),document.removeEventListener("keyup",s,!0);let e=Z.childNodes;e[o.zero].firstChild.removeEventListener("click",u,!1);for(let t=o.number1;t<e.length;t++)e[t].firstChild.removeEventListener("click",c,!1);document.getElementsByTagName("body")[o.zero].removeChild(Z),Z=null,G=o.zero,n=[],Q=o.latLng.defaultValue,q=o.latLng.defaultValue}function v(){(X=a).latlng.lat===Q&&X.latlng.lng===q||(Q=X.latlng.lat,q=X.latlng.lng,Z?u():((Z=r.create("div",{id:"TravelNotes-ContextMenu-Container",className:"TravelNotes-ContextMenu-Container"},i)).addEventListener("mouseenter",()=>{J&&(clearTimeout(J),J=null)},!1),Z.addEventListener("mouseleave",()=>{J=setTimeout(u,e.contextMenu.timeout)},!1),(Y=r.create("div",{innerHTML:"&#x274c",className:"TravelNotes-ContextMenu-CloseButton",title:w.getText("ContextMenu - Close")},Z)).addEventListener("click",u,!1),function(){let e=o.zero;n.forEach(t=>{let o=r.create("div",{className:"TravelNotes-ContextMenu-ItemContainer"},Z),a=r.create("button",{innerHTML:t.name,id:"TravelNotes-ContextMenu-Item"+e,className:t.action?"TravelNotes-ContextMenu-Item":"TravelNotes-ContextMenu-Item TravelNotes-ContextMenu-ItemDisabled"},o);t.action&&a.addEventListener("click",c,!1),a.menuItem=e,++e})}(),function(){let e=r.create("div",{className:"TravelNotes-ContextMenu-Panel"},i),t=e.clientWidth,a=e.clientHeight;i.removeChild(e);let n=Math.min(X.originalEvent.clientY,a-Z.clientHeight-o.baseContextMenu.menuMargin),l=Math.min(X.originalEvent.clientX,t-Z.clientWidth-o.baseContextMenu.menuMargin);Z.setAttribute("style","top:"+n+"px;left:"+l+"px;")}(),document.addEventListener("keydown",d,!0),document.addEventListener("keypress",l,!0),document.addEventListener("keyup",s,!0)))}var g;return{init:e=>(e=e,void(n=e)),show:()=>v()}}let $=!1;function ee(){let t=B(),n={latLng:[o.latLng.defaultValue,o.latLng.defaultValue],distance:o.distance.defaultValue},r=null,i=null,l={},s=new Map,d=new Map,c=[],u=null,v=null,g=null,m=o.svgIcon.positionOnRoute.onRoute,p=[o.zero,o.zero],h=o.zero,b=null,f=e.note.svgZoom,T=e.note.svgAngleDistance,y=" ",N="",L="";function I(e){let t=!1;return i.wayPoints.forEach(a=>{Math.abs(e.lat-a.lat)<o.svgIconFromOsmFactory.comparePrecision&&Math.abs(e.lng-a.lng)<o.svgIconFromOsmFactory.comparePrecision&&(t=!0)}),!t&&(r.lat!==e.lat||r.lng!==e.lng)}function E(E,C){$?C("A request is already running"):($=!0,l={},g=null,v=null,y=" ",N="",L="",function(){let e=Number.MAX_VALUE,a=o.distance.defaultValue;i.itinerary.itineraryPoints.forEach(o=>{let i=t.pointsDistance(n.latLng,o.latLng);e>i&&(e=i,r=o,n.distance=a),a+=o.distance}),n.latLng=r.latLng}(),a().getJsonPromise(function(){let t=n.latLng[o.zero].toFixed(o.latLng.fixed)+","+n.latLng[o.number1].toFixed(o.latLng.fixed);return e.overpassApiUrl+"?data=[out:json][timeout:"+e.note.svgTimeOut+"];way[highway](around:"+(e.note.svgIconWidth*o.svgIconFromOsmFactory.searchAroundFactor).toFixed(o.zero)+","+t+")->.a;(.a >;.a;)->.a;.a out;is_in("+t+')->.e;area.e[admin_level="2"][name="United Kingdom"]->.f;area.e[admin_level="8"]->.g;area.e[admin_level="10"]->.h;if(f.count(deriveds)==0){.g->.i;}else{if(h.count(deriveds)==0){.g->.i;}else{.h->.i;}}.i out;(node(area.i)[place="village"];node(area.i)[place="hamlet"];node(area.i)[place="city"];node(area.i)[place="town"];)->.k;( node(around:'+e.note.svgHamletDistance+","+t+')[place="hamlet"];node(around:'+e.note.svgVillageDistance+","+t+')[place="village"];node(around:'+e.note.svgCityDistance+","+t+')[place="city"];node(around:'+e.note.svgTownDistance+","+t+')[place="town"];)->.l;node.k.l->.m;.m out;'}()).then(function(a){l=a,s.clear(),d.clear(),l.elements.forEach(e=>{switch(e.type){case"area":e.tags&&e.tags.boundary&&e.tags.name&&(v=e.tags.name);break;case"way":e.nodesIds=e.nodes,delete e.nodes,s.set(e.id,e);break;case"node":d.set(e.id,e),e.tags&&e.tags.place&&["town","city","village","hamlet"].includes(e.tags.place)&&c.push(e)}}),(g=document.createElementNS("http://www.w3.org/2000/svg","svg")).setAttributeNS(null,"viewBox",String(e.note.svgIconWidth/o.number4)+" "+e.note.svgIconWidth/o.number4+" "+e.note.svgIconWidth/o.number2+" "+e.note.svgIconWidth/o.number2),g.setAttributeNS(null,"class","TravelNotes-SvgIcon"),function(){let e=Number.MAX_VALUE;c.forEach(o=>{let a=t.pointsDistance(r.latLng,[o.lat,o.lon]);e>a&&(e=a,u=o.tags.name)})}(),p=t.subtrackPoints([e.note.svgIconWidth/o.number2,e.note.svgIconWidth/o.number2],t.project(n.latLng,f)),function(){let e=o.distance.defaultValue,a=i.itinerary.itineraryPoints.first,l=i.itinerary.itineraryPoints.last,s=!1;i.itinerary.itineraryPoints.forEach(t=>{n.distance-e>T&&(a=t),e-n.distance>T&&!s&&(l=t,s=!0),e+=t.distance});let d=t.addPoints(t.project(n.latLng,f),p);if(r.objId!==i.itinerary.itineraryPoints.first.objId){let e=t.addPoints(t.project(a.latLng,f),p);h=Math.atan((d[o.number1]-e[o.number1])/(e[o.zero]-d[o.zero]))*o.angle.degree180/Math.PI,o.zero>h&&(h+=o.angle.degree360),h-=o.angle.degree270,o.zero>e[o.zero]-d[o.zero]&&(h+=o.angle.degree180)}if(r.objId!==i.itinerary.itineraryPoints.last.objId){let e=t.addPoints(t.project(l.latLng,f),p);for(b=Math.atan((d[o.number1]-e[o.number1])/(e[o.zero]-d[o.zero]))*o.angle.degree180/Math.PI,o.zero>e[o.zero]-d[o.zero]&&(b+=o.angle.degree180),b-=h;o.angle.degree0>b;)b+=o.angle.degree360;for(;o.angle.degree360<b;)b-=o.angle.degree360}r.objId===i.itinerary.itineraryPoints.first.objId&&(h=-b-o.angle.degree90,b=null,m=o.svgIcon.positionOnRoute.atStart),n.latLng[o.zero]===i.itinerary.itineraryPoints.last.lat&&n.latLng[o.number1]===i.itinerary.itineraryPoints.last.lng&&(b=null,m=o.svgIcon.positionOnRoute.atEnd)}(),null!==b&&(b<e.note.svgAnleMaxDirection.right?(N=w.getText("NoteDialog - Turn right"),y="&#x1f882;"):b<e.note.svgAnleMaxDirection.slightRight?(N=w.getText("NoteDialog - Turn slight right"),y="&#x1f885;"):b<e.note.svgAnleMaxDirection.continue?(N=w.getText("NoteDialog - Continue"),y="&#x1f881;"):b<e.note.svgAnleMaxDirection.slightLeft?(N=w.getText("NoteDialog - Turn slight left"),y="&#x1f884;"):b<e.note.svgAnleMaxDirection.left?(N=w.getText("NoteDialog - Turn left"),y="&#x1f880;"):b<e.note.svgAnleMaxDirection.sharpLeft?(N=w.getText("NoteDialog - Turn sharp left"),y="&#x1f887;"):b<e.note.svgAnleMaxDirection.sharpRight?(N=w.getText("NoteDialog - Turn sharp right"),y="&#x1f886;"):(N=w.getText("NoteDialog - Turn right"),y="&#x1f882;")),o.svgIcon.positionOnRoute.atStart===m?N=w.getText("NoteDialog - Start"):o.svgIcon.positionOnRoute.atEnd===m&&(N=w.getText("NoteDialog - Stop")),function(){let e=i.itinerary.itineraryPoints.previous(r.objId,I),a=i.itinerary.itineraryPoints.next(r.objId,I),n=-1,l=-1,c=-1,u=Number.MAX_VALUE,v=Number.MAX_VALUE,g=Number.MAX_VALUE,m=o.distance.defaultValue;d.forEach(o=>{r&&(m=t.pointsDistance([o.lat,o.lon],r.latLng))<u&&(n=o.id,u=m),e&&(m=t.pointsDistance([o.lat,o.lon],e.latLng))<v&&(l=o.id,v=m),a&&(m=t.pointsDistance([o.lat,o.lon],a.latLng))<g&&(c=o.id,g=m)});let p="",h="";s.forEach(e=>{if(!e.nodesIds.includes(n))return;let t=(e.tags.name?e.tags.name:"")+(e.tags.name&&e.tags.ref?" ":"")+(e.tags.ref?"["+e.tags.ref+"]":""),a=""!==t,r=e.nodesIds.includes(l),i=e.nodesIds.includes(c),s=e.nodesIds.filter(e=>e===n).length*o.number2;if(e.nodesIds[o.zero]===n&&s--,e.nodesIds[e.nodesIds.length-o.number1]===n&&s--,r&&(p=a?t:"???",s--),o.zero!==s&&(i&&(h=a?t:"???",s--),o.zero!==s&&a))for(;o.zero!==s;)L=""===L?t:L+" &#x2AA5; "+t,s--}),L=p+(""===L?"":" &#x2AA5; "+L)+" "+y+" "+h}(),function(){let a=o.numberMinus1,n=o.notFound,r=o.notFound,l=[];if(i.itinerary.itineraryPoints.forEach(i=>{a++;let s=t.addPoints(t.project(i.latLng,f),p);l.push(s),s[o.zero]>=o.zero&&s[o.number1]>=o.zero&&s[o.zero]<=e.note.svgIconWidth&&s[o.number1]<=e.note.svgIconWidth&&(o.notFound===n&&(n=a),r=a)}),o.notFound!==n&&o.notFound!==r){o.zero<n&&n--,i.itinerary.itineraryPoints.length-o.number1>r&&r++;let t="";for(a=n;a<=r;a++)t+=l[a][o.zero].toFixed(o.zero)+","+l[a][o.number1].toFixed(o.zero)+" ";let s=document.createElementNS("http://www.w3.org/2000/svg","polyline");s.setAttributeNS(null,"points",t),s.setAttributeNS(null,"class","TravelNotes-OSM-Itinerary"),s.setAttributeNS(null,"transform","rotate("+h+","+e.note.svgIconWidth/o.number2+","+e.note.svgIconWidth/o.number2+")"),g.appendChild(s)}}(),s.forEach(a=>{let n=o.notFound,r=o.notFound,i=o.numberMinus1,l=[];if(a.nodesIds.forEach(a=>{i++;let s=d.get(a),c=t.addPoints(t.project([s.lat,s.lon],f),p);l.push(c),c[o.zero]>=o.zero&&c[o.number1]>=o.zero&&c[o.zero]<=e.note.svgIconWidth&&c[o.number1]<=e.note.svgIconWidth&&(o.notFound===n&&(n=i),r=i)}),o.notFound!==n&&o.notFound!==r){o.zero<n&&n--,a.nodesIds.length-o.number1>r&&r++;let t="";for(i=n;i<=r;i++)t+=l[i][o.zero].toFixed(o.zero)+","+l[i][o.number1].toFixed(o.zero)+" ";let s=document.createElementNS("http://www.w3.org/2000/svg","polyline");s.setAttributeNS(null,"points",t),s.setAttributeNS(null,"class","TravelNotes-OSM-Highway TravelNotes-OSM-Highway-"+a.tags.highway),s.setAttributeNS(null,"transform","rotate("+h+","+e.note.svgIconWidth/o.number2+","+e.note.svgIconWidth/o.number2+")"),g.appendChild(s)}}),$=!1,E({svg:g,tooltip:N,city:v,place:u,streets:L,latLng:r.latLng})}).catch(e=>{$=!1,C(e)}))}return Object.seal({getPromiseIconAndAdress:(e,t)=>(e=e,t=t,n.latLng=e,i=x().getRoute(t),new Promise(E))});var C,A}const te=function(){let e=[],a=[],n=null,r=null,i=null,l=null,s=t();function d(){a.forEach(e=>r.add(s.create("option",{text:e.name}))),r.selectedIndex=o.notFound}function c(){e.forEach(e=>{s.create("button",{type:"button",innerHTML:e.title||"?",htmlBefore:e.htmlBefore||"",htmlAfter:e.htmlAfter||"",className:"TravelNotes-NoteDialog-EditorButton"},n).addEventListener("click",l,!1)})}function u(t){let i=new FileReader;i.onload=function(){try{let t=JSON.parse(i.result);e=e.concat(t.editionButtons),(a=a.concat(t.preDefinedIconsList)).sort((e,t)=>e.name.localeCompare(t.name));let s=null;for(;o.zero<document.getElementsByClassName("TravelNotes-NoteDialog-EditorButton").length;)(s=document.getElementsByClassName("TravelNotes-NoteDialog-EditorButton")[o.zero]).removeEventListener("click",l,!1),n.removeChild(s);c();for(let e=r.length-o.number1;e>=o.zero;e--)r.remove(e);d()}catch(e){console.log(e||"An error occurs when opening the file")}},i.readAsText(t.target.files[o.zero])}function v(e,t){return i=e,l=t,n=s.create("div",{className:"TravelNotes-NoteDialog-ToolbarDiv",id:"TravelNotes-NoteDialog-ToolbarDiv"}),function(){(r=s.create("select",{className:"TravelNotes-NoteDialog-Select",id:"TravelNotes-NoteDialog-IconSelect"},n)).addEventListener("change",i,!1),d();let e=s.create("div",{id:"TravelNotes-NoteDialog-OpenEditorFileDiv"},n),t=s.create("input",{id:"TravelNotes-NoteDialog-OpenEditorFileInput",type:"file",accept:".json"},e);t.addEventListener("change",u,!1);let o=s.create("div",{id:"TravelNotes-NoteDialog-OpenStyleFakeDiv"},e);s.create("button",{id:"TravelNotes-NoteDialog-OpenEditorFileButton",title:w.getText("NoteDialog - Open a configuration file"),innerHTML:"&#x1F4C2;"},o).addEventListener("click",()=>t.click(),!1),c()}(),n}return Object.seal({set selectOptions(e){var t;t=e,(a=a.concat(t)).sort((e,t)=>e.name.localeCompare(t.name))},set buttons(t){e=e.concat(t)},getIconData:e=>a[e],createToolbar:(e,t)=>v(e,t)})}();const oe=function(){let a=x(),n=P(),r=B();function i(r,i,l){(function(a,n,r){let i=null,l=t(),s=a.latLng,d="",c="",u=null,v=null,g=null,m=null,p=null,h=null,b=null,f=null,T=null,y=null,N=null;function L(){if(o.zero!==g.value.length)return a.iconWidth=m.value,a.iconHeight=p.value,a.iconContent=g.value,a.popupContent=h.value,a.tooltipContent=b.value,a.address=f.value,a.url=T.value,a.phone=y.value,a.latLng=s,a;u.showError(w.getText("Notedialog - The icon content cannot be empty"))}function I(t){d="",c="",t.address.house_number&&(d+=t.address.house_number+" "),t.address.road?d+=t.address.road+" ":t.address.pedestrian&&(d+=t.address.pedestrian+" "),t.address.village?c=t.address.village:t.address.town?c=t.address.town:t.address.city&&(c=t.address.city),""!==c&&(d+=e.note.cityPrefix+c+e.note.cityPostfix),o.zero===d.length&&(d+=t.address.country),e.note.reverseGeocoding&&""===a.address&&r&&(f.value=d)}function E(e){u.showError(w.getText("Notedialog - an error occurs when searching the adress")),console.log(e||"an error occurs when searching the adress.")}function C(t){g.value=t.svg.outerHTML,b.value=t.tooltip;let o=t.streets,a=""===t.city?c:t.city;""!==a&&(o+=" "+e.note.cityPrefix+a+e.note.cityPostfix),t.place&&t.place!==a&&(o+=" ("+t.place+")"),f.value=o,s=t.latLng,u.hideWait()}function A(e){u.hideWait(),u.showError(w.getText("Notedialog - an error occurs when creating the SVG icon")),console.log(e||"an error occurs when creating the SVG icon.")}function x(e){let t=te.getIconData(e.target.selectedIndex);"SvgIcon"===t.icon?o.invalidObjId===n?u.showError(w.getText("Notedialog - not possible to create a SVG icon for a travel note")):(u.showWait(),ee().getPromiseIconAndAdress(a.latLng,n).then(C).catch(A)):(u.hideError(),m.value=t.width,p.value=t.height,g.value=t.icon,b.value=t.tooltip)}function D(e){if(!i)return;let t=e.target;for(;!t.htmlBefore;)t=t.parentNode;let a=t.htmlAfter&&o.zero<t.htmlAfter.length,n=i.selectionStart,r=i.selectionEnd,l=i.value;i.value=l.substring(o.zero,n)+(a?t.htmlBefore+l.substring(n,r)+t.htmlAfter:t.htmlBefore)+l.substring(r),i.setSelectionRange(a||n===r?n+t.htmlBefore.length:n,(a?r:n)+t.htmlBefore.length),i.focus()}function P(e){i=e.target}return(u=j()).title=w.getText("NoteDialog - Note"),u.okButtonListener=L,(v=l.create("div",{id:"TravelNotes-NoteDialog-MainDataDiv"},u.content)).appendChild(te.createToolbar(x,D)),function(){let e=l.create("div",{className:"TravelNotes-NoteDialog-DataDiv",id:"TravelNotes-NoteDialog-DimensionsDataDiv"},v);l.create("text",{data:w.getText("NoteDialog - Icon width")},e),(m=l.create("input",{type:"number",className:"TravelNotes-NoteDialog-NumberInput",id:"TravelNotes-NoteDialog-WidthNumberInput"},e)).value=a.iconWidth,l.create("text",{data:w.getText("NoteDialog - Icon height")},e),(p=l.create("input",{type:"number",className:"TravelNotes-NoteDialog-NumberInput",id:"TravelNotes-NoteDialog-HeightNumberInput"},e)).value=a.iconHeight}(),l.create("div",{className:"TravelNotes-NoteDialog-TitleDiv",id:"TravelNotes-NoteDialog-IconContentTitleDiv",innerHTML:w.getText("NoteDialog - Icon content")},v),(g=l.create("textarea",{className:"TravelNotes-NoteDialog-TextArea",id:"TravelNotes-NoteDialog-TextArea-IconHtmlContent"},v)).addEventListener("focus",P,!1),g.value=a.iconContent,l.create("div",{className:"TravelNotes-NoteDialog-TitleDiv",innerHTML:w.getText("NoteDialog - Text")},v),(h=l.create("textarea",{className:"TravelNotes-NoteDialog-TextArea",id:"TravelNotes-NoteDialog-TextArea-PopupContent"},v)).addEventListener("focus",P,!1),h.value=a.popupContent,l.create("div",{className:"TravelNotes-NoteDialog-TitleDiv",innerHTML:w.getText("NoteDialog - Tooltip content")},v),(b=l.create("input",{type:"text",className:"TravelNotes-NoteDialog-InputText",id:"TravelNotes-NoteDialog-InputText-Tooltip"},v)).addEventListener("focus",P,!1),b.value=a.tooltipContent,(N=l.create("div",{className:"TravelNotes-NoteDialog-TitleDiv",innerHTML:'<span id="TravelNotes-NoteDialog-Reset-Address-Button">&#x1f504;</span>&nbsp;'+w.getText("NoteDialog - Address&nbsp;:")},v)).addEventListener("click",function(){f.value=d},!1),(f=l.create("input",{type:"text",className:"TravelNotes-NoteDialog-InputText",id:"TravelNotes-NoteDialog-InputText-Adress"},v)).addEventListener("focus",P,!1),f.value=a.address,W().getPromiseAddress(a.latLng).then(I).catch(E),l.create("div",{className:"TravelNotes-NoteDialog-TitleDiv",innerHTML:(e.layersToolbarUI.theDevil.addButton?'<a href="https://www.google.com/maps/@'+a.lat.toFixed(o.latLng.fixed)+","+a.lng.toFixed(o.latLng.fixed)+","+e.layersToolbarUI.theDevil.noteZoom+'z" target="_blank" title="'+e.layersToolbarUI.theDevil.title+'" >'+e.layersToolbarUI.theDevil.text+"</a> ":"")+w.getText("NoteDialog - Link")},v),(T=l.create("input",{type:"text",className:"TravelNotes-NoteDialog-InputText",id:"TravelNotes-NoteDialog-InputText-Link"},v)).addEventListener("focus",function(){i=null},!1),T.value=a.url,l.create("div",{className:"TravelNotes-NoteDialog-TitleDiv",innerHTML:w.getText("NoteDialog - Phone")},v),(y=l.create("input",{type:"text",className:"TravelNotes-NoteDialog-InputText",id:"TravelNotes-NoteDialog-InputText-Phone"},v)).addEventListener("focus",P,!1),y.value=a.phone,u})(r,i,l).show().then(()=>{if(l)if(o.invalidObjId===i)C.travel.notes.add(r);else{let e=a.getRoute(i);e.notes.add(r),r.chainedDistance=e.chainedDistance,e.notes.sort((e,t)=>e.distance-t.distance)}o.invalidObjId===i?n.dispatch("settravelnotes"):n.dispatch("setitinerary"),n.dispatch("noteupdated",{removedNoteObjId:r.objId,addedNoteObjId:r.objId})}).catch(e=>console.log(e||"An error occurs in the note dialog"))}function l(e){let t=p();return t.latLng=e,t.iconLatLng=e,t}function s(){let e=C.travel.notes.iterator;for(;!e.done;)n.dispatch("removeobject",{objId:e.value.objId});let t=C.travel.routes.iterator;for(;!t.done;)for(e=t.value.notes.iterator;!e.done;)n.dispatch("removeobject",{objId:e.value.objId});if(o.invalidObjId!==C.editedRouteObjId)for(e=C.travel.editedRoute.notes.iterator;!e.done;)n.dispatch("removeobject",{objId:e.value.objId})}return Object.seal({newRouteNote:(e,t)=>(function(e,t){let o=a.getRoute(e),n=r.getClosestLatLngDistance(o,[t.latlng.lat,t.latlng.lng]),s=l(n.latLng);s.distance=n.distance,i(s,o.objId,!0)})(e,t),newSearchNote:e=>(function(e){let t=l([e.lat,e.lon]);t.address=(e.tags["addr:housenumber"]?e.tags["addr:housenumber"]+" ":"")+(e.tags["addr:street"]?e.tags["addr:street"]+" ":"")+(e.tags["addr:city"]?e.tags["addr:city"]+" ":""),t.url=e.tags.website||"",t.phone=e.tags.phone||"",t.tooltipContent=e.tags.name||"",t.popupContent=e.tags.name||"",i(t,o.invalidObjId,!0)})(e),newManeuverNote:(e,t)=>(function(e,t){let o=r.getClosestLatLngDistance(C.travel.editedRoute,t),a=C.travel.editedRoute.itinerary.maneuvers.getAt(e),n=l(t);n.distance=o.distance,n.iconContent='<div class="TravelNotes-ManeuverNote TravelNotes-ManeuverNote-'+a.iconName+'"></div>',n.popupContent=a.instruction,i(n,C.travel.editedRoute.objId,!0)})(e,t),newTravelNote:e=>(e=e,void i(l(e),o.invalidObjId,!0)),editNote:e=>(function(e){let t=a.getNoteAndRoute(e),n=null===t.route?o.invalidObjId:t.route.objId;i(t.note,n,!1)})(e),removeNote:e=>(function(e){let t=a.getNoteAndRoute(e);t.route?(t.route.notes.remove(e),n.dispatch("updateitinerary")):(C.travel.notes.remove(e),n.dispatch("updatetravelnotes")),n.dispatch("noteupdated",{removedNoteObjId:e,addedNoteObjId:o.invalidObjId})})(e),hideNotes:()=>s(),showNotes:()=>(function(){s();let e=C.travel.notes.iterator;for(;!e.done;)n.dispatch("noteupdated",{removedNoteObjId:o.invalidObjId,addedNoteObjId:e.value.objId});let t=C.travel.routes.iterator;for(;!t.done;)for(e=t.value.notes.iterator;!e.done;)n.dispatch("noteupdated",{removedNoteObjId:o.invalidObjId,addedNoteObjId:e.value.objId})})(),attachNoteToRoute:e=>(function(e){let t=a.getNoteAndRoute(e),o=Number.MAX_VALUE,i=null,l=null,s=null;C.travel.routes.forEach(e=>{let a=r.getClosestLatLngDistance(e,t.note.latLng);if(a){let n=r.pointsDistance(t.note.latLng,a.latLng);n<o&&(o=n,i=e,l=a.latLng,s=a.distance)}}),i&&(C.travel.notes.remove(e),t.note.distance=s,t.note.latLng=l,t.note.chainedDistance=i.chainedDistance,i.notes.add(t.note),i.notes.sort((e,t)=>e.distance-t.distance),n.dispatch("noteupdated",{removedNoteObjId:e,addedNoteObjId:e}),n.dispatch("updateitinerary"),n.dispatch("updatetravelnotes"))})(e),detachNoteFromRoute:e=>(function(e){let t=a.getNoteAndRoute(e);t.route.notes.remove(e),t.note.distance=o.distance.invalid,t.note.chainedDistance=o.distance.defaultValue,C.travel.notes.add(t.note),n.dispatch("updateitinerary"),n.dispatch("updatetravelnotes"),n.dispatch("roadbookupdate")})(e),noteDropped:(e,t,o)=>(e=e,t=t,o=o,C.travel.notes.moveTo(e,t,o),n.dispatch("updatetravelnotes"),void n.dispatch("roadbookupdate"))});var d,c,u,v}();function ae(e){let a=t(),n=null,r=null,i=null;function l(e){"Enter"===e.key&&n.okButton.click()}function s(){return n.hideError(),!e||!(i.value.length<o.passwordDialog.pswdMinLength)&&i.value.match(RegExp("[0-9]+"))&&i.value.match(RegExp("[a-z]+"))&&i.value.match(RegExp("[A-Z]+"))&&i.value.match(RegExp("[^0-9a-zA-Z]"))?(document.removeEventListener("keydown",l,!1),(new window.TextEncoder).encode(i.value)):(n.showError(w.getText("PasswordDialog - Password rules")),void i.focus())}function d(){return document.removeEventListener("keydown",l,!1),!0}return(n=j()).title=w.getText("PasswordDialog - password"),n.okButtonListener=s,r=a.create("div",{id:"TravelNotes-PasswordDialog-DataDiv"},n.content),document.addEventListener("keydown",l,!1),n.escapeKeyListener=d,i=a.create("input",{id:"TravelNotes-PasswordDialog-PasswordInput",type:"password"},r),n.onShow=function(){i.focus()},n}function ne(){function e(e){return window.crypto.subtle.importKey("raw",e,{name:"PBKDF2"},!1,["deriveKey"])}function t(e){return window.crypto.subtle.deriveKey({name:"PBKDF2",salt:(new window.TextEncoder).encode("Tire la chevillette la bobinette cherra. Le Petit Chaperon rouge tira la chevillette."),iterations:1e6,hash:"SHA-256"},e,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}return Object.seal({encryptData:function(o,a,n,r){!function(o,a,n,r){let i=window.crypto.getRandomValues(new Uint8Array(16));r.then(e).then(t).then(function(e){return window.crypto.subtle.encrypt({name:"AES-GCM",iv:i},e,o)}).then(function(e){a(new Blob([i,new Uint8Array(e)],{type:"application/octet-stream"}))}).catch(n)}(o,a,n,r)},decryptData:function(o,a,n,r){!function(o,a,n,r){r.then(e).then(t).then(function(e){return window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(o.slice(0,16))},e,new Uint8Array(o.slice(16)))}).then(a).catch(n)}(o,a,n,r)}})}function re(a){let n=t(),r=null,i=null,l=null,s=null,d=null;function c(){let e=[],t=l.childNodes;for(let a=o.zero;a<t.length;a++)e.push({providerName:t[a].childNodes[o.zero].value,providerKey:t[a].childNodes[o.number1].value});return e}function u(){let e=!0;r.hideError();let t=l.childNodes;for(let a=o.zero;a<t.length;a++)e=(e=e&&""!==t[a].childNodes[o.zero].value)&&""!==t[a].childNodes[o.number1].value;return e||r.showError(w.getText("APIKeysDialog - empty API key name or value")),e}function v(){if(r.hideError(),u())return c()}function g(t){let o=n.create("div",{className:"TravelNotes-APIKeysDialog-ApiKeyRow"},l);n.create("input",{className:"TravelNotes-APIKeysDialog-ApiKeyName TravelNotes-APIKeysDialog-Input",value:t.providerName,placeholder:w.getText("APIKeysDialog - provider name")},o),n.create("input",{className:"TravelNotes-APIKeysDialog-ApiKeyValue TravelNotes-APIKeysDialog-Input",value:t.providerKey,placeholder:w.getText("APIKeysDialog - API key"),type:e.APIKeys.showAPIKeysInDialog?"text":"password"},o),n.create("div",{className:"TravelNotes-APIKeysDialog-Button TravelNotes-APIKeysDialog-DeleteButton",title:w.getText("APIKeysDialog - delete API key"),innerHTML:"&#x274c"},o).addEventListener("click",e=>{e.stopPropagation(),e.target.parentNode.parentNode.removeChild(e.target.parentNode)},!1)}function m(){r.showError(w.getText("APIKeysDialog - An error occurs when saving the keys")),r.hideWait()}function p(e){r.hideError(),r.hideWait();let t=URL.createObjectURL(e),o=document.createElement("a");o.setAttribute("href",t),o.setAttribute("download","APIKeys"),o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(t)}function h(){r.hideWait(),r.showError(w.getText("APIKeysDialog - An error occurs when reading the file"))}function b(e){let t=null;try{t=JSON.parse((new TextDecoder).decode(e))}catch(e){return void h()}for(;l.firstChild;)l.removeChild(l.firstChild);t.forEach(e=>g(e)),r.hideWait(),r.hideError()}return(r=j()).title=w.getText("APIKeysDialog - API keys"),r.okButtonListener=v,i=n.create("div",{className:"TravelNotes-APIKeysDialog-ToolbarDiv",id:"TravelNotes-APIKeysDialog-ToolbarDiv"},r.content),l=n.create("div",{id:"TravelNotes-APIKeysDialog-DataDiv"},r.content),function(){if(e.haveCrypto){n.create("div",{id:"TravelNotes-APIKeysDialog-SaveToFileButton",className:"TravelNotes-APIKeysDialog-Button",title:w.getText("APIKeysDialog - Save to file"),innerHTML:"&#x1f4be;"},i).addEventListener("click",e=>{e.stopPropagation(),r.hideError(),u()&&(r.showWait(),ne().encryptData((new window.TextEncoder).encode(JSON.stringify(c())),p,m,ae(!0).show()))},!1);let e=n.create("div",{id:"TravelNotes-APIKeysDialog-OpenFileDiv"},i);(s=n.create("input",{id:"TravelNotes-APIKeysDialog-OpenFileInput",type:"file"},e)).addEventListener("change",e=>{!function(e){r.hideError(),r.showWait(),e.stopPropagation();let t=new FileReader;t.onload=function(){ne().decryptData(t.result,b,h,ae(!1).show())},t.readAsArrayBuffer(e.target.files[o.zero])}(e)},!1);let t=n.create("div",{id:"TravelNotes-APIKeysDialog-OpenFileFakeDiv"},e);n.create("div",{id:"TravelNotes-APIKeysDialog-OpenFileButton",className:"TravelNotes-APIKeysDialog-Button",title:w.getText("APIKeysDialog - Open file"),innerHTML:"&#x1F4C2;"},t).addEventListener("click",()=>{s.click()},!1)}if(n.create("div",{id:"TravelNotes-APIKeysDialog-NewKeyButton",className:"TravelNotes-APIKeysDialog-Button",title:w.getText("APIKeysDialog - new API key"),innerHTML:"+"},i).addEventListener("click",e=>{e.stopPropagation(),g({providerName:"",providerKey:""})},!1),e.APIKeys.dialogHaveUnsecureButtons){n.create("div",{id:"TravelNotes-APIKeysDialog-SaveToJsonFileButton",className:"TravelNotes-APIKeysDialog-Button",title:w.getText("APIKeysDialog - Save to json file"),innerHTML:"&#x1f4be;"},i).addEventListener("click",e=>{e.stopPropagation(),r.hideError(),u()&&E().saveFile("APIKeys.json",JSON.stringify(c()))},!1);let e=n.create("div",{id:"TravelNotes-APIKeysDialog-OpenJsonFileDiv"},i);(d=n.create("input",{id:"TravelNotes-APIKeysDialog-OpenJsonFileInput",type:"file"},e)).addEventListener("change",e=>{!function(e){e.stopPropagation(),r.hideError();let t=new FileReader;t.onload=function(){try{let e=JSON.parse(t.result);for(;l.firstChild;)l.removeChild(l.firstChild);e.forEach(e=>g(e))}catch(e){r.showError(e.message),console.log(e||"An error occurs when reading the file")}},t.readAsText(e.target.files[o.zero])}(e)},!1);let t=n.create("div",{id:"TravelNotes-APIKeysDialog-OpenJsonFileFakeDiv"},e);n.create("div",{id:"TravelNotes-APIKeysDialog-OpenJsonFileButton",className:"TravelNotes-APIKeysDialog-Button",title:w.getText("APIKeysDialog - Open json file"),innerHTML:"&#x1F4C2;"},t).addEventListener("click",()=>{d.click()},!1)}}(),a.forEach(e=>g(e)),A.showHelp(w.getText("Help - Complete the APIKeys")),r}let ie=new Map;const le=function(){function t(e){return ie.get(e.toLowerCase())}function n(e,t){ie.set(e.toLowerCase(),t)}function r(o){sessionStorage.clear(),ie.clear();let a=E().storageAvailable("sessionStorage")&&e.APIKeys.saveToSessionStorage;o.forEach(e=>{a&&sessionStorage.setItem(e.providerName.toLowerCase()+"ProviderKey",btoa(e.providerKey)),n(e.providerName,e.providerKey)}),C.providers.forEach(e=>{e.providerKey=t(e.name)||""}),P().dispatch("providersadded")}function i(e){r(JSON.parse((new TextDecoder).decode(e))),A.showHelp(w.getText("Help - Continue with interface"))}function l(e){console.log(e||"An error occurs when reading the APIKeys file"),A.showHelp(w.getText("Help - Continue with interface"))}function s(e){A.showHelp(w.getText("Help - gives a password for the APIKeys file or cancel")),ne().decryptData(e,i,l,ae(!1).show())}function d(){o.zero===function(){let e=o.zero;for(let t=o.zero;t<sessionStorage.length;t++){let a=sessionStorage.key(t);"ProviderKey"===a.substr(a.length-"ProviderKey".length)&&(n(a.substr(o.zero,a.length-"ProviderKey".length),atob(sessionStorage.getItem(a))),e++)}return C.providers.forEach(e=>{e.providerKey=t(e.name)||""}),e}()?e.haveCrypto&&a().getBinaryPromise(window.location.href.substr(o.zero,window.location.href.lastIndexOf("/")+o.number1)+"APIKeys").then(s).catch(e=>console.log(e||"APIKeys not found on server")):P().dispatch("providersadded")}return Object.seal({fromServerFile:()=>d(),fromUrl:t=>(function(t){let a=t.split("=");if(o.number2===a.length){let t=a[o.zero].substr(o.zero,a[o.zero].length-"ProviderKey".length).toLowerCase(),r=a[o.number1];E().storageAvailable("sessionStorage")&&e.APIKeys.saveToSessionStorage&&sessionStorage.setItem(t+"ProviderKey",btoa(r)),n(t,r);let i=C.providers.get(t);i&&(i.providerKey=r)}})(t),dialog:()=>(function(){let e=[];ie.forEach((t,o)=>e.push({providerName:o,providerKey:t})),e.sort((e,t)=>e.providerName.localeCompare(t.providerName)),re(e).show().then(e=>r(e)).catch(e=>console.log(e||"canceled by user"))})(),getKey:e=>t(e),setKey:(e,t)=>n(e,t),addProvider:e=>(function(e){let o=e.name.toLowerCase(),a=t(o);e.providerKeyNeeded&&!a&&E().storageAvailable("sessionStorage")&&(a=sessionStorage.getItem(o))&&(a=atob(a)),e.providerKeyNeeded&&a&&(e.providerKey=a),C.providers.set(e.name.toLowerCase(),e)})(e)})}();function se(e){let t=x(),a=t.getRoute(e.target.objId),n=B().getClosestLatLngDistance(a,[e.latlng.lat,e.latlng.lng]).distance;n+=a.chainedDistance,n=E().formatDistance(n);let r=C.mapObjects.get(e.target.objId);r.closeTooltip();let i=t.getRoute(e.target.objId).name;C.travel.readOnly||(i+=o.zero===i.length?"":" - ",i+=n),r.setTooltipContent(i),r.openTooltip(e.latlng)}const de=function(){let t=x(),a=null,n=null;function r(e,t){t.objId=e,t.addTo(C.map),C.mapObjects.set(e,t)}function i(a){let n=t.getNoteAndRoute(a).note,i=C.travel.readOnly,l=L.marker(n.latLng,{icon:L.divIcon({iconSize:[e.note.grip.size,e.note.grip.size],iconAnchor:[e.note.grip.size/o.number2,e.note.grip.size/o.number2],html:"<div></div>"}),opacity:e.note.grip.opacity,draggable:!i});l.objId=n.objId;let s=L.divIcon({iconSize:[n.iconWidth,n.iconHeight],iconAnchor:[n.iconWidth/o.number2,n.iconHeight/o.number2],popupAnchor:[o.zero,-n.iconHeight/o.number2],html:n.iconContent,className:"TravelNotes-AllNotes "+e.note.style}),d=L.marker(n.iconLatLng,{zIndexOffset:o.note.zIndexOffset,icon:s,draggable:!i});d.objId=n.objId,d.bindPopup(e=>{let o=t.getNoteAndRoute(e.objId).note;return M("TravelNotes-").getNoteHTML(o)}),o.zero!==n.tooltipContent.length&&(d.bindTooltip(e=>t.getNoteAndRoute(e.objId).note.tooltipContent),d.getTooltip().options.offset[o.zero]=n.iconWidth/o.number2);let c=L.polyline([n.latLng,n.iconLatLng],e.note.polyline);c.objId=n.objId;let u=L.layerGroup([d,c,l]);u.markerId=L.Util.stamp(d),u.polylineId=L.Util.stamp(c),u.bulletId=L.Util.stamp(l),r(n.objId,u)}function l(t){t.dashArray>=e.route.dashChoices.length&&(t.dashArray=o.zero);let a=e.route.dashChoices[t.dashArray].iDashArray;if(a){let e="",n=o.zero;for(n=o.zero;n<a.length-o.number1;n++)e+=a[n]*t.width+",";return e+=a[n]*t.width}return null}return Object.seal({addRoute:e=>(function(e){let o=t.getRoute(e),a=[],n=o.itinerary.itineraryPoints.iterator;for(;!n.done;)a.push(n.value.latLng);let s=L.polyline(a,{color:o.color,weight:o.width,dashArray:l(o)});r(o.objId,s),s.bindTooltip(o.name,{sticky:!0,direction:"right"}),s.on("mouseover",se),s.on("mousemove",se),s.bindPopup(e=>{let o=t.getRoute(e.objId);return M("TravelNotes-").getRouteHTML(o)}),L.DomEvent.on(s,"click",e=>e.target.openPopup(e.latlng));let d=o.notes.iterator;for(;!d.done;)i(d.value.objId);return o})(e),addNote:e=>i(e),getDashArray:e=>l(e),zoomTo:(t,o)=>(function(t,o){if(o){let e=[];o.forEach(t=>e=e.concat(t)),C.map.fitBounds(B().getLatLngBounds(e))}else C.map.setView(t,e.itineraryPointZoom)})(t,o),setLayer:e=>(function(e){let t=null;t="wmts"===e.service.toLowerCase()?L.tileLayer(e.url):L.tileLayer.wms(e.url,e.wmsOptions),a&&C.map.removeLayer(a),C.map.addLayer(t),a=t,C.travel.readOnly||(C.map.getZoom()<(e.minZoom||o.mapEditor.defaultMinZoom)&&C.map.setZoom(e.minZoom||o.mapEditor.defaultMinZoom),C.map.setMinZoom(e.minZoom||o.mapEditor.defaultMinZoom),C.map.getZoom()>(e.maxZoom||o.mapEditor.defaultMaxZoom)&&C.map.setZoom(e.maxZoom||o.mapEditor.defaultMaxZoom),C.map.setMaxZoom(e.maxZoom||o.mapEditor.defaultMaxZoom),e.bounds?(C.map.getBounds().intersects(e.bounds)&&!C.map.getBounds().contains(e.bounds)||(C.map.setMaxBounds(null),C.map.fitBounds(e.bounds),C.map.setZoom(e.minZoom||o.mapEditor.defaultMinZoom)),C.map.setMaxBounds(e.bounds)):C.map.setMaxBounds(null)),C.map.fire("baselayerchange",t)})(e),onGeolocationStatusChanged:e=>(e=e,void(o.geoLocation.status.active!==e&&n&&(C.map.removeLayer(n),n=null))),onGeolocationPositionChanged:t=>(function(t){let o=e.geoLocation.zoomToPosition;n&&(C.map.removeLayer(n),o=!1),n=L.circleMarker(L.latLng(t.coords.latitude,t.coords.longitude),{radius:e.geoLocation.radius,color:e.geoLocation.color}).bindTooltip(E().formatLatLng([t.coords.latitude,t.coords.longitude])).addTo(C.map),o&&C.map.setView(L.latLng(t.coords.latitude,t.coords.longitude),e.geoLocation.zoomFactor)})(t)});var s}();const ce=function(){let t=x(),a=P(),n=B();function r(e,t){t.objId=e,t.addTo(C.map),C.mapObjects.set(e,t)}function i(e){let t=C.mapObjects.get(e);t&&(L.DomEvent.off(t),C.map.removeLayer(t),C.mapObjects.delete(e))}function l(e){let r=C.mapObjects.get(e),i=r.getLayer(r.bulletId),l=r.getLayer(r.markerId);L.DomEvent.on(i,"dragend",e=>{let o=t.getNoteAndRoute(e.target.objId),r=o.note,i=o.route,l=C.mapObjects.get(e.target.objId);if(null===i)r.latLng=[e.target.getLatLng().lat,e.target.getLatLng().lng],a.dispatch("updatetravelnotes");else{let t=n.getClosestLatLngDistance(i,[e.target.getLatLng().lat,e.target.getLatLng().lng]);r.latLng=t.latLng,r.distance=t.distance,i.notes.sort((e,t)=>e.distance-t.distance),l.getLayer(l.bulletId).setLatLng(t.latLng),a.dispatch("updateitinerary")}l.getLayer(l.polylineId).setLatLngs([r.latLng,r.iconLatLng]),a.dispatch("roadbookupdate")}),L.DomEvent.on(i,"drag",e=>{let o=t.getNoteAndRoute(e.target.objId).note,a=C.mapObjects.get(e.target.objId);a.getLayer(a.polylineId).setLatLngs([[e.latlng.lat,e.latlng.lng],o.iconLatLng])}),L.DomEvent.on(l,"contextmenu",e=>(function(e){let t=e.target.objId,a=O(),n=_(e);return n.init(function(){let e=x().getNoteAndRoute(t).route;return[{context:oe,name:w.getText("ContextMenuFactory - Edit this note"),action:oe.editNote,param:t},{context:oe,name:w.getText("ContextMenuFactory - Delete this note"),action:oe.removeNote,param:t},{context:a,name:w.getText("ContextMenuFactory - Zoom to note"),action:a.zoomToNote,param:t},{context:oe,name:e?w.getText("ContextMenuFactory - Detach note from route"):w.getText("ContextMenuFactory - Attach note to route"),action:C.travel.routes.length!==o.zero&&o.invalidObjId===C.editedRouteObjId?e?oe.detachNoteFromRoute:oe.attachNoteToRoute:null,param:t}]}()),Object.seal(n)})(e).show()),L.DomEvent.on(l,"dragend",e=>{let o=t.getNoteAndRoute(e.target.objId).note;o.iconLatLng=[e.target.getLatLng().lat,e.target.getLatLng().lng];let a=C.mapObjects.get(e.target.objId);a.getLayer(a.polylineId).setLatLngs([o.latLng,o.iconLatLng])}),L.DomEvent.on(l,"drag",e=>{let o=t.getNoteAndRoute(e.target.objId).note,a=C.mapObjects.get(e.target.objId);a.getLayer(a.polylineId).setLatLngs([o.latLng,[e.latlng.lat,e.latlng.lng]])})}function s(e,a){if(o.latLng.defaultValue===e.lat&&o.latLng.defaultValue===e.lng)return;let n='<div class="TravelNotes-WayPoint TravelNotes-WayPoint'+("A"===a?"Start":"B"===a?"End":"Via")+'"></div><div class="TravelNotes-WayPointText">'+a+"</div>",i=L.marker(e.latLng,{icon:L.divIcon({iconSize:[o.mapEditor.wayPointIconSize,o.mapEditor.wayPointIconSize],iconAnchor:[o.mapEditor.wayPointIconSize/o.number2,o.mapEditor.wayPointIconSize],html:n,className:"TravelNotes-WayPointStyle"}),draggable:!0});i.bindTooltip(e=>E().formatLatLng(t.getWayPoint(e.objId).latLng)),i.getTooltip().options.offset=[o.mapEditor.wayPointIconSize/o.number2,-o.mapEditor.wayPointIconSize/o.number2],L.DomEvent.on(i,"contextmenu",e=>(function(e){let t=e.target.objId,o=_(e);return o.init(function(){let e=C.travel.editedRoute.wayPoints.first.objId!==t&&C.travel.editedRoute.wayPoints.last.objId!==t;return[{context:K,name:w.getText("ContextMenuFactory - Delete this waypoint"),action:e?K.removeWayPoint:null,param:t}]}()),Object.seal(o)})(e).show()),i.objId=e.objId,r(e.objId,i),L.DomEvent.on(i,"dragend",e=>{C.travel.editedRoute.wayPoints.getAt(e.target.objId).latLng=[e.target.getLatLng().lat,e.target.getLatLng().lng],K.wayPointDragEnd(e.target.objId)})}function d(e){let t=de.addRoute(e),a=C.mapObjects.get(e);if(!C.travel.readOnly){L.DomEvent.on(a,"contextmenu",e=>(function(e){let t=e.target.objId,a=O(),n=_(e);return n.init([{context:S,name:w.getText("ContextMenuFactory - Edit this route"),action:t===C.travel.editedRoute.objId||o.route.edited.editedChanged===C.travel.editedRoute.edited?null:V.editRoute,param:t},{context:V,name:w.getText("ContextMenuFactory - Delete this route"),action:t===C.travel.editedRoute.objId&&o.route.edited.editedChanged===C.travel.editedRoute.edited?null:V.removeRoute,param:t},{context:S,name:w.getText("ContextMenuFactory - Hide this route"),action:C.travel.editedRoute.objId===t?null:S.hideRoute,param:t},{context:K,name:w.getText("ContextMenuFactory - Add a waypoint on the route"),action:t===C.travel.editedRoute.objId?K.addWayPointOnRoute:null,param:t},{context:oe,name:w.getText("ContextMenuFactory - Add a note on the route"),action:oe.newRouteNote,param:t},{context:S,name:w.getText("ContextMenuFactory - Properties"),action:S.routeProperties,param:t},{context:a,name:w.getText("ContextMenuFactory - Zoom to route"),action:a.zoomToRoute,param:t},{context:S,name:w.getText("ContextMenuFactory - Save modifications on this route"),action:C.travel.editedRoute.objId===t?S.saveEdition:null},{context:S,name:w.getText("ContextMenuFactory - Cancel modifications on this route"),action:C.travel.editedRoute.objId===t?S.cancelEdition:null}]),Object.seal(n)})(e).show());let e=t.notes.iterator;for(;!e.done;)l(e.value.objId)}if(!C.travel.readOnly&&o.route.edited.notEdited!==t.edited){let e=C.travel.editedRoute.wayPoints.iterator;for(;!e.done;)s(e.value,e.first?"A":e.last?"B":e.index)}}function c(e,a){o.invalidObjId!==e&&function(e){let o=t.getRoute(e);i(o.objId);let a=o.notes.iterator;for(;!a.done;)i(a.value.objId);let n=o.wayPoints.iterator;for(;!n.done;)i(n.value.objId)}(e),o.invalidObjId!==a&&d(a)}function u(e,t){var a;o.invalidObjId!==e&&i(e),o.invalidObjId!==t&&(a=t,de.addNote(a),C.travel.readOnly||l(a))}return Object.seal({updateRoute:(e,t)=>c(e,t),updateRouteProperties:e=>(function(e){let o=t.getRoute(e);C.mapObjects.get(o.objId).setStyle({color:o.color,weight:o.width,dashArray:de.getDashArray(o)})})(e),updateNote:(e,t)=>u(e,t),removeObject:e=>i(e),removeAllObjects:()=>(C.mapObjects.forEach(e=>{L.DomEvent.off(e),C.map.removeLayer(e)}),void C.mapObjects.clear()),addItineraryPointMarker:(t,o)=>(t=t,o=o,void r(t,L.circleMarker(o,e.itineraryPointMarker))),addSearchPointMarker:(t,a,i)=>(function(t,a,i){let l=!1;if(i){let e=[];i.forEach(t=>{e=e.concat(t)});let t=n.getLatLngBounds(e),a=C.map.getBounds();l=(t.getEast()-t.getWest())/(a.getEast()-a.getWest())>o.mapEditor.markerBoundsPrecision&&(t.getNorth()-t.getSouth())/(a.getNorth()-a.getSouth())>o.mapEditor.markerBoundsPrecision}r(t,l?L.polyline(i,e.searchPointPolyline):L.circleMarker(a,e.searchPointMarker))})(t,a,i),addRectangle:(e,t,o)=>(function(e,t,o){r(e,L.rectangle(t,o))})(e,t,o),addWayPoint:(e,t)=>s(e,t),setLayer:e=>(function(e){let t=e.url;if(e.providerKeyNeeded){let o=le.getKey(e.providerName.toLowerCase());if(!o)return;t=t.replace("{providerKey}",o)}e.url=t,de.setLayer(e)})(e)});var v,g}();function ue(e,a){let n=o.zero,r=t(),i=[],l={minSize:o.number2,listStyle:"AllSort",id:"TravelNotes-SortableList-Container"},s=r.create("div",{id:l.id,className:"TravelNotes-SortableList-Container"});function d(e){e.stopPropagation();try{e.dataTransfer.setData("Text",e.target.dataObjId),e.dataTransfer.dropEffect="move"}catch(e){console.log(e)}n=e.target.dataObjId-o.number1}function c(e){let t=new Event("SortableListDelete");t.itemNode=e.target.parentNode,e.target.parentNode.parentNode.dispatchEvent(t),e.stopPropagation()}function u(e){let t=new Event("SortableListUpArrow");t.itemNode=e.target.parentNode,e.target.parentNode.parentNode.dispatchEvent(t),e.stopPropagation()}function v(e){let t=new Event("SortableListDownArrow");t.itemNode=e.target.parentNode,e.target.parentNode.parentNode.dispatchEvent(t),e.stopPropagation()}function g(e){let t=new Event("SortableListRightArrow");t.itemNode=e.target.parentNode,e.target.parentNode.parentNode.dispatchEvent(t),e.stopPropagation()}function m(e){let t=new Event("SortableListChange");t.dataObjId=e.target.parentNode.dataObjId,t.changeValue=e.target.value,e.target.parentNode.parentNode.dispatchEvent(t),e.stopPropagation()}function p(e){let t=r.create("div",{draggable:!1,className:"TravelNotes-SortableList-Item"});r.create("div",{className:"TravelNotes-SortableList-ItemTextIndex",innerHTML:e.label||""},t);let a=r.create("input",{type:"text",className:"TravelNotes-SortableList-ItemInput",placeholder:e.placeholder||"",value:e.value||""},t);a.addEventListener("change",m,!1),a.addEventListener("focus",e=>{e.target.parentElement.draggable=!1},!1),a.addEventListener("blur",e=>{e.target.parentElement.draggable=e.target.parentElement.canDrag},!1),r.create("div",{className:"TravelNotes-SortableList-ItemUpArrowButton",title:w.getText("SortableList - Move up"),innerHTML:"&#x21e7;"},t).addEventListener("click",u,!1),r.create("div",{className:"TravelNotes-SortableList-ItemDownArrowButton",title:w.getText("SortableList - Move down"),innerHTML:"&#x21e9;"},t).addEventListener("click",v,!1);let n=r.create("div",{className:"TravelNotes-SortableList-ItemRightArrowButton",title:w.getText("SortableList - Edit"),innerHTML:"&#x21f0;"},t);"AllSort"===l.listStyle&&n.addEventListener("click",g,!1),r.create("div",{className:"TravelNotes-SortableList-ItemDeleteButton",title:w.getText("SortableList - Delete"),innerHTML:"&#x267b;"},t).addEventListener("click",c,!1),t.dataObjId=e.objId||o.invalidObjId,t.canDrag=!1,("LimitedSort"!==l.listStyle||o.number1<i.length)&&!e.isLast&&(t.draggable=!0,t.addEventListener("dragstart",d,!1),t.classList.add("TravelNotes-SortableList-MoveCursor"),t.canDrag=!0),i.push(t),s.appendChild(t)}for(let t in e)l[t]=e[t];"LimitedSort"===l.listStyle&&o.number2>l.minSize&&(l.minSize=o.zero),s.classList.add(l.listStyle),s.addEventListener("drop",function(e){e.preventDefault();let t=e.target;for(;!t.dataObjId;)t=t.parentElement;let a=t.getBoundingClientRect(),r=new Event("SortableListDrop");r.draggedObjId=n+o.number1,r.targetObjId=t.dataObjId,r.draggedBefore=e.clientY-a.top<a.bottom-e.clientY,t.parentNode.dispatchEvent(r)},!1),s.addEventListener("dragover",function(e){e.preventDefault()},!1),s.addEventListener("wheel",function(e){e.deltaY&&(e.target.scrollTop+=e.deltaY*o.mouse.wheelCorrectionFactors[e.deltaMode]),e.stopPropagation()},!1),a&&a.appendChild(s);for(let e=o.zero;e<l.minSize;e++)p();return Object.seal({removeAllItems:()=>(function(){for(let e=o.zero;e<i.length;e++)s.removeChild(i[e]);i.length=o.zero})(),addItem:e=>p(e),get container(){return s}})}const ve=function(){let e=null;function a(t){e.innerHTML='&copy; <a href="http://leafletjs.com/" target="_blank" title="Leaflet">Leaflet</a> '+t+'| &copy; <a href="https://github.com/wwwouaiebe" target="_blank" title="https://github.com/wwwouaiebe">Travel & Notes</a> '}return Object.seal({set attributions(e){a(e)},createUI:()=>(e=t().create("div",{id:"TravelNotes-AttributionsUI"},document.getElementsByTagName("body")[o.zero]),void a(""))})}();const ge=function(){let a=[{service:"wmts",url:"https://{s}.tile.osm.org/{z}/{x}/{y}.png",name:"OSM - Color",toolbar:{text:"OSM",color:"red",backgroundColor:"white"},providerName:"OSM",providerKeyNeeded:!1,attribution:'| &copy; <a href="http://www.openstreetmap.org/copyright" target="_blank" title="OpenStreetMap contributors">OpenStreetMap contributors</a> '}],n=null,r=null,i=null,l=t(),s=P(),d=o.zero,c=o.zero,u=o.zero,v=o.zero;function g(e){e.target.setAttribute("style","color:"+e.target.layer.toolbar.backgroundColor+";background-color:"+e.target.layer.toolbar.color)}function m(e){e.target.setAttribute("style","color:"+e.target.layer.toolbar.color+";background-color:"+e.target.layer.toolbar.backgroundColor)}function p(e){e.target.classList.add("TravelNotes-LayersToolbarUI-LinkButton-Enter"),e.target.classList.remove("TravelNotes-LayersToolbarUI-LinkButton-Leave")}function h(e){e.target.classList.add("TravelNotes-LayersToolbarUI-LinkButton-Leave"),e.target.classList.remove("TravelNotes-LayersToolbarUI-LinkButton-Enter")}function b(e){s.dispatch("layerchange",{layer:e.target.layer}),ve.attributions=e.target.layer.attribution,C.travel.layerName=e.target.layer.name}function f(e){e.deltaY&&(d=(d=(d-=e.deltaY*o.mouse.wheelCorrectionFactors[e.deltaMode])>v?v:d)<v-u+o.layersToolbarUI.buttonsAlwaysVisible*c?v-u+o.layersToolbarUI.buttonsAlwaysVisible*c:d,i.style.marginTop=String(d)+"px"),e.stopPropagation()}function T(){let e=i.childNodes;for(let t=0;t<e.length;t++)"layer"===e[t].type?(e[t].removeEventListener("mouseenter",g,!1),e[t].removeEventListener("mouseleave",m,!1),e[t].removeEventListener("click",b,!1)):(e[t].removeEventListener("mouseenter",p,!1),e[t].removeEventListener("mouseleave",p,!1));i.removeEventListener("wheel",f,!1),r.removeChild(i),n=null}function y(){if(n)return clearTimeout(n),void(n=null);i=l.create("div",{id:"TravelNotes-LayersToolbarUI-Buttons"},r),v=r.clientHeight,u=o.zero,a.forEach(e=>(function(e){if(e.providerKeyNeeded&&!le.getKey(e.providerName.toLowerCase()))return;let t=l.create("div",{type:"layer",className:"TravelNotes-LayersToolbarUI-Button",title:e.name,layer:e,innerHTML:e.toolbar.text,style:"color:"+e.toolbar.color+";background-color:"+e.toolbar.backgroundColor},i);t.addEventListener("mouseenter",g,!1),t.addEventListener("mouseleave",m,!1),t.addEventListener("click",b,!1),c=t.clientHeight,u+=c})(e)),e.layersToolbarUI.theDevil&&e.layersToolbarUI.theDevil.addButton&&function(e,t,o){let a=l.create("div",{type:"link",className:"TravelNotes-LayersToolbarUI-Button TravelNotes-LayersToolbarUI-LinkButton-Leave",innerHTML:'<a href="'+e+'" title="'+t+'" target="_blank">'+o+"</a>"},i);a.addEventListener("mouseenter",p,!1),a.addEventListener("mouseleave",h,!1),u+=a.clientHeight}("https://www.google.com/maps/@"+C.map.getCenter().lat+","+C.map.getCenter().lng+","+C.map.getZoom()+"z",e.layersToolbarUI.theDevil.title,e.layersToolbarUI.theDevil.text),d=v+=c,i.style.marginTop=String(d)+"px",i.addEventListener("wheel",f,!1)}function N(){r=l.create("div",{id:"TravelNotes-LayersToolbarUI"},document.getElementsByTagName("body")[o.zero]),l.create("div",{id:"TravelNotes-LayersToolbarUI-Header",innerHTML:w.getText("LayersToolbarUI - Layers")},r),r.addEventListener("mouseenter",y,!1),r.addEventListener("mouseleave",()=>{n=setTimeout(T,e.layersToolbarUI.toolbarTimeOut)},!1),s.dispatch("layerchange",{layer:a[o.zero]}),ve.attributions=a[o.zero].attribution}return Object.seal({createUI:()=>N(),setLayer:e=>(function(e){let t=a.find(t=>t.name===e)||a[o.zero];t.providerKeyNeeded&&(le.getKey(t.providerName.toLowerCase())||(t=a[o.zero])),s.dispatch("layerchange",{layer:t}),ve.attributions=t.attribution,C.travel.layerName=t.name})(e),setLayers:e=>(e=e,void(a=a.concat(e)))});var L}();function me(){let e=P();function t(){let t=C.travel.routes.iterator;for(;!t.done;)o.route.edited.notEdited===t.value.edited&&e.dispatch("routeupdated",{removedRouteObjId:o.invalidObjId,addedRouteObjId:t.value.objId});o.invalidObjId!==C.editedRouteObjId&&e.dispatch("routeupdated",{removedRouteObjId:o.invalidObjId,addedRouteObjId:C.travel.editedRoute.objId});let a=C.travel.notes.iterator;for(;!a.done;)e.dispatch("noteupdated",{removedNoteObjId:o.invalidObjId,addedNoteObjId:a.value.objId});O().zoomToTravel(),e.dispatch("travelnotesfileloaded",{name:C.travel.name})}return Object.seal({openDistantFile:e=>(e=e,F().decompress(e),void t()),display:()=>t()});var a}function pe(){let e=P();function t(t,a){let n=t.target.files[o.zero].name,r=new FileReader;r.onload=function(){let t={};try{t=JSON.parse(r.result)}catch(e){console.log(e||"An error occurs when reading the file")}a?F().decompressMerge(t):(F().decompress(t),C.travel.name=n.substr(o.zero,n.lastIndexOf("."))),function(){if(e.dispatch("removeallobjects"),me().display(),ge.setLayer(C.travel.layerName),S.chainRoutes(),e.dispatch("setrouteslist"),o.invalidObjId===C.editedRouteObjId)e.dispatch("reducerouteui");else{let t=C.travel.editedRoute.itinerary.provider;if(t&&""!==t&&!C.providers.get(t.toLowerCase()))A.showError(w.getText("FileLoader - Not possible to select as provider",{provider:t}));else{let o=C.travel.editedRoute.itinerary.transitMode;e.dispatch("setprovider",{provider:t}),o&&""!==o&&e.dispatch("settransitmode",{transitMode:o})}S.chainRoutes(),e.dispatch("expandrouteui")}e.dispatch("setwaypointslist"),e.dispatch("setitinerary"),e.dispatch("roadbookupdate"),e.dispatch("travelnotesfileloaded",{name:C.travel.name})}()},r.readAsText(t.target.files[o.zero])}return Object.seal({openLocalFile:e=>t(e,!1),mergeLocalFile:e=>t(e,!0)})}const he=function(){let a=null,n=t(),r=null;function i(t){document.getElementById("TravelNotes-Control-TravelDataDiv")||(r=t,function(){let e=n.create("div",{id:"TravelNotes-Control-TravelHeaderDiv",className:"TravelNotes-Control-HeaderDiv"},r);n.create("span",{innerHTML:"&#x25bc;",id:"TravelNotes-ControlTravelExpandButton",className:"TravelNotes-Control-ExpandButton"},e).addEventListener("click",e=>{e.stopPropagation(),document.getElementById("TravelNotes-Control-TravelHeaderDiv").classList.toggle("TravelNotes-Control-SmallHeader"),document.getElementById("TravelNotes-Control-TravelDataDiv").classList.toggle("TravelNotes-Control-HiddenList"),document.getElementById("TravelNotes-ControlTravelButtonsDiv").classList.toggle("TravelNotes-Control-HiddenList");let t=document.getElementById("TravelNotes-Control-TravelDataDiv").classList.contains("TravelNotes-Control-HiddenList");document.getElementById("TravelNotes-ControlTravelExpandButton").innerHTML=t?"&#x25b6;":"&#x25bc;",document.getElementById("TravelNotes-ControlTravelExpandButton").title=t?w.getText("TravelUI - Show"):w.getText("TravelUI - Hide"),e.stopPropagation()},!1),n.create("span",{innerHTML:w.getText("TravelUI - Travel routes"),id:"TravelNotes-Control-TravelHeaderText",className:"TravelNotes-Control-HeaderText"},e)}(),function(){let e=n.create("div",{id:"TravelNotes-Control-TravelDataDiv",className:"TravelNotes-Control-DataDiv"},r);(a=ue({minSize:o.zero,id:"TravelNotes-Control-TravelRoutesList"},e)).container.addEventListener("SortableListDelete",e=>{e.stopPropagation(),V.removeRoute(e.itemNode.dataObjId)},!1),a.container.addEventListener("SortableListUpArrow",e=>{e.stopPropagation(),V.swapRoute(e.itemNode.dataObjId,!0)},!1),a.container.addEventListener("SortableListDownArrow",e=>{e.stopPropagation(),V.swapRoute(e.itemNode.dataObjId,!1)},!1),a.container.addEventListener("SortableListRightArrow",e=>{e.stopPropagation(),V.editRoute(e.itemNode.dataObjId)},!1),a.container.addEventListener("SortableListChange",e=>{e.stopPropagation(),V.renameRoute(e.dataObjId,e.changeValue)},!1),a.container.addEventListener("SortableListDrop",e=>{e.stopPropagation(),V.routeDropped(e.draggedObjId,e.targetObjId,e.draggedBefore)},!1)}(),function(){let t=n.create("div",{id:"TravelNotes-ControlTravelButtonsDiv",className:"TravelNotes-Control-ButtonsDiv"},r);n.create("div",{id:"TravelNotes-Control-ExpandRoutesListButton",className:"TravelNotes-Control-Button",title:w.getText("TravelUI - Expand the list"),innerHTML:"&#x25bd;"},t).addEventListener("click",e=>{e.stopPropagation(),document.getElementById("TravelNotes-Control-TravelDataDiv").classList.toggle("TravelNotes-Control-ExpandedList");let t=document.getElementById("TravelNotes-Control-TravelDataDiv").classList.contains("TravelNotes-Control-ExpandedList");document.getElementById("TravelNotes-Control-ExpandRoutesListButton").innerHTML=t?"&#x25b3;":"&#x25bd;",document.getElementById("TravelNotes-Control-ExpandRoutesListButton").title=t?w.getText("TravelUI - Reduce the list"):w.getText("TravelUI - Expand the list")},!1),n.create("div",{id:"TravelNotes-Control-CancelTravelButton",className:"TravelNotes-Control-Button",title:w.getText("TravelUI - Cancel travel"),innerHTML:"&#x274c"},t).addEventListener("click",e=>{e.stopPropagation(),V.clear()},!1),n.create("div",{id:"TravelNotes-Control-SaveTravelButton",className:"TravelNotes-Control-Button",title:w.getText("TravelUI - Save travel"),innerHTML:"&#x1f4be;"},t).addEventListener("click",e=>{e.stopPropagation(),V.saveTravel()},!1);let a=n.create("div",{id:"TravelNotes-Control-OpenTravelDiv"},t);n.create("input",{id:"TravelNotes-Control-OpenTravelInput",type:"file",accept:".trv"},a).addEventListener("change",e=>{e.stopPropagation(),pe().openLocalFile(e)},!1);let i=n.create("div",{id:"TravelNotes-Control-OpenTravelFakeDiv"},a);n.create("div",{id:"TravelNotes-Control-OpenTravelButton",className:"TravelNotes-Control-Button",title:w.getText("TravelUI - Open travel"),innerHTML:"&#x1F4C2;"},i).addEventListener("click",()=>{window.confirm(w.getText("TravelEditor - This page ask to close; data are perhaps not saved."))&&document.getElementById("TravelNotes-Control-OpenTravelInput").click()},!1);let l=n.create("div",{id:"TravelNotes-Control-ImportTravelDiv"},t);n.create("input",{id:"TravelNotes-Control-ImportTravelInput",type:"file",accept:".trv,.map"},l).addEventListener("change",e=>{e.stopPropagation(),pe().mergeLocalFile(e)},!1);let s=n.create("div",{id:"TravelNotes-Control-ImportTravelFakeDiv"},l);n.create("div",{id:"TravelNotes-Control-ImportTravelButton",className:"TravelNotes-Control-Button",title:w.getText("TravelUI - Import travel"),innerHTML:"&#x1F30F;"},s).addEventListener("click",()=>{o.invalidObjId===C.editedRouteObjId?document.getElementById("TravelNotes-Control-ImportTravelInput").click():A.showError(w.getText("TravelUI - Not possible to merge a travel when a route is edited"))},!1),n.create("div",{id:"TravelNotes-Control-OpenTravelRoadbookButton",className:"TravelNotes-Control-Button",title:w.getText("TravelUI - Open travel roadbook"),innerHTML:'<a class="TravelNotes-Control-LinkButton" href="TravelNotesRoadbook.html?lng='+e.language+"&page="+C.UUID+'" target="_blank">&#x1F4CB;</a>'},t),n.create("div",{id:"TravelNotes-Control-AddRoutesButton",className:"TravelNotes-Control-Button",title:w.getText("TravelUI - New route"),innerHTML:"+"},t).addEventListener("click",e=>{e.stopPropagation(),V.addRoute()},!1)}())}return Object.seal({createUI:e=>i(e),setRoutesList:()=>(function(){a.removeAllItems();let e=C.travel.routes.iterator;for(;!e.done;)a.addItem({value:e.value.name,label:e.value.chain?"&#x26d3;":"",placeholder:w.getText("TravelUI - Route"),objId:e.value.objId,isLast:!1})})()})}();let be=null;const fe=function(){let e=null,a=t();function n(t){document.getElementById("TravelNotes-Control-RouteDataDiv")||(e=t,function(){let t=a.create("div",{id:"TravelNotes-Control-RouteHeaderDiv",className:"TravelNotes-Control-HeaderDiv"},e);a.create("span",{innerHTML:"&#x25bc;",id:"TravelNotes-Control-RouteExpandButton",className:"TravelNotes-Control-ExpandButton"},t).addEventListener("click",e=>{if(e.stopPropagation(),o.invalidObjId===C.editedRouteObjId)return;document.getElementById("TravelNotes-Control-RouteHeaderDiv").classList.toggle("TravelNotes-Control-SmallHeader"),document.getElementById("TravelNotes-Control-RouteDataDiv").classList.toggle("TravelNotes-Control-HiddenList"),document.getElementById("TravelNotes-Control-RouteButtonsDiv").classList.toggle("TravelNotes-Control-HiddenList");let t=document.getElementById("TravelNotes-Control-RouteDataDiv").classList.contains("TravelNotes-Control-HiddenList");document.getElementById("TravelNotes-Control-RouteExpandButton").innerHTML=t?"&#x25b6;":"&#x25bc;",document.getElementById("TravelNotes-Control-RouteExpandButton").title=t?w.getText("RouteUI - Show"):w.getText("RouteUI - Hide")},!1),a.create("span",{innerHTML:w.getText("RouteUI - Waypoints"),id:"TravelNotes-Control-RouteHeaderText",className:"TravelNotes-Control-HeaderText"},t)}(),function(){let t=a.create("div",{id:"TravelNotes-Control-RouteDataDiv",className:"TravelNotes-Control-DataDiv"},e);(be=ue({minSize:o.zero,listStyle:"LimitedSort",id:"TravelNotes-Control-RouteWaypointsList"},t)).container.addEventListener("SortableListDelete",e=>{e.stopPropagation(),K.removeWayPoint(e.itemNode.dataObjId)},!1),be.container.addEventListener("SortableListUpArrow",e=>{e.stopPropagation(),K.swapWayPoints(e.itemNode.dataObjId,!0)},!1),be.container.addEventListener("SortableListDownArrow",e=>{e.stopPropagation(),K.swapWayPoints(e.itemNode.dataObjId,!1)},!1),be.container.addEventListener("SortableListChange",e=>{e.stopPropagation(),K.renameWayPoint(e.dataObjId,e.changeValue)},!1),be.container.addEventListener("SortableListDrop",e=>{e.stopPropagation(),K.wayPointDropped(e.draggedObjId,e.targetObjId,e.draggedBefore)},!1)}(),function(){let t=a.create("div",{id:"TravelNotes-Control-RouteButtonsDiv",className:"TravelNotes-Control-ButtonsDiv"},e);a.create("div",{id:"TravelNotes-Control-ExpandWayPointsListButton",className:"TravelNotes-Control-Button",title:w.getText("RouteUI - Expand the list"),innerHTML:"&#x25bd;"},t).addEventListener("click",e=>{e.stopPropagation(),document.getElementById("TravelNotes-Control-RouteDataDiv").classList.toggle("TravelNotes-Control-ExpandedList");let t=document.getElementById("TravelNotes-Control-RouteDataDiv").classList.contains("TravelNotes-Control-ExpandedList");document.getElementById("TravelNotes-Control-ExpandWayPointsListButton").innerHTML=t?"&#x25b3;":"&#x25bd;",document.getElementById("TravelNotes-Control-ExpandWayPointsListButton").title=t?w.getText("RouteUI - Reduce the list"):w.getText("RouteUI - Expand the list")},!1),a.create("div",{id:"TravelNotes-Control-CancelRouteButton",className:"TravelNotes-Control-Button",title:w.getText("RouteUI - Cancel"),innerHTML:"&#x274c"},t).addEventListener("click",e=>{e.stopPropagation(),S.cancelEdition()},!1),a.create("div",{id:"TravelNotes-Control-SaveRouteButton",className:"TravelNotes-Control-Button",title:w.getText("RouteUI - Save"),innerHTML:"&#x1f4be;"},t).addEventListener("click",e=>{e.stopPropagation(),S.saveEdition()},!1),a.create("div",{id:"TravelNotes-Control-gpxButton",className:"TravelNotes-Control-Button",title:w.getText("RouteUI - Save the route in a gpx file"),innerHTML:"gpx"},t).addEventListener("click",e=>{e.stopPropagation(),S.saveGpx()},!1),a.create("div",{id:"TravelNotes-Control-ReverseWayPointsButton",className:"TravelNotes-Control-Button",title:w.getText("RouteUI - Invert waypoints"),innerHTML:"&#x21C5;"},t).addEventListener("click",e=>{e.stopPropagation(),K.reverseWayPoints()},!1),a.create("div",{id:"TravelNotes-Control-RemoveAllWayPointsButton",className:"TravelNotes-Control-Button",title:w.getText("RouteUI - Delete all waypoints"),innerHTML:"&#x267b;"},t).addEventListener("click",e=>{e.stopPropagation(),K.removeAllWayPoints()},!1)}())}return Object.seal({createUI:e=>n(e),expandUI:()=>(document.getElementById("TravelNotes-Control-RouteExpandButton").innerHTML="&#x25bc;",document.getElementById("TravelNotes-Control-RouteExpandButton").title="Masquer",document.getElementById("TravelNotes-Control-RouteDataDiv").classList.remove("TravelNotes-Control-HiddenList"),void document.getElementById("TravelNotes-Control-RouteButtonsDiv").classList.remove("TravelNotes-Control-HiddenList")),reduceUI:()=>(document.getElementById("TravelNotes-Control-RouteExpandButton").innerHTML="&#x25b6;",document.getElementById("TravelNotes-Control-RouteExpandButton").title="Afficher",document.getElementById("TravelNotes-Control-RouteDataDiv").classList.add("TravelNotes-Control-HiddenList"),void document.getElementById("TravelNotes-Control-RouteButtonsDiv").classList.add("TravelNotes-Control-HiddenList")),setWayPointsList:()=>(function(){if(be.removeAllItems(),o.invalidObjId===C.editedRouteObjId)return;let e=C.travel.editedRoute.wayPoints.iterator;for(;!e.done;){let t=e.first?"A":e.last?" B":e.index,o=e.first?w.getText("RouteUI - Start"):e.last?w.getText("RouteUI - End"):w.getText("RouteUI - Via");be.addItem({value:""===e.value.name?E().formatLatLng(e.value.latLng):e.value.name,label:t,placeholder:o,objId:e.value.objId,isLast:e.last})}})()})}();function Te(){let e=o.zero,t=P();function a(t){t.stopPropagation();try{t.dataTransfer.setData("Text",t.target.dataObjId),t.dataTransfer.dropEffect="move"}catch(e){console.log(e)}e=t.target.noteObjId-o.number1}function n(e){e.preventDefault()}function r(t){t.preventDefault();let a=t.target;for(;!a.noteObjId;)a=a.parentElement;let n=a.getBoundingClientRect();oe.noteDropped(e+o.number1,a.noteObjId,t.clientY-n.top<n.bottom-t.clientY)}function i(e){e.stopPropagation(),e.preventDefault();let o=e.target;for(;!o.noteObjId;)o=o.parentNode;t.dispatch("zoomto",{latLng:x().getNoteAndRoute(o.noteObjId).note.iconLatLng})}function l(e){e.stopPropagation(),e.preventDefault();let t=e.target;for(;!t.noteObjId;)t=t.parentNode;oe.editNote(t.noteObjId)}return Object.seal({remove:()=>(function(){let e=document.getElementById("TravelNotes-Control-DataPanesDiv");if(!e)return;let t=e.firstChild;t&&(t.childNodes.forEach(e=>{e.removeEventListener("click",i,!1),e.removeEventListener("contextmenu",l,!1),e.removeEventListener("dragstart",a,!1)}),e.removeChild(t))})(),add:()=>(function(){document.getElementById("TravelNotes-Control-ItineraryPaneButton").classList.remove("TravelNotes-Control-ActivePaneButton"),document.getElementById("TravelNotes-Control-TravelNotesPaneButton").classList.add("TravelNotes-Control-ActivePaneButton"),window.osmSearch&&document.getElementById("TravelNotes-Control-SearchPaneButton").classList.remove("TravelNotes-Control-ActivePaneButton");let e=M("TravelNotes-Control-"),t=document.getElementById("TravelNotes-Control-DataPanesDiv");if(!t)return;let o=e.travelNotesHTML;o.addEventListener("drop",r,!1),o.addEventListener("dragover",n,!1),t.appendChild(o),o.childNodes.forEach(e=>{e.addEventListener("click",i,!1),e.addEventListener("contextmenu",l,!1),e.draggable=!0,e.addEventListener("dragstart",a,!1),e.classList.add("TravelNotes-SortableList-MoveCursor")})})()})}let ye=!1,Ne={searchPhrase:"",bbox:null},Le=o.invalidObjId,Ie=o.invalidObjId,we=window.osmSearch?window.osmSearch.searchLimits:null;function Ee(){Ne.bbox&&(o.invalidObjId===Le?Le=r():P().dispatch("removeobject",{objId:Le}),P().dispatch("addrectangle",{objId:Le,bounds:[[Ne.bbox.southWest.lat,Ne.bbox.southWest.lng],[Ne.bbox.northEast.lat,Ne.bbox.northEast.lng]],properties:e.previousSearchLimit}))}function Ce(e){C.searchData=e,ye=!1,Ee(),P().dispatch("updatesearch")}function Ae(e){console.log(e||"An error occurs in the search"),ye=!1}function xe(){let t=C.map.getCenter();o.invalidObjId===Ie?Ie=r():P().dispatch("removeobject",{objId:Ie}),P().dispatch("addrectangle",{objId:Ie,bounds:[[t.lat-we.lat,t.lng-we.lng],[t.lat+we.lat,t.lng+we.lng]],properties:e.nextSearchLimit})}function je(){let e=P();return Object.seal({search:()=>(function(){if(ye)return;ye=!0;let e=C.map.getBounds();Ne={bbox:{southWest:{lat:e.getSouthWest().lat,lng:e.getSouthWest().lng},northEast:{lat:e.getNorthEast().lat,lng:e.getNorthEast().lng}},searchPhrase:document.getElementById("TravelNotes-Control-SearchInput").value},C.searchData=[],window.osmSearch.getSearchPromise(Ne).then(Ce,Ae)})(),show:()=>(C.map.on("zoom",xe),C.map.on("move",xe),xe(),void Ee()),hide:()=>(C.map.off("zoom",xe),C.map.off("move",xe),o.invalidObjId!==Ie&&(e.dispatch("removeobject",{objId:Ie}),Ie=o.invalidObjId),void(o.invalidObjId!==Le&&(e.dispatch("removeobject",{objId:Le}),Le=o.invalidObjId)))})}function De(){let e=je(),a="",n=t(),i=P();function l(e){e.stopPropagation();let t=e.target;for(;!t.latLng;)t=t.parentNode;i.dispatch("zoomto",{latLng:t.latLng,geometry:t.geometry})}function s(e){e.stopPropagation(),e.preventDefault();let t=e.target;for(;!t.latLng;)t=t.parentNode;oe.newSearchNote(t.searchResult)}function d(e){e.stopPropagation(),i.dispatch("addsearchpointmarker",{objId:e.target.objId,latLng:e.target.latLng,geometry:e.target.geometry})}function c(e){e.stopPropagation(),i.dispatch("removeobject",{objId:e.target.objId})}function u(){a=document.getElementById("TravelNotes-Control-SearchInput").value;let n=document.getElementById("TravelNotes-Control-SearchDiv"),r=document.getElementsByClassName("TravelNotes-Control-SearchResult");for(;o.zero!==r.length;)r[o.zero].removeEventListener("click",l,!1),r[o.zero].removeEventListener("contextmenu",s,!1),r[o.zero].removeEventListener("mouseenter",d,!1),r[o.zero].removeEventListener("mouseleave",c,!1),n.removeChild(r[o.zero]);if(!document.getElementById("TravelNotes-Control-SearchWaitBullet")){let e=t();e.create("div",{id:"TravelNotes-Control-SearchWaitBullet"},e.create("div",{id:"TravelNotes-Control-SearchWait"},n))}e.search()}return Object.seal({remove:()=>(function(){let t=document.getElementById("TravelNotes-Control-DataPanesDiv");if(!t)return;e.hide();let o=document.getElementById("TravelNotes-Control-SearchButton");o&&o.removeEventListener("click",u,!1);let a=document.getElementById("TravelNotes-Control-SearchInput");a&&a.removeEventListener("change",u,!1);let n=document.getElementById("TravelNotes-Control-SearchDiv"),r=document.getElementsByClassName("TravelNotes-Control-SearchResult");Array.prototype.forEach.call(r,e=>{e.removeEventListener("click",l,!1),e.removeEventListener("contextmenu",s,!1),e.removeEventListener("mouseenter",d,!1),e.removeEventListener("mouseleave",c,!1)}),n&&t.removeChild(n)})(),add:()=>(function(){document.getElementById("TravelNotes-Control-ItineraryPaneButton").classList.remove("TravelNotes-Control-ActivePaneButton"),document.getElementById("TravelNotes-Control-TravelNotesPaneButton").classList.remove("TravelNotes-Control-ActivePaneButton"),document.getElementById("TravelNotes-Control-SearchPaneButton").classList.add("TravelNotes-Control-ActivePaneButton");let t=document.getElementById("TravelNotes-Control-DataPanesDiv");if(!t)return;e.show();let i=n.create("div",{id:"TravelNotes-Control-SearchDiv"},t);n.create("div",{id:"TravelNotes-Control-SearchButton",className:"TravelNotes-Control-Button",title:w.getText("SearchPaneUI - Search OpenStreetMap"),innerHTML:"&#x1f50e"},i).addEventListener("click",u,!1);let v=n.create("input",{type:"text",id:"TravelNotes-Control-SearchInput",placeholder:w.getText("SearchPaneUI - Search phrase"),value:a},i);v.addEventListener("change",u,!1),v.addEventListener("keydown",e=>{"Enter"===e.key&&u()},!1),v.focus();let g=o.zero;C.searchData.forEach(e=>{let t=n.create("div",{id:"TravelNotes-Control-SearchResult"+g++,className:"TravelNotes-Control-SearchResult",innerHTML:(""===e.description?"":'<p class="TravelNotes-Control-SearchResultDescription">'+e.description+"</p>")+(e.tags.name?"<p>"+e.tags.name+"</p>":"")+(e.tags["addr:street"]?"<p>"+e.tags["addr:street"]+" "+(e.tags["addr:housenumber"]?e.tags["addr:housenumber"]:"")+"</p>":"")+(e.tags["addr:city"]?"<p>"+(e.tags["addr:postcode"]?e.tags["addr:postcode"]+" ":"")+e.tags["addr:city"]+"</p>":"")+(e.tags.phone?"<p>"+e.tags.phone+"</p>":"")+(e.tags.email?'<p><a href="mailto:'+e.tags.email+'">'+e.tags.email+"</a></p>":"")+(e.tags.website?'<p><a href="'+e.tags.website+'" target="_blank">'+e.tags.website+"</a></p>":"")+(e.ranking?"<p>&#x26ab;"+e.ranking+"</p>":"")},i);t.searchResult=e,t.objId=r(),t.osmId=e.id,t.latLng=[e.lat,e.lon],t.geometry=e.geometry,t.addEventListener("click",l,!1),t.addEventListener("contextmenu",s,!1),t.addEventListener("mouseenter",d,!1),t.addEventListener("mouseleave",c,!1)})})()})}function Pe(){let e=P();function t(t){t.stopPropagation();let o=t.target;for(;!o.latLng;)o=o.parentNode;e.dispatch("zoomto",{latLng:o.latLng})}function a(e){e.stopPropagation(),e.preventDefault();let t=e.target;for(;!t.latLng;)t=t.parentNode;t.maneuverObjId?oe.newManeuverNote(t.maneuverObjId,t.latLng):t.noteObjId&&oe.editNote(t.noteObjId)}function n(t){t.stopPropagation(),e.dispatch("additinerarypointmarker",{objId:t.target.objId,latLng:t.target.latLng})}function r(t){t.stopPropagation(),e.dispatch("removeobject",{objId:t.target.objId})}return Object.seal({remove:()=>(function(){let e=document.getElementById("TravelNotes-Control-DataPanesDiv");if(!e)return;let i=document.getElementsByClassName("TravelNotes-Control-Route-Header")[o.zero];i&&e.removeChild(i);let l=document.getElementsByClassName("TravelNotes-Control-Route-ManeuversAndNotes")[o.zero];if(l){let i=l.childNodes;for(let e=o.zero;e<i.length;e++){let o=i[e];o.removeEventListener("click",t,!1),o.removeEventListener("contextmenu",a,!1),o.removeEventListener("mouseenter",n,!1),o.removeEventListener("mouseleave",r,!1)}e.removeChild(l)}})(),add:()=>(function(){document.getElementById("TravelNotes-Control-ItineraryPaneButton").classList.add("TravelNotes-Control-ActivePaneButton"),document.getElementById("TravelNotes-Control-TravelNotesPaneButton").classList.remove("TravelNotes-Control-ActivePaneButton"),window.osmSearch&&document.getElementById("TravelNotes-Control-SearchPaneButton").classList.remove("TravelNotes-Control-ActivePaneButton");let e=M("TravelNotes-Control-"),i=document.getElementById("TravelNotes-Control-DataPanesDiv");if(!i)return;i.appendChild(e.routeHeaderHTML),i.appendChild(e.routeManeuversAndNotesHTML);let l=document.getElementsByClassName("TravelNotes-Control-Route-ManeuversAndNotes")[o.zero];if(l){let e=l.childNodes;for(let i=o.zero;i<e.length;i++){let o=e[i];o.addEventListener("click",t,!1),o.addEventListener("contextmenu",a,!1),o.addEventListener("mouseenter",n,!1),o.addEventListener("mouseleave",r,!1)}}})()})}const Me=function(){let e=o.dataPanesUI.invalidPane,a=Te(),n=De(),r=Pe();function i(){switch(e){case o.dataPanesUI.itineraryPane:r.remove();break;case o.dataPanesUI.travelNotesPane:a.remove();break;case o.dataPanesUI.searchPane:window.osmSearch&&n.remove()}}function l(){i(),r.add(),e=o.dataPanesUI.itineraryPane}function s(){i(),a.add(),e=o.dataPanesUI.travelNotesPane}function d(){i(),n.add(),e=o.dataPanesUI.searchPane}return Object.seal({createUI:e=>(function(e){if(document.getElementById("TravelNotes-Control-DataPanesDiv"))return;let a=t(),n=a.create("div",{id:"TravelNotes-Control-ItineraryHeaderDiv",className:"TravelNotes-Control-HeaderDiv"},e);a.create("div",{innerHTML:w.getText("DataPanesUI - Itinerary"),id:"TravelNotes-Control-ItineraryPaneButton",className:"TravelNotes-Control-PaneButton"},n).addEventListener("click",()=>l(),!1),a.create("div",{innerHTML:w.getText("DataPanesUI - Travel notes"),id:"TravelNotes-Control-TravelNotesPaneButton",className:"TravelNotes-Control-PaneButton"},n).addEventListener("click",()=>s(),!1),window.osmSearch&&a.create("div",{innerHTML:w.getText("DataPanesUI - Search"),id:"TravelNotes-Control-SearchPaneButton",className:"TravelNotes-Control-PaneButton"},n).addEventListener("click",()=>d(),!1),a.create("div",{id:"TravelNotes-Control-DataPanesDiv",className:"TravelNotes-Control-DataDiv"},e).addEventListener("wheel",e=>{e.deltaY&&(e.target.scrollTop+=e.deltaY*o.mouse.wheelCorrectionFactors[e.deltaMode]),e.stopPropagation()},!1)})(e),setItinerary:()=>l(),updateItinerary:()=>void(o.dataPanesUI.itineraryPane===e&&(r.remove(),r.add())),setTravelNotes:()=>s(),updateTravelNotes:()=>void(o.dataPanesUI.travelNotesPane===e&&(a.remove(),a.add())),setSearch:()=>d(),updateSearch:()=>void(o.dataPanesUI.searchPane===e&&(n.remove(),n.add()))})}();const Re=function(){let e=null,a=t(),n=!1,r=null,i=null,l=null,s=null,d=null,c=null,u=null;function v(e){C.routing.transitMode=e,document.getElementsByClassName("TravelNotes-Control-ActiveTransitModeImgButton")[o.zero].classList.remove("TravelNotes-Control-ActiveTransitModeImgButton"),document.getElementById("TravelNotes-Control-"+e+"ImgButton").classList.add("TravelNotes-Control-ActiveTransitModeImgButton")}function g(e){e.stopPropagation(),v(e.target.transitMode),S.startRouting()}function m(e){C.routing.provider=e,document.getElementsByClassName("TravelNotes-Control-ActiveProviderImgButton")[o.zero].classList.remove("TravelNotes-Control-ActiveProviderImgButton"),document.getElementById("TravelNotes-Control-"+e+"ImgButton").classList.add("TravelNotes-Control-ActiveProviderImgButton");let t=C.providers.get(e.toLowerCase());t.transitModes.car?document.getElementById("TravelNotes-Control-carImgButton").classList.remove("TravelNotes-Control-InactiveTransitModeImgButton"):document.getElementById("TravelNotes-Control-carImgButton").classList.add("TravelNotes-Control-InactiveTransitModeImgButton"),t.transitModes.bike?document.getElementById("TravelNotes-Control-bikeImgButton").classList.remove("TravelNotes-Control-InactiveTransitModeImgButton"):document.getElementById("TravelNotes-Control-bikeImgButton").classList.add("TravelNotes-Control-InactiveTransitModeImgButton"),t.transitModes.pedestrian?document.getElementById("TravelNotes-Control-pedestrianImgButton").classList.remove("TravelNotes-Control-InactiveTransitModeImgButton"):document.getElementById("TravelNotes-Control-pedestrianImgButton").classList.add("TravelNotes-Control-InactiveTransitModeImgButton"),t.transitModes.train?document.getElementById("TravelNotes-Control-trainImgButton").classList.remove("TravelNotes-Control-InactiveTransitModeImgButton"):document.getElementById("TravelNotes-Control-trainImgButton").classList.add("TravelNotes-Control-InactiveTransitModeImgButton"),t.transitModes.line?document.getElementById("TravelNotes-Control-lineImgButton").classList.remove("TravelNotes-Control-InactiveTransitModeImgButton"):document.getElementById("TravelNotes-Control-lineImgButton").classList.add("TravelNotes-Control-InactiveTransitModeImgButton"),t.transitModes.circle?document.getElementById("TravelNotes-Control-circleImgButton").classList.remove("TravelNotes-Control-InactiveTransitModeImgButton"):document.getElementById("TravelNotes-Control-circleImgButton").classList.add("TravelNotes-Control-InactiveTransitModeImgButton"),C.providers.get(e.toLowerCase()).transitModes[C.routing.transitMode]||(t.transitModes.bike?v("bike"):t.transitModes.pedestrian?v("pedestrian"):t.transitModes.car?v("car"):t.transitModes.train?v("train"):t.transitModes.line?v("line"):t.transitModes.circle&&v("circle"))}function p(t){if(o.zero===t.providerKey)return;let u=a.create("img",{src:t.icon,id:"TravelNotes-Control-"+t.name+"ImgButton",className:"TravelNotes-Control-ImgButton",title:t.name},e);u.provider=t.name,u.addEventListener("click",e=>{e.stopPropagation(),m(e.target.provider),S.startRouting()},!1),n||(u.classList.add("TravelNotes-Control-ActiveProviderImgButton"),C.routing.provider=u.provider,n=!0,t.transitModes.bike?(r.classList.add("TravelNotes-Control-ActiveTransitModeImgButton"),C.routing.transitMode="bike"):t.transitModes.pedestrian?(i.classList.add("TravelNotes-Control-ActiveTransitModeImgButton"),C.routing.transitMode="pedestrian"):t.transitModes.car?(l.classList.add("TravelNotes-Control-ActiveTransitModeImgButton"),C.routing.transitMode="car"):t.transitModes.train?(s.classList.add("TravelNotes-Control-ActiveTransitModeImgButton"),C.routing.transitMode="train"):t.transitModes.line?(d.classList.add("TravelNotes-Control-ActiveTransitModeImgButton"),C.routing.transitMode="line"):t.transitModes.circle&&(c.classList.add("TravelNotes-Control-ActiveTransitModeImgButton"),C.routing.transitMode="circle"),t.transitModes.car||l.classList.add("TravelNotes-Control-InactiveTransitModeImgButton"),t.transitModes.pedestrian||i.classList.add("TravelNotes-Control-InactiveTransitModeImgButton"),t.transitModes.bike||r.classList.add("TravelNotes-Control-InactiveTransitModeImgButton"),t.transitModes.train||s.classList.add("TravelNotes-Control-InactiveTransitModeImgButton"),t.transitModes.line||d.classList.add("TravelNotes-Control-InactiveTransitModeImgButton"),t.transitModes.circle||c.classList.add("TravelNotes-Control-InactiveTransitModeImgButton"))}function h(t){u=t,e=a.create("div",{id:"TravelNotes-Control-ItineraryButtonsDiv",className:"TravelNotes-Control-ButtonsDiv"},t),(r=a.create("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAIAAAC0Ujn1AAAABmJLR0QAAAAzAJlWvctWAAAACXBIWX\t\t\t\t\tMAAA7EAAAOxAGVKw4bAAAAB3RJTUUH5AEIChYTLGSDtAAAA65JREFUSMftVl1sk1UYfs53vnZft4/R/W+hHaUrbshcQch06VCGWd\t\t\t\t\tBohmNRCRiXKXphZCOacCEYBeOFXHhDlHDjQDEBdKIx9sL4Q8bqtEPqLAOE/YDrGPspa2m7bt/Xr8eLr3WddFuJ88b4Xp285z1P3v\t\t\t\t\tOe533eQ9xud3FxMcdxmMMURWGMUUoJIUjNFEUZHBwkPp8vovBnHVfB7gghACNIsgEQQgjAwBjiAfFIQqqrLBpNhKeU/to9Vr/fic\t\t\t\t\tWzbw6iqrKEQ/Ks/pkxAODwr9n/0HcHLWq5uoqlXMqMTjR+nj2bKWPlcrH9t4komyHRmgLt3pcq0gQNGOr2dSJZMyycteNaSJKjlk\t\t\t\t\tIh0dk9KjnO3QhORtrsV+YmXjzreW576qfxlrrlJUXCrUkWlBgDlmgJI+Tn7pvHfvTOeYzEodncTfP8xoIu93h7XzDR+Vx1vj8kVx\t\t\t\t\toEp2fqrlvGWihsseoFnggCv2JZRql+1pNMK+xL10T5yiyeI6/UFuzbalydq12YIbWW9CMt1u2bDeVm8VCzdZUl+1j7yEPr8wmBlh\t\t\t\t\tJTJg+AEgBI1+L4Gw9OSez8ldsv1JvfbbonKUNi1U6jZNuW0p3vuVRG1K8P6wUc2G4++OlAU03Rh98PV63OKvNNXR8K2oxCqTn747\t\t\t\t\taLgVCkfSBkv+Bvqs5985kV+08OzGTNEoi192lTm71XdTSs1RMl2trhzczUBWXm6vG2PGHcue2+xzeZHNfDWx81vX308tcX/BbTEp\t\t\t\t\tX0rR3jOdnpswqSKPAZomC/FABQadA1PlX+uWsCAM8xAK4Rqb7WvMlmebZhzQ5bXl6u+MC9WS9uzM/R6z7ac796fHJa+XtB/sKOSJ\t\t\t\t\tEqg9DpmXJ6wnWvd8RGRjS273TdqFxnvnh5+BPH2Nqy7N/7/F/5ZABArAiiQNUFpRwATlEUhmnVdeiz/saGWa/xWJkoyxF1vefo1Y\t\t\t\t\twNrR8c7wbQ+kX/q42rEiN3bS76Y+i2uo5GGQCeUhplkuryhJROp+fIbmuXa9h9LfTkw0WimNZ8uGeGrwxDo2EAPV75bOfg4eaK8b\t\t\t\t\tFAKCQtM+i9t8JvneiPQ0cBkEAgcO6XkZrXvksYe3j5kYK8HN2ZrtEz/ZPza1CNRczP0p4+PyEpM3Swv7Nug62UBwBCZ7USw/vfjq\t\t\t\t\tQobz/0BpNoHs8voHzzik9SsUtZVFNH+Y8NMMqRxQWllAdA/H6/RqPr7bvJGBYcgSz28wIhJK49SR7WUlIoy2HidruNRiOldBGzVr\t\t\t\t\t+TfwLXzWMKJ+iQhAAAAABJRU5ErkJggg==",id:"TravelNotes-Control-bikeImgButton",className:"TravelNotes-Control-ImgButton",title:w.getText("ProvidersToolbarUI - bike")},e)).transitMode="bike",r.addEventListener("click",g,!1),(i=a.create("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAIAAAC0Ujn1AAAABmJLR0QAAAAzAJlWvctWAAAACXBIWX\t\t\t\t\tMAAA7EAAAOxAGVKw4bAAAAB3RJTUUH5AEICholT2tZIQAAAyxJREFUSMetll1IFFEUx/93PtZ13cykJNvWNDXEMkgoyYKICCJISK\t\t\t\t\tkIIYjqpU98kB77loogjCzKCvoQkqigh8ioKKS01NS2grDwY7ddLa3dNVt37r1ze5haLXVzV8/TmTN3fufMYeacP3E4HCkpKZIkYX\t\t\t\t\twmhCCEhD/DOXc6ncTr9TKu1D5vgxj7LCEQYvglAYQQnOuSTAiMTAQGgpDlSzNUlSmyLLe0fl1/6BUmzx6exNIl6RLwV7kygUomzB\t\t\t\t\tYA8G+LuQD9kyoxRrqxf9HFvQtIVMmUMPeqDuevWZUNgDJ917n3kaLDfRhZmUmGE2dRo6g6HLr6bmtQY+5u78kr7ycZ3fCmlzGdUj\t\t\t\t\t01yTyZ6MOb0q6dLYyzmObYE29VFp3Ykjk56HXZU0p2rrDE/m6xJda0c1v+yjTLeIgyCYveujHb0+MfCLBQxOsPHi1dNh40F2HRVm\t\t\t\t\tvMz4AW1IbQZyrrF8637S+wT7QhVovKGedMD0U8Xwau3mzYsyM/XpUmhDaZVKHrus5DEVUmu8+/8/T4LpbmGpFjxelvb6zLSjRFhl\t\t\t\t\tZUhTGu86GqzSYJwL6Dz3Lm21ZnWgEkxMfYbdP8QT0ydMWluoorjRrlnAtKdQCKTAC8cAXKymsvn1p752Desry0/h+D+ZnWyNCVtX\t\t\t\t\t3XG7yDQdbU3F52+nEIDaDq1bfj5c/efei1z060JSdUnS86snluxH+jRjkIqMYAmIZNkXNPejpc/dOmxgLo6PpeVLDQqkiRoRnjBM\t\t\t\t\tTbTwEoyl+Dtbgw25i0U+PNJQce5SSbx0SPOpB1ziVJcvdp/xyYZVEW56YaftJ0K+Woc/4cEz3qXqSUg8DVpwEAGXq/HJv53v0Wd7\t\t\t\t\tfvZVNXp/PbjAQ14l4HBhkAt4/+2bS/rabtR/GJlt6+gYZmV3tnb3XT92jQhBBPvyYEMGKJCcBsVijTo1lg92rarHGqLkRQ46NpD/\t\t\t\t\tHZ4/d0+6NBX3jaYzhOt3f4FDSs8XXXg+fuetdgNOiQzdtwe2Rwe7nj/+NJlqJXHqM+KcsKAOLz+VQ19uOnbiEwht4gMGSZGJJp4S\t\t\t\t\t0jfSalAeJwOOx2uyzLYfTjCAU4Ljn5C1w5SWBHSm1MAAAAAElFTkSuQmCC",id:"TravelNotes-Control-pedestrianImgButton",className:"TravelNotes-Control-ImgButton",title:w.getText("ProvidersToolbarUI - pedestrian")},e)).transitMode="pedestrian",i.addEventListener("click",g,!1),(l=a.create("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAIAAAC0Ujn1AAAABmJLR0QAAAAzAJlWvctWAAAACXBIWX\t\t\t\t\tMAAA7EAAAOxAGVKw4bAAAAB3RJTUUH5AEICh4hLGpYPAAAAlZJREFUSMfdlk1oE0EUx/+zszEx3UhD0zZYkn5ksfWjlVgrVk1RQV\t\t\t\t\tR6EMFaK9qjggdBRO1NvSiIB8/iyQ/akxepSKteRPxoETXamkQtJAbbBN0ky0boZne8FIu23exqKuhjDgMz78ef/3u8GRIOh/1+P8\t\t\t\t\tdxKF1ompZIJEgmkylo/KPHMTBL6QQzCXM2hGxpF222Ak8pffkqvff88xKqHrqE9g0BDrAo10wwAOCwaPFvovmFDo6Gak4f3+x0gj\t\t\t\t\tHoOjQNTIfOoOvQ9dn93aF3p268tobu3R9sqC+XJACgdGbxPCgFIbPXHPYWa+gKWtbS7M3nIe669VVTfjm1aRUC53AtwYObHXW1rr\t\t\t\t\tZK90haMuv1mZ4VgsBFYlNzuQBU+kUiybiajMYmeR69e0QLZdwW8gMYGU0ZF+rp6GcArcHlZg3Z5K1avaqKMUwkpGNbawzQ2VxB09\t\t\t\t\tDU6Gl0lUVkpQj6xA7xwtntdjsjBBfPdZhpMnc5fXL7wO5DA8+mFCND1gddDgcA8nFCVtUi0OlpRKKyrsPtphuby015PTYuB7r67w\t\t\t\t\t3HjdH3H8abDva/eStZKGOt33n9ZNu6tZXG6NagZ6AvVF+3zEJfCwI93BMs6nJ1tbN730rTM+R3JyxjxVQfuRztu5IaG+4UBORyWL\t\t\t\t\tNz0AD34k6nx4NCAYHQ4Cc1XQStMEVRlR8SEmrSjOT4fNf++lBNpfR8npNlzThZlmG3Y6H2nx8tdl8zo6uh6+p/94AtMppypLRQSn\t\t\t\t\tkAJJvN2mxL33+YZOynR+9PQgx4VfUbCYfDPp+PUlry7+R3HyvZuSYHFFYAAAAASUVORK5CYII=",id:"TravelNotes-Control-carImgButton",className:"TravelNotes-Control-ImgButton",title:w.getText("ProvidersToolbarUI - car")},e)).transitMode="car",l.addEventListener("click",g,!1),(s=a.create("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAIAAAC0Ujn1AAAABmJLR0QAAAAzAJlWvctWAAAACXBIWX\t\t\t\t\tMAAA7EAAAOxAGVKw4bAAAAB3RJTUUH5AEICiI23EqkBAAABQpJREFUSMetVm1QVFUYfs+55+4u+zEsshK0iuy6iuAHbaSwJhkZNp\t\t\t\t\tWjaWn2oQ2Zk1lmpjMllmNqDYZjM+Y0TdkIg8WYHwU6KjqUIzl8KGhihcgCu8Auu3uBXXfZT+89/cBAYFex8f1173nOfea973ne5z\t\t\t\t\t2oqrouNUWHMYb7CUqBAkWAEAqD8jxvMplRd08vpWzlhRtA74scwe0PRjwgNMegIyRERCypq3cs/qwWHlyc+RIyZ2oxAASCXniwQQ\t\t\t\t\tEAMAB4ff6wG6Yr4YMcVaoi+D/IEUIEAFhCwsL5G6elTEnc8A6RSgnP05vuQOP1juXbrnjpqM4cA4BIxIbFnv/0mnbpyQlLyo6VXU\t\t\t\t\tEIHfn1kiYpLjlmtIkTACAMGwleZZAumK8bo5SFQoGxseyhXxqezkyYYnFVXPPYb5F7UyMU/gfzX43f+P5z5L9yvZWrHoACgUDlhb\t\t\t\t\t9e23LRHkJ3o4Zw6LIZUevW5HCcc++354/+Zp6YIDPoVZN1YxPiY5TRoujo6NSUpIL3uNw9RgExkalHhAwLX3ySTQizeUd5YU0fgL\t\t\t\t\tTJSE8ZHQCOYTvTov1/3pRFpKZ0eCMeLzBoNeofiioKa/p2r4yfnjpeLGb9gWCfx2/nvOZOd7vFIxETsZg0Gb2Tgu4bfkWErKlwxz\t\t\t\t\tt/umD2E3OmHSg+t3Zfc+m2tIULDHc/LquVe2TJ0ZFFx/367n/JfAguFz2TMVOXv+dETb2t6cjCe/ICQEKC6utNqeF1jQADwJsGeW\t\t\t\t\tnh0lDo1surD6VNjdtX8GJS0sOjlPCz8/UaqRAx68na2IMl52+6AysWa2ama1mWHX1bKxTyzbmTwioEAYBCRlSxyrlZ08tOVAGAz+\t\t\t\t\tezO1wWa4+5vcfY2t3U6q66xjl9vEpGdGq5LmmMNIpixDMYE4IZBndYXBHF12J2tpgFrudsZY3l8311tZxoRHJSALB74O/rPFwfrk\t\t\t\t\tI5+BlgeRjUOBlQXnl1t8kVctNeAAAQ3a/VeUCiZjydvHyQemAEbV2rX7QgzcE5u2xOk7nncoOl+LTN5B/SafvXaV56YZYgCEU/VW\t\t\t\t\t840N6/uH6efOVyvcXqXLOjFvjhBaEA8H1Jg9frmZ2p06fp0vV4ySLY+lGoo8PeZHRUXzR9d9xiCTJFx0xPZiXHKOUK2aDt3DD7lU\t\t\t\t\tolBUSGDkrkdrsv1TuyPzw7sDRvAlm1LPFR/WTdRDXDMAN+1GnhzO2cg+tze0L9Zi+RiAiDCRNSKhVJibElR+q2HOoCgDO7MgwZE8\t\t\t\t\tN4SIXplre4dT3GbSabIPCPpSePVcWIxWKtRq3VqCPVus1k3f6z5baaB3U9wvqquujyXc2m9t6sOTNaWjr3Hyj/p7E1GIw4ybju3m\t\t\t\t\t27KgJDp8/d7Pztb9r+qLXtyMuZmqotOXzhqdxTr2SrtBOUcSoFYXiEkVgkkkhoe4fr3b3GPgGPylQHoviS7+Sy0oPb01e9Me/xTN\t\t\t\t\t3HO899dcbZD2XEwabVU+dm6bPnRs3OnFJxrjG/sPlORTF5eXkWq7eo3BiJ3SegHyusgt0cJcGJCezvF7kgMADQ2QeHKx2nTzTIWb\t\t\t\t\tfb7ZPLRbNSotoabbYAWZEzbvy4MQQAGIzu2RE7Szko5QAAYIi31HP09d1NdyxIAIBhCAAgl8vFslHNxi5KASGgdPhkGHmto/T2Fk\t\t\t\t\toppVSgFCggBBhjQMBgPEkXHwr50NWrDYmJ4zFmYMilDwECBEBppBsM9KcSNniebzOZ/gWOPRAUHy2iQwAAAABJRU5ErkJggg==",id:"TravelNotes-Control-trainImgButton",className:"TravelNotes-Control-ImgButton",title:w.getText("ProvidersToolbarUI - train")},e)).transitMode="train",s.addEventListener("click",g,!1),(d=a.create("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAIAAAC0Ujn1AAAABmJLR0QAAAAzAJlWvctWAAAACXBIWX\t\t\t\t\tMAAA7EAAAOxAGVKw4bAAAAB3RJTUUH5AEICiINbUFNIAAAAfZJREFUSMdjvHz5spycHBMTEwP1wN+/fx8/fsz44cOHP39ZDh+9zf\t\t\t\t\tCfJO2MDFANGAxGRhtLFVbWPyzMzMwXLr4ObDxFRVfv6mKwNFNmYmAg0bnEgP8MDAwMZAZxoqXgomJd/GrIMdpCkq270SMi1Iz6Rs\t\t\t\t\t9sdxIW4l2x+hSVjV5UrKunI3fpyqO43svUNDrfVSwi1Oztu8/plfsIKmYiKYhrS50ZGBiau/eeeP6LmkbDg3ji7lfEqGeiehCTZj\t\t\t\t\tRJQYzTaMb/bBQGMU6j/zOia57f60ZSEBMbIBsbTTXUpI6dvE18EMMBCx65mgBpT3e9Fy8/FLccxZUcE4OUv//4XTD3DglGW0iyle\t\t\t\t\tY7MTAwVLXsRgtiiIl21srKSuKsLMyPn7wlzej5vW58vJyz5h+ef/w9VhN///l7997LQ0fvzl93l4QAgQdx+tTrAVrcUQFqxoZysr\t\t\t\t\tIiaCbiTzAsuIL40+fvb958ubvaX0lRnIGB4fv3X9dvPD1x+iFBE3EaDQliVhZmVl5OP2/D799/nTl3/+jJ+1hDkzSjixK1+Xg5v3\t\t\t\t\t//dfX6U/JMxGl03/yrl669atnwlPIKEt3oE89/naCGueRXu4PAaGYmRuoayszMwsDAwPjx40dWVs47d1/8/8/ASCUrVJQlfv/+zn\t\t\t\t\tj58mVZWVlmZmaqNycB+D3rTYmxQpEAAAAASUVORK5CYII=",id:"TravelNotes-Control-lineImgButton",className:"TravelNotes-Control-ImgButton",title:w.getText("ProvidersToolbarUI - line")},e)).transitMode="line",d.addEventListener("click",g,!1),(c=a.create("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAIAAAC0Ujn1AAAABmJLR0QAAAAzAJlWvctWAAAACXBIWX\t\t\t\t\tMAAA7EAAAOxAGVKw4bAAAAB3RJTUUH5AEICiEaxb+bJAAAAqNJREFUSMdjvHz5spycHBMTEwP1wN+/fx8/fsz44cOHP39ZDh+9zf\t\t\t\t\tCfJO2MDFANGAxGRhtLFVbWPyzMzMwXLr4ObDxFRVfv6mKwNFNmYmAg0bnEgP8MDAwMTAw0Ayz4pS0k2RKDlO2slUVFeIWFeBkYGN\t\t\t\t\t6++/z6zedDR+/OX3f3xPNfZBo9M1szIsTk48dvBw7fOnvp5cTdrxgYGPJdxYz1xD1dtWIjzBevOJk+9TrJRu/vszUyVJg6+1DVso\t\t\t\t\tfI4hN3v2LY/Yqh93JNgHRpvpOOloR19n6sJjDhMldZSSw+ex2aucigZcNT96iVstJCR6c6Emv0zGxNI0OFvKodG659xR8TJ57/Cs\t\t\t\t\tvcrKMlMzNbk7DRFpJssRHm3RP3ETQXbnr3xH2xEeYWkmwEjE4MUn7z9nPLhqfEJ7KWDU/fvP2cFaVOwGg7a+UDh2+RmoS3775mai\t\t\t\t\txPwGhREd6zl16SavSJcy+kJAUJGC0sxAtJvySB+cff8/FyEpX4qALQjf70+Xu+qxippiRaCn76/J2A0c+evzfWEyfVaAsjiWfP3x\t\t\t\t\tMw+vTZhw62aqQabWetfPrsQwJGT1t2U0SYty1KnnhzawKk5WVFpi27ScDoE89/LV5xMjvVDjN34Sp1S/OdFq84iVnAYkkh6VOvX7\t\t\t\t\tn2ZNV0X4KmW0iyrZrue+XaE6xFK/bEZ529//HTdzuXhdcESOMJh53Lwh8/fYerUMVZXltn75+ZrVlV7JoY/X7PgVsnzr2Yf/w9JJ\t\t\t\t\t1ZGEm4OKhJSgiSWRVAQmb+urtZUep21soRISbzeDkhCf/Z8/dHT9ybtuwm+RUYJFZP9F5mYLhMhdxI5YzOzMRIXUOZmVkYGBgYP3\t\t\t\t\t78yMrKeefui///GRipZIWKssTv398ZL1++LCsry8zMTPXmJADJwQv2CCSQygAAAABJRU5ErkJggg==",id:"TravelNotes-Control-circleImgButton",className:"TravelNotes-Control-ImgButton",title:w.getText("ProvidersToolbarUI - circle")},e)).transitMode="circle",c.addEventListener("click",g,!1),C.providers&&(n=!1,C.providers.forEach(p))}return Object.seal({createUI:e=>h(e),get provider(){return C.routing.provider},set provider(e){m(e)},get transitMode(){return C.routing.transitMode},set transitMode(e){v(e)},providersAdded:()=>(u.removeChild(e),void h(u))})}();const Be=function(){let t=o.geoLocation.status.disabled,a=null,n=P();function r(e){n.dispatch("geolocationpositionchanged",{position:e})}function i(){o.geoLocation.status.active===t&&(t=o.geoLocation.status.inactive),n.dispatch("geolocationstatuschanged",{status:t}),navigator.geolocation.clearWatch(a),a=null}function l(e){o.number1===e.code&&(t=o.geoLocation.status.refusedByUser),i()}function s(){switch(t){case o.geoLocation.status.inactive:t=o.geoLocation.status.active,n.dispatch("geolocationstatuschanged",{status:t}),navigator.geolocation.getCurrentPosition(r,l,e.geoLocation.options),a=navigator.geolocation.watchPosition(r,l,e.geoLocation.options);break;case o.geoLocation.status.active:i()}return t}return t="geolocation"in navigator?o.geoLocation.status.inactive:o.geoLocation.status.disabled,Object.seal({get status(){return t},switch:()=>s()})}();const Oe=function(){let a=null,n=t(),r=null,i=null;function l(){i&&(clearTimeout(i),i=null),document.getElementById("TravelNotes-Control-MainDiv").classList.remove("TravelNotes-Control-MainDiv-Minimize"),document.getElementById("TravelNotes-Control-MainDiv").classList.add("TravelNotes-Control-MainDiv-Maximize")}function s(){i=setTimeout(()=>{document.getElementById("TravelNotes-Control-MainDiv").classList.remove("TravelNotes-Control-MainDiv-Maximize"),document.getElementById("TravelNotes-Control-MainDiv").classList.add("TravelNotes-Control-MainDiv-Minimize")},e.travelEditor.timeout)}return Object.seal({createUI:t=>(function(t){if(document.getElementById("TravelNotes-Control-TravelNotesToolbarDiv"))return;let i=n.create("div",{id:"TravelNotes-Control-TravelNotesToolbarDiv",className:"TravelNotes-Control-ButtonsDiv"},t);n.create("div",{id:"TravelNotes-Control-HomeButton",className:"TravelNotes-Control-Button",title:"Home",innerHTML:'<a class="TravelNotes-Control-LinkButton" href="'+window.location.origin+'" target="_blank">&#x1f3e0;</a>'},i),n.create("div",{id:"TravelNotes-Control-HelpButton",className:"TravelNotes-Control-Button",title:"Help",innerHTML:'<a class="TravelNotes-Control-LinkButton" href="https://github.com/wwwouaiebe/leaflet.TravelNotes/tree/gh-pages/TravelNotesGuides" target="_blank">?</a>'},i),n.create("div",{id:"TravelNotes-Control-ContactButton",className:"TravelNotes-Control-Button",title:"Contact",innerHTML:'<a class="TravelNotes-Control-LinkButton" href="'+(e.travelNotesToolbarUI.contactMail||window.location.origin)+'" target="_blank">@</a>'},i),e.APIKeys.showDialogButton&&n.create("div",{id:"TravelNotes-Control-ApiKeysButton",className:"TravelNotes-Control-Button",title:w.getText("TravelNotesToolbarUI - API keys"),innerHTML:"&#x1f511;"},i).addEventListener("click",e=>{e.stopPropagation(),le.dialog()},!1),o.geoLocation.status.disabled<Be.status&&(a=n.create("div",{id:"TravelNotes-Control-GeoLocatorButton",className:"TravelNotes-Control-Button",title:w.getText("TravelNotesToolbarUI - Geo location"),innerHTML:"&#x1f310;"},i)).addEventListener("click",e=>{e.stopPropagation(),Be.switch()},!1),(r=n.create("span",{innerHTML:"&#x274c;",id:"TravelNotes-Control-PinButton"},i)).addEventListener("click",e=>{let t=document.getElementById("TravelNotes-Control-MainDiv"),o=document.createElement("div");o.innerHTML="&#x274c;",o.innerHTML===e.target.innerHTML?(e.target.innerHTML="&#x1f4cc;",t.addEventListener("mouseenter",l,!1),t.addEventListener("mouseleave",s,!1)):(e.target.innerHTML="&#x274c;",t.removeEventListener("mouseenter",l,!1),t.removeEventListener("mouseleave",s,!1))},!1),e.travelEditor.startMinimized?(r.innerHTML="&#x1f4cc;",t.addEventListener("mouseenter",l,!1),t.addEventListener("mouseleave",s,!1),t.classList.add("TravelNotes-Control-MainDiv-Minimize")):t.classList.add("TravelNotes-Control-MainDiv-Maximize")})(t),geoLocationStatusChanged:e=>(function(e){switch(e){case o.geoLocation.status.inactive:a.classList.remove("TravelNotes-Control-GeoLocationButton-Striked");break;case o.geoLocation.status.active:a.classList.add("TravelNotes-Control-GeoLocationButton-Striked");break;default:a&&(a.parentNode.removeChild(a),a=null)}})(e)})}();const Se=function(){let e=null;function a(a){if(document.getElementById("TravelNotes-Control-MainDiv"))return;let n=t();e=n.create("div",{id:"TravelNotes-Control-MainDiv"},a),n.create("div",{id:"TravelNotes-Control-MainDiv-Title",innerHTML:"Travel&nbsp;&amp;&nbsp;Notes"},e),Oe.createUI(e),he.createUI(e),fe.createUI(e),Me.createUI(e),Re.createUI(e),e.addEventListener("setrouteslist",()=>he.setRoutesList(),!1),e.addEventListener("expandrouteui",()=>fe.expandUI(),!1),e.addEventListener("reducerouteui",()=>fe.reduceUI(),!1),e.addEventListener("setwaypointslist",()=>fe.setWayPointsList(),!1),e.addEventListener("setitinerary",()=>Me.setItinerary(),!1),e.addEventListener("updateitinerary",()=>Me.updateItinerary(),!1),e.addEventListener("settravelnotes",()=>Me.setTravelNotes(),!1),e.addEventListener("updatetravelnotes",()=>Me.updateTravelNotes(),!1),e.addEventListener("setsearch",()=>Me.setSearch(),!1),e.addEventListener("updatesearch",()=>Me.updateSearch(),!1),e.addEventListener("providersadded",()=>Re.providersAdded(),!1),e.addEventListener("setprovider",e=>{e.data&&e.data.provider&&(Re.provider=e.data.provider)},!1),e.addEventListener("settransitmode",e=>{e.data&&e.data.provider&&(Re.transitMode=e.data.transitMode)},!1),e.addEventListener("click",e=>{e.target.classList.contains("TravelNotes-SortableList-ItemInput")||e.target.classList.contains("TravelNotes-Control-LinkButton")||e.target.id&&o.invalidObjId!==["TravelNotes-Control-OpenTravelInput","TravelNotes-Control-OpenTravelButton","TravelNotes-Control-ImportTravelInput","TravelNotes-Control-ImportTravelButton"].indexOf(e.target.id)||(e.stopPropagation(),e.preventDefault())},!1),e.addEventListener("dblclick",e=>{e.stopPropagation(),e.preventDefault()},!1),e.addEventListener("wheel",e=>{e.stopPropagation(),e.preventDefault()},!1),document.addEventListener("geolocationstatuschanged",e=>{Oe.geoLocationStatusChanged(e.data.status)},!1)}return e||a(),{createUI:e=>a(e)}}();function ze(){let e=j();e.title=w.getText("AboutDialog - About Travel & Notes"),t().create("div",{id:"TravelNotes-AboutDialog-AboutDiv"},e.content).innerHTML='<p>This  program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 3 of the License, or any later version.</p><p>Copyright - 2017 2019 - wwwouaiebe</p><p>Contact : <a href="http://www.ouaie.be/blog/pages/contact" target="_blank">http://www.ouaie.be/</a></p><p>GitHub : <a href="https://github.com/wwwouaiebe/leaflet.TravelNotes" target="_blank">https://github.com/wwwouaiebe/leaflet.TravelNotes</a></p><p>Version : '+i+'.<p>This program uses: <a href="https://leafletjs.com/" target="_blank">leaflet</a>, <a href="https://github.com/mapbox/polyline" target="_blank">mapbox/polyline</a>, <a href="https://github.com/Project-OSRM/osrm-text-instructions" target="_blank">Project-OSRM/osrm-text-instructions</a> and  <a href="https://github.com/drolbr/Overpass-API" target="_blank">the Overpass API</a></p>',e.show().then().catch(e=>console.log(e||"An error occurs in the dialog"))}function ke(e){let t=[e.latlng.lat,e.latlng.lng],a=O();let n=_(e);return n.init([{context:K,name:w.getText("ContextMenuFactory - Select this point as start point"),action:o.invalidObjId!==C.editedRouteObjId&&o.latLng.defaultValue===C.travel.editedRoute.wayPoints.first.lat?K.setStartPoint:null,param:t},{context:K,name:w.getText("ContextMenuFactory - Select this point as way point"),action:o.invalidObjId===C.editedRouteObjId?null:K.addWayPoint,param:t},{context:K,name:w.getText("ContextMenuFactory - Select this point as end point"),action:o.invalidObjId!==C.editedRouteObjId&&o.latLng.defaultValue===C.travel.editedRoute.wayPoints.last.lat?K.setEndPoint:null,param:t},{context:oe,name:w.getText("ContextMenuFactory - New travel note"),action:oe.newTravelNote,param:t},{context:oe,name:w.getText("ContextMenuFactory - Hide notes"),action:oe.hideNotes},{context:oe,name:w.getText("ContextMenuFactory - Show notes"),action:oe.showNotes},{context:S,name:w.getText("ContextMenuFactory - Show all routes"),action:S.showRoutes},{context:a,name:w.getText("ContextMenuFactory - Zoom to travel"),action:a.zoomToTravel},{context:null,name:w.getText("ContextMenuFactory - About Travel & Notes"),action:ze}]),Object.seal(n)}const Ue=function(){let e=null,a=null,n=null,r="",i=E();function l(){e.innerHTML="<span>"+a+"&nbsp;-&nbsp;Zoom&nbsp;:&nbsp;"+n+(""===r?"":"&nbsp;-&nbsp;"+r)+"</span>"}return Object.seal({createUI:()=>(function(){n=C.map.getZoom();let s=C.map.getCenter();a=i.formatLat(s.lat)+"&nbsp;-&nbsp;"+i.formatLng(s.lng),e=t().create("div",{id:"TravelNotes-MouseControl"},document.getElementsByTagName("body")[o.zero]),C.map.on("mousemove",e=>{a=i.formatLat(e.latlng.lat)+"&nbsp;-&nbsp;"+i.formatLng(e.latlng.lng),l()}),C.map.on("zoomend",()=>{n=C.map.getZoom(),l()}),document.addEventListener("travelnotesfileloaded",e=>{r=e.data.name||"",l()},!1)})(),set mousePos(e){var t;t=e,a=i.formatLat(t.lat)+"&nbsp;-&nbsp;"+i.formatLng(t.lng),l()},set zoom(e){n=e,l()},set fileName(e){r=e,l()}})}();const He=function(){let t=[],n=[],r=!1,l=!1,s=P();function d(){document.addEventListener("routeupdated",e=>{e.data&&ce.updateRoute(e.data.removedRouteObjId,e.data.addedRouteObjId)},!1),document.addEventListener("routepropertiesupdated",e=>{e.data&&(ce.updateRouteProperties(e.data.routeObjId),R())},!1),document.addEventListener("noteupdated",e=>{e.data&&(ce.updateNote(e.data.removedNoteObjId,e.data.addedNoteObjId),R())},!1),document.addEventListener("removeobject",e=>{e.data&&ce.removeObject(e.data.objId)},!1),document.addEventListener("removeallobjects",()=>ce.removeAllObjects(),!1),document.addEventListener("zoomto",e=>{e.data&&de.zoomTo(e.data.latLng,e.data.geometry)},!1),document.addEventListener("additinerarypointmarker",e=>{e.data&&ce.addItineraryPointMarker(e.data.objId,e.data.latLng)},!1),document.addEventListener("addsearchpointmarker",e=>{e.data&&ce.addSearchPointMarker(e.data.objId,e.data.latLng,e.data.geometry)},!1),document.addEventListener("addrectangle",e=>{e.data&&ce.addRectangle(e.data.objId,e.data.bounds,e.data.properties)},!1),document.addEventListener("addwaypoint",e=>{e.data&&ce.addWayPoint(e.data.wayPoint,e.data.letter)},!1),document.addEventListener("layerchange",e=>{e.data&&ce.setLayer(e.data.layer)}),document.addEventListener("geolocationpositionchanged",e=>{e.data&&de.onGeolocationPositionChanged(e.data.position)},!1),document.addEventListener("geolocationstatuschanged",e=>{e.data&&de.onGeolocationStatusChanged(e.data.status)},!1),document.addEventListener("roadbookupdate",()=>R(),!1)}function c(){C.travel.readOnly||ke(event).show()}function u(e){C.travel.readOnly||ke(e).show()}return Object.seal({addReadOnlyMap:(e,t)=>(e=e,t=t,d(),e&&(C.map=e),ve.createUI(),ge.setLayer("OSM - Color"),void a().getJsonPromise(t).then(me().openDistantFile).catch(e=>{console.log(e||"Not possible to load the .trv file"),C.map.setView([o.latLng.defaultValue,o.latLng.defaultValue],o.number2)})),addControl:(t,o)=>(function(t,o){d(),window.addEventListener("unload",()=>localStorage.removeItem(C.UUID+"-TravelNotesHTML")),window.addEventListener("beforeunload",e=>(e.returnValue="x","x")),t&&(C.map=t),C.travel=I(),C.travel.routes.add(g()),Se.createUI(document.getElementById(o)),ve.createUI(),A.createUI(),le.fromServerFile(),e.layersToolbarUI.haveLayersToolbarUI&&ge.createUI(),e.mouseUI.haveMouseUI&&Ue.createUI(),s.dispatch("setrouteslist"),s.dispatch("roadbookupdate"),e.travelEditor.startupRouteEdition?V.editRoute(C.travel.routes.first.objId):s.dispatch("reducerouteui"),C.map.setView([e.map.center.lat,e.map.center.lng],e.map.zoom)})(t,o),addProvider:e=>(e=e,void le.addProvider(e)),showInfo:e=>(e=e,void A.showInfo(e)),addMapContextMenu:(e,t)=>{e&&(C.map.on("click",c),r=!0),t&&(C.map.on("contextmenu",c),l=!0)},get baseDialog(){return j()},get userData(){return C.travel.userData},set userData(e){C.travel.userData=e},get rightContextMenu(){return l},set rightContextMenu(e){e&&!l?(C.map.on("contextmenu",u),l=!0):!e&&l&&(C.map.off("contextmenu",u),l=!1)},get leftContextMenu(){return r},set leftContextMenu(e){e&&!r?(C.map.on("click",c),r=!0):!e&&r&&(C.map.off("click",c),r=!1)},get leftUserContextMenu(){return t},set leftUserContextMenu(e){t=e},get rightUserContextMenu(){return n},set rightUserContextMenu(e){n=e},get map(){return C.map},get maneuver(){return b()},get itineraryPoint(){return T()},get version(){return i}});var v,m,p,h}();!function(){let n=null,r=null;!function(){let e="?";decodeURI(window.location.search).substr(o.number1).split("&").forEach(t=>{o.notFound===t.indexOf("ProviderKey")?("fil="===t.substr(o.zero,o.number4).toLowerCase()?r=decodeURIComponent(escape(atob(t.substr(o.number4)))):"lng="===t.substr(o.zero,o.number4).toLowerCase()&&(n=t.substr(o.number4).toLowerCase()),e+="?"===e?"":"&",e+=t):le.fromUrl(t)}),history.replaceState({index:"bar"},"page",e)}(),window.L.travelNotes=He,window.osmSearch?window.osmSearch.getDictionaryPromise(e.language,"travelNotes").then(()=>console.log("osmSearch dictionary loaded"),e=>console.log(e||"An error occurs when loading the osmSearch dictionary")):console.log("osmSearch not found");let i=a(),l=[i.getJsonPromise(window.location.href.substr(o.zero,window.location.href.lastIndexOf("/")+o.number1)+"TravelNotesConfig.json"),i.getJsonPromise(window.location.href.substr(o.zero,window.location.href.lastIndexOf("/")+o.number1)+"TravelNotes"+(n||e.language).toUpperCase()+".json"),i.getJsonPromise(window.location.href.substr(o.zero,window.location.href.lastIndexOf("/")+o.number1)+"TravelNotesLayers.json"),i.getJsonPromise(window.location.href.substr(o.zero,window.location.href.lastIndexOf("/")+o.number1)+"TravelNotesNoteDialog"+(n||e.language).toUpperCase()+".json"),function(){if(!window.crypto||!window.crypto.subtle||!window.crypto.subtle.importKey)return Promise.resolve(!1);if(!window.isSecureContext)return Promise.resolve(!1);try{return window.crypto.subtle.importKey("raw",(new window.TextEncoder).encode("hoho"),{name:"PBKDF2"},!1,["deriveKey"])}catch(e){return Promise.resolve(!1)}}()];Promise.all(l).then(a=>{if(n&&(a[o.zero].language=n),a[o.number4]&&(a[o.zero].haveCrypto=!0),e.overload(a[o.zero]),C.providers.forEach(t=>{t.userLanguage=e.language}),w.setTranslations(a[o.number1]),ge.setLayers(a[o.number2]),te.selectOptions=a[o.number3].preDefinedIconsList,te.buttons=a[o.number3].editionButtons,e.autoLoad){t().create("div",{id:"Map"},document.getElementsByTagName("body")[o.zero]),t().create("div",{id:"TravelNotes"},document.getElementsByTagName("body")[o.zero]);let e=window.L.map("Map",{attributionControl:!1,zoomControl:!1}).setView([o.latLng.defaultValue,o.latLng.defaultValue],o.zero);r?He.addReadOnlyMap(e,r):(He.addControl(e,"TravelNotes"),He.rightContextMenu=!0)}}).catch(e=>console.log(e||"An error occurs when downloading the json configuration files"))}()}();