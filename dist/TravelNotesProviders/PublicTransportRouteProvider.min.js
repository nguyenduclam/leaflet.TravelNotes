
/*!
leaflet.travelnotespublictransport - version 1.6.0 
build 00087 - 2019-12-14T08:18:52+0100 
Copyright 2017 2019 wwwouaiebe 
Contact: http://www.ouaie.be/
Sources: https://github.com/wwwouaiebe/leaflet.TravelNotesPublicTransport 
License: GPL-3.0
*/


!function(){"use strict";window.L.travelNotes.addProvider(function(){const e=-1,t=0,n=1,s=2,d=3,a=6;let i="fr",o=null,r=e,l=new Map,u=new Map,c=new Map,g=e,y=t,I=[];function p(e){return e[t]}function A(e){return e[e.length-n]}function h(e,t){e.splice(e.indexOf(t),n)}function w(e){let t=u.get(p(e.nodesIds)),n=u.get(A(e.nodesIds));h(t.startingWaysIds,e.id),t.endingWaysIds.push(e.id),h(n.endingWaysIds,e.id),n.startingWaysIds.push(e.id),e.nodesIds.reverse()}function f(e,t){let n=l.get(e),s=l.get(t);A(n.nodesIds)===A(s.nodesIds)?w(s):p(n.nodesIds)===p(s.nodesIds)?w(n):p(n.nodesIds)===A(s.nodesIds)&&(w(n),w(s));let d=u.get(n.nodesIds.pop());d.startingWaysIds=[],d.endingWaysIds=[],n.nodesIds=n.nodesIds.concat(s.nodesIds),n.distance+=s.distance;let a=u.get(A(n.nodesIds));return h(a.endingWaysIds,s.id),a.endingWaysIds.push(n.id),l.delete(s.id),n.id}function m(e){let t=l.get(e),n={id:g--,type:"way",nodesIds:[],distance:t.distance};return t.nodesIds.forEach(e=>n.nodesIds.push(function(e){let t=u.get(e),n={id:g--,lat:t.lat,lon:t.lon,type:"node",startingWaysIds:[],endingWaysIds:[],isNode3Ways:t.isNode3Ways};return u.set(n.id,n),n.id}(e))),u.get(p(n.nodesIds)).startingWaysIds.push(n.id),u.get(A(n.nodesIds)).endingWaysIds.push(n.id),l.set(n.id,n),n.id}function v(a,i,w){var v;g=e,I=[],y=t,v=a.elements,l.clear(),u.clear(),c.clear(),v.forEach(e=>{switch(e.type){case"way":e.nodesIds=e.nodes,delete e.nodes,s<=e.nodesIds.length&&(e.distance=t,l.set(e.id,e));break;case"node":e.startingWaysIds=[],e.endingWaysIds=[],e.isNode3Ways=!1,u.set(e.id,e);break;case"relation":e.members.forEach(e=>{"node"===e.type&&e.role&&"stop"===e.role&&c.set(e.ref,e.ref)})}}),c.forEach(e=>{let t=u.get(e);t?c.set(e,t):(window.L.travelNotes.showInfo("the relation "+r+" have nodes not positionned on the railway ( node "+e+")."),c.delete(e))}),l.forEach(e=>{u.get(p(e.nodesIds)).startingWaysIds.push(e.id),u.get(A(e.nodesIds)).endingWaysIds.push(e.id);let t=null;e.nodesIds.forEach(n=>{let s=u.get(n);t&&(e.distance+=window.L.latLng(s.lat,s.lon).distanceTo(window.L.latLng(t.lat,t.lon))),t=s})});let L=!1;u.forEach(e=>{let a=e.startingWaysIds.concat(e.endingWaysIds);switch(a.length){case t:case n:break;case s:f(a[t],a[n]);break;case d:e.isNode3Ways=!0,I.push(e),y++;break;default:L=!0,window.L.travelNotes.showInfo("A node with more than 3 ways is found : "+e.id+" - the relation "+r+" - ways "+e.startingWaysIds.concat(e.endingWaysIds))}}),L&&w(new Error("A node with more than 3 ways was found in the relation.See the console for more infos")),l.size>y*s+n&&(function e(){let a=[];function i(e,t){e.isNode3Ways||t.isNode3Ways||a.push({distance:window.L.latLng(e.lat,e.lon).distanceTo(window.L.latLng(t.lat,t.lon)),nodesId:[e.id,t.id]})}let o=Array.from(l.values()),r=n;o.forEach(e=>{for(let a=r;a<o.length;a++){let r=[];r.push(u.get(p(e.nodesIds))),r.push(u.get(A(e.nodesIds))),r.push(u.get(p(o[a].nodesIds))),r.push(u.get(A(o[a].nodesIds))),i(r[t],r[s]),i(r[t],r[d]),i(r[n],r[s]),i(r[n],r[d])}r++});let c=a[t];a.forEach(e=>{e.distance<c.distance&&(c=e)});let I={id:g--,type:"way",nodesIds:c.nodesId,distance:c.distance};l.set(I.id,I);let h=u.get(c.nodesId[t]),w=h.startingWaysIds.concat(h.endingWaysIds)[t];h.startingWaysIds.push(I.id);let m=u.get(c.nodesId[n]),v=m.startingWaysIds.concat(m.endingWaysIds)[t];m.endingWaysIds.push(I.id),f(f(I.id,w),v),l.size>y*s+n&&e()}(),window.L.travelNotes.showInfo("Holes found in the OSM relation number "+r+". Try to correct OSM data.")),t<y&&I.forEach(e=>{let s=Number.MAX_VALUE,d=null,a=e.startingWaysIds.concat(e.endingWaysIds);a.forEach(e=>{let t=l.get(e);t.distance<s&&(s=t.distance,d=t)}),h(a,d.id);let i=l.get(m(d.id)),o=null;p(d.nodesIds)===e.id?(i.nodesIds.pop(),i.nodesIds.push(A(d.nodesIds)),o=p(i.nodesIds)):(i.nodesIds.shift(),i.nodesIds.unshift(p(d.nodesIds)),o=A(i.nodesIds));let r=l.get(a[n]);r.nodesIds[r.nodesIds.indexOf(e.id)]=o,f(f(f(d.id,i.id),a[t]),r.id)}),function(e){let n=null,s=null,d=Number.MAX_VALUE,a=Number.MAX_VALUE;c.forEach(e=>{let t=window.L.latLng(e).distanceTo(o.wayPoints.first.latLng);t<d&&(d=t,n=e),(t=window.L.latLng([e.lat,e.lon]).distanceTo(o.wayPoints.last.latLng))<a&&(a=t,s=e)}),e.itinerary.itineraryPoints.removeAll(),e.itinerary.maneuvers.removeAll();let i=0,r=!1;Array.from(l.values())[t].nodesIds.forEach(d=>{if(0!==i||d!==n.id&&d!==s.id?2!==i||d!==n.id&&d!==s.id||(i=3):(i=1,r=d===s.id),0<i&&4>i){let a=window.L.travelNotes.itineraryPoint,i=u.get(d);a.latLng=[i.lat,i.lon],e.itinerary.itineraryPoints.add(a);let o=c.get(d);if(o){let d=window.L.travelNotes.maneuver,i=null;o.tags&&o.tags.name&&(i=o.tags.name,d.instruction=i+"&nbsp;:&nbsp;"),o.id===n.id?(i&&(e.wayPoints.first.name=i),d.iconName="kTrainStart",d.instruction+="Monter dans le train"):o.id===s.id?(i&&(e.wayPoints.last.name=i),d.iconName="kTrainEnd",d.instruction+="Descendre du train"):(d.iconName="kTrainContinue",d.instruction+="Rester dans le train"),d.distance=t,d.duration=t,d.itineraryPointObjId=a.objId,e.itinerary.maneuvers.add(d)}}1===i&&(i=2),3===i&&(i=4)}),r&&(e.itinerary.itineraryPoints.reverse(),e.itinerary.maneuvers.reverse()),e.distance=t;let g=e.itinerary.maneuvers.iterator;g.done;let y=g.value;g.done;let I=e.itinerary.itineraryPoints.iterator;I.done;let p=I.value;for(;!I.done;)I.value.distance=t,p.distance=window.L.latLng(p.latLng).distanceTo(window.L.latLng(I.value.latLng)),e.distance+=p.distance,y.distance+=p.distance,g.value.itineraryPointObjId===I.value.objId&&((y=g.value).distance=t,g.done),p=I.value}(o),i(o)}function L(e,t){return new Promise(function(n,s){let d=new XMLHttpRequest;d.timeout=15e3,d.onreadystatechange=function(){if(4===d.readyState)if(200===d.status){let e=null;try{e=JSON.parse(d.responseText),n(e)}catch(e){s(new Error("JSON parsing error. File : "+d.responseURL))}}else s(new Error("Error XMLHttpRequest - File : "+d.responseURL))},d.open("GET",e,!0),t&&t.forEach(e=>d.setRequestHeader(e.headerName,e.headerValue)),d.overrideMimeType("application/json"),d.send(null)})}function W(e,n){L('https://lz4.overpass-api.de/api/interpreter?data=[out:json];node["public_transport"="stop_position"]["train"="yes"](around:400.0,'+o.wayPoints.first.lat.toFixed(a)+","+o.wayPoints.first.lng.toFixed(a)+')->.s;rel(bn.s)->.s;node["public_transport"="stop_position"]["train"="yes"](around:400.0,'+o.wayPoints.last.lat.toFixed(a)+","+o.wayPoints.last.lng.toFixed(a)+")->.e;rel(bn.e)->.e;rel.e.s;out tags;").then(e=>(function(e){if(t===e.elements.length)return Promise.reject(new Error("No relations found"));let n=window.L.travelNotes.baseDialog,s=document.createElement("div");s.id="TravelNotes-SelectDialog-SelectDiv",n.content.appendChild(s);let d=document.createElement("select");return d.id="TravelNotes-SelectDialog-SelectElement",s.appendChild(d),n.okButtonListener=function(){return r=e.elements[d.selectedIndex].id},e.elements.forEach(e=>{let t=document.createElement("option");t.text=e.tags.name,d.appendChild(t)}),d.selectedIndex=t,n.show()})(e)).then(()=>L("https://lz4.overpass-api.de/api/interpreter?data=[out:json];rel("+r.toFixed(t)+');way(r)->.e;way.e["railway"="rail"];(._;>;rel('+r.toFixed(t)+"););out;")).then(t=>v(t,e,n)).catch(e=>n(e))}return{getPromiseRoute:e=>(e=e,o=e,new Promise(W)),get icon(){return"iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAA\t\t\t\t\tB3RJTUUH4goTCi4V9AmY6AAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAEc0lEQVRIx8VXTUhbWxD+\t\t\t\t\tzr0ag77Gqo1/RazRYjcBaxAVoxXFhQtRXLgt2iJUaAl9FBFcPBdtceeuBXGr4uaCq67rz0IaaUtFBcXAq1WjVkhiTm6u3u8tXs1T\t\t\t\t\tG6NVyxuYzZy5fHNm5s58R5Ak/gdJOs+htbUVNpsNLpcLZWVlcDqdyMrKujoyE8j4+DhVVaXH42FdXR2tVisBxNTlcnF2dpaXEfyK\t\t\t\t\tcyAQIAD29vZydHSUdrudT58+/b3AUkru7OywoaGBdrudpmnyKiLOa67d3V3U19fjy5cvJ+ylpaVwOp3IyMhAWloa7HY7Kioq4HK5\t\t\t\t\tkJmZebUaR6NRKooSq6mqqlRVlUKIE7U+ra9fv75aqvPy8giARUVF9Pv91HWduq5TSkmv18v+/n5WVVXFBX/48OHlgFtaWgiA6enp\t\t\t\t\tF6pZNBplMBjk3t4e9/b2uL+/T5/P92vA79+/j0Xu9Xov3UBSSn79+jXu2U8DxOfzoa6uDgDw9u1blJeXAwAGBgYwMzODcDgMALBa\t\t\t\t\trbh58yZyc3NRXFyMe/fuIT8/H6qqIhKJ4ODgALdu3UJycvL5zfXp06fYTYeGhmL2tra2hM10nj569OjsVGuaRgAUQnBycpIkubi4\t\t\t\t\tyOzs7CuBHunu7u7PwD09PQTA27dvMxQKUUrJZ8+eXQvgkTocjpPAhYWFBMCBgQGS5PLy8rUCHtdAIBADVhwOB46GV3V1NQKBwG9b\t\t\t\t\thY2Njf+txa6uLrS3t0PTNFRWVib8sLS0FG63G2VlZSguLsaNGzcQiUTw/ft3bGxs4Nu3b/D7/QgGgwiHw5BSQkoJXdcRjUYRDAah\t\t\t\t\t6zpSUlKQpGkapZQCAEKhEFRVxf3791FbW8uGhgbcuXMH+fn5sNvtiWISp3+WODb8SDcsFgvE58+fabPZoKoqsrOzYbFYfivz2Nra\t\t\t\t\tQk5ODpKcTmfc6C5KiYQQP92YJMWPg9P2w8NDmKYJVdO0v3w+Hw4ODqDrOhRFQWpqKsQFxePxiOnpaUxNTUFRFBQWFuI06NbWFtbX\t\t\t\t\t17G9vS0cDoeQUgokJSXFbf2Ojg6+e/eOm5ubjEajZ87j42szIyMjrs/Q0NCJ2W8YBkHSnJubY0lJiXkqCPO4ulwuU9M0U0ppGoZh\t\t\t\t\tHsns7KwJgCkpKSwoKCBJmqfoid/vZ15eHm02m7mysmJGIhHzxKw2DIMLCwt0u91nDgFFUWixWHj37l0ODg5yfn6eh4eHCXma1+vl\t\t\t\t\t2NgYnzx5QgAMhULx1+LIyAhfvnzJpaUl1tTUXOv06uzsTEwE5ubmaLVa2dTUxImJCb558+ZagI+yk5D66LrO5uZmAmB5eTmXl5c5\t\t\t\t\tPj7OBw8e/DJgZmYm19bWLs4yAWB4eBjd3d0AgL6+Prx69QoAMD8/j48fP2J1dRXb29sIh8MwDANCCITDYZimiZycHHR2dsLtdl+c\t\t\t\t\tZR6XnZ0dOhyOWIN9+PDhTN/p6Wl6PB62trYSAGtrazk1NUXDMC73kiDJx4+7KMS/6Xv+3EPD0M/07evrpc32x4mUv3jxJ9fX/+Y/\t\t\t\t\tYWHR4vXjhpgAAAAASUVORK5CYII="},get name(){return"leaflet.TravelNotesPublicTransport & OpenStreetMap"},get transitModes(){return{car:!1,bike:!1,pedestrian:!1,train:!0}},get providerKeyNeeded(){return!1},get providerKey(){return n},set providerKey(e){return e},get userLanguage(){return i},set userLanguage(e){i=e}};var N}())}();