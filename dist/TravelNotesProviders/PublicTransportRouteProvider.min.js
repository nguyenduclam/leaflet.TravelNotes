/*! leaflet.travelnotespublictransport - version 1.5.0 - build 0005 - 2019-11-06 - Copyright 2017 2019 wwwouaiebe - Contact: http//www.ouaie.be/ - This  program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 3 of the License, or any later version.*/


!function i(d,r,o){function u(n,e){if(!r[n]){if(!d[n]){var t="function"==typeof require&&require;if(!e&&t)return t(n,!0);if(c)return c(n,!0);var s=new Error("Cannot find module '"+n+"'");throw s.code="MODULE_NOT_FOUND",s}var a=r[n]={exports:{}};d[n][0].call(a.exports,function(e){return u(d[n][1][e]||e)},a,a.exports,i,d,r,o)}return r[n].exports}for(var c="function"==typeof require&&require,e=0;e<o.length;e++)u(o[e]);return u}({1:[function(e,n,t){!function(){"use strict";var l,n,t,d,r,o,u,c,g,y,p,f,v,s,I;function A(e){return e[0]}function h(e){return e[e.length-1]}function m(e,n){e.splice(e.indexOf(n),1)}function W(e){var n=y.get(A(e.nodesIds)),t=y.get(h(e.nodesIds));m(n.startingWaysIds,e.id),n.endingWaysIds.push(e.id),m(t.endingWaysIds,e.id),t.startingWaysIds.push(e.id),e.nodesIds.reverse()}function w(e,n){var t=g.get(e),s=g.get(n);h(t.nodesIds)===h(s.nodesIds)?W(s):A(t.nodesIds)===A(s.nodesIds)?W(t):A(t.nodesIds)===h(s.nodesIds)&&(W(t),W(s));var a=y.get(t.nodesIds.pop());a.startingWaysIds=[],a.endingWaysIds=[],t.nodesIds=t.nodesIds.concat(s.nodesIds),t.distance+=s.distance;var i=y.get(h(t.nodesIds));return m(i.endingWaysIds,s.id),i.endingWaysIds.push(t.id),g.delete(s.id),t.id}function b(e){var n=g.get(e),t={id:f--,type:"way",nodesIds:[],distance:n.distance};return n.nodesIds.forEach(function(e){t.nodesIds.push(function(e){var n=y.get(e),t={id:f--,lat:n.lat,lon:n.lon,type:"node",startingWaysIds:[],endingWaysIds:[],isNode3Ways:n.isNode3Ways};return y.set(t.id,t),t.id}(e))}),y.get(A(t.nodesIds)).startingWaysIds.push(t.id),y.get(h(t.nodesIds)).endingWaysIds.push(t.id),g.set(t.id,t),t.id}function a(e,n){f=-1,s=[],v=0,function(e){g.clear(),y.clear(),p.clear(),e.forEach(function(e){switch(e.type){case"way":e.nodesIds=e.nodes,delete e.nodes,2<=e.nodesIds.length&&(e.distance=0,g.set(e.id,e));break;case"node":e.startingWaysIds=[],e.endingWaysIds=[],e.isNode3Ways=!1,y.set(e.id,e);break;case"relation":e.members.forEach(function(e){"node"===e.type&&e.role&&"stop"===e.role&&p.set(e.ref,e.ref)})}}),p.forEach(function(e){var n=y.get(e);n?p.set(e,n):(console.log("the relation "+c+" have nodes not positionned on the railway ( node "+e+")."),p.delete(e))}),g.forEach(function(t){y.get(A(t.nodesIds)).startingWaysIds.push(t.id),y.get(h(t.nodesIds)).endingWaysIds.push(t.id);var s=null;t.nodesIds.forEach(function(e){var n=y.get(e);s&&(t.distance+=L.latLng(n.lat,n.lon).distanceTo(L.latLng(s.lat,s.lon))),s=n})})}(d.elements);var t=!1;if(y.forEach(function(e){var n=e.startingWaysIds.concat(e.endingWaysIds);switch(n.length){case 0:case 1:break;case 2:w(n[0],n[1]);break;case 3:e.isNode3Ways=!0,s.push(e),v++;break;default:t=!0,console.log("A node with more than 3 ways is found : "+e.id+" - the relation "+c+" - ways "+e.startingWaysIds.concat(e.endingWaysIds))}}),t)return!1;g.size>2*v+1&&(I(),console.log("Holes found in the OSM relation number "+c+". Try to correct OSM data.")),0<v&&s.forEach(function(e){var t=999999999,s=null,n=e.startingWaysIds.concat(e.endingWaysIds);n.forEach(function(e){var n=g.get(e);n.distance<t&&(t=n.distance,s=n)}),m(n,s.id);var a=g.get(b(s.id)),i=null;i=A(s.nodesIds)===e.id?(a.nodesIds.pop(),a.nodesIds.push(h(s.nodesIds)),A(a.nodesIds)):(a.nodesIds.shift(),a.nodesIds.unshift(A(s.nodesIds)),h(a.nodesIds));var d=g.get(n[1]);d.nodesIds[d.nodesIds.indexOf(e.id)]=i,w(w(w(s.id,a.id),n[0]),d.id)}),function(d){var r=null,o=null,t=999999999,s=999999999;p.forEach(function(e){var n=L.latLng([e.lat,e.lon]).distanceTo(l.wayPoints.first.latLng);n<t&&(t=n,r=e),(n=L.latLng([e.lat,e.lon]).distanceTo(l.wayPoints.last.latLng))<s&&(s=n,o=e)}),d.itinerary.itineraryPoints.removeAll(),d.itinerary.maneuvers.removeAll();var u=0,c=!1;Array.from(g.values())[0].nodesIds.forEach(function(e){if(0!==u||e!==r.id&&e!==o.id?2!==u||e!==r.id&&e!==o.id||(u=3):(u=1,c=e===o.id),0<u&&u<4){var n=L.travelNotes.itineraryPoint,t=y.get(e);n.latLng=[t.lat,t.lon],d.itinerary.itineraryPoints.add(n);var s=p.get(e);if(s){var a=L.travelNotes.maneuver,i=null;s.tags&&s.tags.name&&(i=s.tags.name,a.instruction=i+"&nbsp;:&nbsp;"),s.id===r.id?(i&&(d.wayPoints.first.name=i),a.iconName="kTrainStart",a.instruction+="Monter dans le train"):s.id===o.id?(i&&(d.wayPoints.last.name=i),a.iconName="kTrainEnd",a.instruction+="Descendre du train"):(a.iconName="kTrainContinue",a.instruction+="Rester dans le train"),a.distance=0,a.duration=0,a.itineraryPointObjId=n.objId,d.itinerary.maneuvers.add(a)}}1===u&&(u=2),3===u&&(u=4)}),c&&(d.itinerary.itineraryPoints.reverse(),d.itinerary.maneuvers.reverse()),d.distance=0;var e=d.itinerary.maneuvers.iterator,n=(e.done,e.value);e.done;var a=d.itinerary.itineraryPoints.iterator;a.done;for(var i=a.value;!a.done;)a.value.distance=0,i.distance=L.latLng(i.latLng).distanceTo(L.latLng(a.value.latLng)),d.distance+=i.distance,n.distance+=i.distance,e.value.itineraryPointObjId===a.value.objId&&((n=e.value).distance=0,e.done),i=a.value}(l),e("")}function i(e,n){function t(){return n("Cancelled by user"),!0}if(0!==d.elements.length){var s=L.travelNotes.baseDialog;s.addClickOkButtonEventListener(function(){return c=d.elements[i.selectedIndex].id,u="https://lz4.overpass-api.de/api/interpreter?data=[out:json];rel("+c.toFixed(0)+');way(r)->.e;way.e["railway"="rail"];(._;>;rel('+c.toFixed(0)+"););out;",e(new Promise(o[r++])),!0}),s.addClickCancelButtonEventListener(t),s.addEscapeKeyEventListener(t);var a=document.createElement("div");a.id="TravelNotes-SelectDialog-SelectDiv",s.content.appendChild(a);var i=document.createElement("select");i.id="TravelNotes-SelectDialog-SelectElement",a.appendChild(i),d.elements.forEach(function(e){var n=document.createElement("option");n.text=e.tags.name,i.appendChild(n)}),i.selectedIndex=0,s.center()}else n("No relation found")}function N(e,n){var t=new XMLHttpRequest;t.timeout=5e3,t.ontimeout=function(e){n("TimeOut error")},t.onreadystatechange=function(){if(4===t.readyState)if(200===t.status){try{d=JSON.parse(t.responseText)}catch(e){n("JSON parsing error")}e(new Promise(o[r++]))}else n("Status : "+this.status+" statusText : "+this.statusText)},t.open("GET",u,!0),t.overrideMimeType("application/json"),t.send(null)}function T(e,n){return n,d="",u='https://lz4.overpass-api.de/api/interpreter?data=[out:json];node["public_transport"="stop_position"]["train"="yes"](around:400.0,'+(l=e).wayPoints.first.lat.toFixed(6)+","+l.wayPoints.first.lng.toFixed(6)+')->.s;rel(bn.s)->.s;node["public_transport"="stop_position"]["train"="yes"](around:400.0,'+l.wayPoints.last.lat.toFixed(6)+","+l.wayPoints.last.lng.toFixed(6)+")->.e;rel(bn.e)->.e;rel.e.s;out tags;",r=0,(o=[]).push(N),o.push(i),o.push(N),o.push(a),new Promise(o[r++])}L.travelNotes.addProvider((t="fr",r=0,o=[],u=d=n="",c=-1,g=new Map,y=new Map,p=new Map,f=-1,v=0,s=[],I=function(){function s(e,n){e.isNode3Ways||n.isNode3Ways||t.push({distance:L.latLng(e.lat,e.lon).distanceTo(L.latLng(n.lat,n.lon)),nodesId:[e.id,n.id]})}var t=[],a=Array.from(g.values()),i=1;a.forEach(function(e){for(var n=i;n<a.length;n++){var t=[];t.push(y.get(A(e.nodesIds))),t.push(y.get(h(e.nodesIds))),t.push(y.get(A(a[n].nodesIds))),t.push(y.get(h(a[n].nodesIds))),s(t[0],t[2]),s(t[0],t[3]),s(t[1],t[2]),s(t[1],t[3])}i++});var n=t[0];t.forEach(function(e){e.distance<n.distance&&(n=e)});var e={id:f--,type:"way",nodesIds:n.nodesId,distance:n.distance};g.set(e.id,e);var d=y.get(n.nodesId[0]),r=d.startingWaysIds.concat(d.endingWaysIds)[0];d.startingWaysIds.push(e.id);var o=y.get(n.nodesId[1]),u=o.startingWaysIds.concat(o.endingWaysIds)[0];o.endingWaysIds.push(e.id),w(w(e.id,r),u),g.size>2*v+1&&I()},{getPromiseRoute:function(e,n){return T(e,n)},get icon(){return"iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAB3RJTUUH4goTCi4V9AmY6AAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAEc0lEQVRIx8VXTUhbWxD+zr0ag77Gqo1/RazRYjcBaxAVoxXFhQtRXLgt2iJUaAl9FBFcPBdtceeuBXGr4uaCq67rz0IaaUtFBcXAq1WjVkhiTm6u3u8tXs1TG6NVyxuYzZy5fHNm5s58R5Ak/gdJOs+htbUVNpsNLpcLZWVlcDqdyMrKujoyE8j4+DhVVaXH42FdXR2tVisBxNTlcnF2dpaXEfyKcyAQIAD29vZydHSUdrudT58+/b3AUkru7OywoaGBdrudpmnyKiLOa67d3V3U19fjy5cvJ+ylpaVwOp3IyMhAWloa7HY7Kioq4HK5kJmZebUaR6NRKooSq6mqqlRVlUKIE7U+ra9fv75aqvPy8giARUVF9Pv91HWduq5TSkmv18v+/n5WVVXFBX/48OHlgFtaWgiA6enpF6pZNBplMBjk3t4e9/b2uL+/T5/P92vA79+/j0Xu9Xov3UBSSn79+jXu2U8DxOfzoa6uDgDw9u1blJeXAwAGBgYwMzODcDgMALBarbh58yZyc3NRXFyMe/fuIT8/H6qqIhKJ4ODgALdu3UJycvL5zfXp06fYTYeGhmL2tra2hM10nj569OjsVGuaRgAUQnBycpIkubi4yOzs7CuBHunu7u7PwD09PQTA27dvMxQKUUrJZ8+eXQvgkTocjpPAhYWFBMCBgQGS5PLy8rUCHtdAIBADVhwOB46GV3V1NQKBwG9bhY2Njf+txa6uLrS3t0PTNFRWVib8sLS0FG63G2VlZSguLsaNGzcQiUTw/ft3bGxs4Nu3b/D7/QgGgwiHw5BSQkoJXdcRjUYRDAah6zpSUlKQpGkapZQCAEKhEFRVxf3791FbW8uGhgbcuXMH+fn5sNvtiWISp3+WODb8SDcsFgvE58+fabPZoKoqsrOzYbFYfivz2NraQk5ODpKcTmfc6C5KiYQQP92YJMWPg9P2w8NDmKYJVdO0v3w+Hw4ODqDrOhRFQWpqKsQFxePxiOnpaUxNTUFRFBQWFuI06NbWFtbX17G9vS0cDoeQUgokJSXFbf2Ojg6+e/eOm5ubjEajZ87j42szIyMjrs/Q0NCJ2W8YBkHSnJubY0lJiXkqCPO4ulwuU9M0U0ppGoZhHsns7KwJgCkpKSwoKCBJmqfoid/vZ15eHm02m7mysmJGIhHzxKw2DIMLCwt0u91nDgFFUWixWHj37l0ODg5yfn6eh4eHCXma1+vl2NgYnzx5QgAMhULx1+LIyAhfvnzJpaUl1tTUXOv06uzsTEwE5ubmaLVa2dTUxImJCb558+ZagI+yk5D66LrO5uZmAmB5eTmXl5c5Pj7OBw8e/DJgZmYm19bWLs4yAWB4eBjd3d0AgL6+Prx69QoAMD8/j48fP2J1dRXb29sIh8MwDANCCITDYZimiZycHHR2dsLtdl+cZR6XnZ0dOhyOWIN9+PDhTN/p6Wl6PB62trYSAGtrazk1NUXDMC73kiDJx4+7KMS/6Xv+3EPD0M/07evrpc32x4mUv3jxJ9fX/+Y/YWHR4vXjhpgAAAAASUVORK5CYII="},get name(){return"leaflet.TravelNotesPublicTransport & 0penStreetMap"},get transitModes(){return{car:!1,bike:!1,pedestrian:!1,train:!0}},get providerKeyNeeded(){return!1},get providerKey(){return n.length},set providerKey(e){""===n&&(n=e)},get userLanguage(){return t},set userLanguage(e){t=e}}))}()},{}]},{},[1]);